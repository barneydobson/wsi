
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.5.2">
    
    
      
        <title>API Reference - Land - WSIMOD docs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.9f9400aa.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#api-reference-land" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="WSIMOD docs" class="md-header__button md-logo" aria-label="WSIMOD docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            WSIMOD docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              API Reference - Land
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="WSIMOD docs" class="md-nav__button md-logo" aria-label="WSIMOD docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    WSIMOD docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../paper/paper/" class="md-nav__link">
        About
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        Installation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/" class="md-nav__link">
        Tutorials
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../how-to/" class="md-nav__link">
        How to guide
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../reference/" class="md-nav__link">
        API reference
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../demo/scripts/quickstart_demo/" class="md-nav__link">
        Quickstart (.py)
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../coverage/" class="md-nav__link">
        Coverage report
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#wsimod.nodes.land" class="md-nav__link">
    wsimod.nodes.land
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wsimod.nodes.land.GardenSurface" class="md-nav__link">
    GardenSurface
  </a>
  
    <nav class="md-nav" aria-label="GardenSurface">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.land.GardenSurface.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.land.GardenSurface.calculate_irrigation_demand" class="md-nav__link">
    calculate_irrigation_demand()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.land.GardenSurface.receive_irrigation_demand" class="md-nav__link">
    receive_irrigation_demand()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wsimod.nodes.land.GrowingSurface" class="md-nav__link">
    GrowingSurface
  </a>
  
    <nav class="md-nav" aria-label="GrowingSurface">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.land.GrowingSurface.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.land.GrowingSurface.adjust_vqip_to_liquid" class="md-nav__link">
    adjust_vqip_to_liquid()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.land.GrowingSurface.adsorption" class="md-nav__link">
    adsorption()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.land.GrowingSurface.calc_crop_cover" class="md-nav__link">
    calc_crop_cover()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.land.GrowingSurface.calc_crop_uptake" class="md-nav__link">
    calc_crop_uptake()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.land.GrowingSurface.calc_soil_moisture_dependence_factor" class="md-nav__link">
    calc_soil_moisture_dependence_factor()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.land.GrowingSurface.calc_temperature_dependence_factor" class="md-nav__link">
    calc_temperature_dependence_factor()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.land.GrowingSurface.denitrification" class="md-nav__link">
    denitrification()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.land.GrowingSurface.dry_deposition_to_tank" class="md-nav__link">
    dry_deposition_to_tank()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.land.GrowingSurface.erosion" class="md-nav__link">
    erosion()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.land.GrowingSurface.fertiliser" class="md-nav__link">
    fertiliser()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.land.GrowingSurface.manure" class="md-nav__link">
    manure()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.land.GrowingSurface.pull_storage" class="md-nav__link">
    pull_storage()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.land.GrowingSurface.quick_interp" class="md-nav__link">
    quick_interp()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.land.GrowingSurface.residue" class="md-nav__link">
    residue()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.land.GrowingSurface.soil_pool_transformation" class="md-nav__link">
    soil_pool_transformation()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.land.GrowingSurface.wet_deposition_to_tank" class="md-nav__link">
    wet_deposition_to_tank()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wsimod.nodes.land.ImperviousSurface" class="md-nav__link">
    ImperviousSurface
  </a>
  
    <nav class="md-nav" aria-label="ImperviousSurface">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.land.ImperviousSurface.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.land.ImperviousSurface.precipitation_evaporation" class="md-nav__link">
    precipitation_evaporation()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.land.ImperviousSurface.push_to_sewers" class="md-nav__link">
    push_to_sewers()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wsimod.nodes.land.IrrigationSurface" class="md-nav__link">
    IrrigationSurface
  </a>
  
    <nav class="md-nav" aria-label="IrrigationSurface">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.land.IrrigationSurface.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.land.IrrigationSurface.irrigate" class="md-nav__link">
    irrigate()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wsimod.nodes.land.Land" class="md-nav__link">
    Land
  </a>
  
    <nav class="md-nav" aria-label="Land">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.land.Land.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.land.Land.apply_irrigation" class="md-nav__link">
    apply_irrigation()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.land.Land.end_timestep" class="md-nav__link">
    end_timestep()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.land.Land.get_surface" class="md-nav__link">
    get_surface()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.land.Land.push_set_sewer" class="md-nav__link">
    push_set_sewer()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.land.Land.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wsimod.nodes.land.PerviousSurface" class="md-nav__link">
    PerviousSurface
  </a>
  
    <nav class="md-nav" aria-label="PerviousSurface">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.land.PerviousSurface.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.land.PerviousSurface.calculate_soil_temperature" class="md-nav__link">
    calculate_soil_temperature()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.land.PerviousSurface.get_cmd" class="md-nav__link">
    get_cmd()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.land.PerviousSurface.get_smc" class="md-nav__link">
    get_smc()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.land.PerviousSurface.ihacres" class="md-nav__link">
    ihacres()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.land.PerviousSurface.route" class="md-nav__link">
    route()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wsimod.nodes.land.Surface" class="md-nav__link">
    Surface
  </a>
  
    <nav class="md-nav" aria-label="Surface">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.land.Surface.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.land.Surface.atmospheric_deposition" class="md-nav__link">
    atmospheric_deposition()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.land.Surface.dry_deposition_to_tank" class="md-nav__link">
    dry_deposition_to_tank()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.land.Surface.get_data_input" class="md-nav__link">
    get_data_input()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.land.Surface.get_data_input_surface" class="md-nav__link">
    get_data_input_surface()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.land.Surface.precipitation_deposition" class="md-nav__link">
    precipitation_deposition()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.land.Surface.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.land.Surface.simple_deposition" class="md-nav__link">
    simple_deposition()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.land.Surface.wet_deposition_to_tank" class="md-nav__link">
    wet_deposition_to_tank()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wsimod.nodes.nutrient_pool" class="md-nav__link">
    wsimod.nodes.nutrient_pool
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wsimod.nodes.nutrient_pool.NutrientPool" class="md-nav__link">
    NutrientPool
  </a>
  
    <nav class="md-nav" aria-label="NutrientPool">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.nutrient_pool.NutrientPool.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.nutrient_pool.NutrientPool.allocate_dry_deposition" class="md-nav__link">
    allocate_dry_deposition()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.nutrient_pool.NutrientPool.allocate_fertiliser" class="md-nav__link">
    allocate_fertiliser()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.nutrient_pool.NutrientPool.allocate_inorganic_irrigation" class="md-nav__link">
    allocate_inorganic_irrigation()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.nutrient_pool.NutrientPool.allocate_manure" class="md-nav__link">
    allocate_manure()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.nutrient_pool.NutrientPool.allocate_organic_irrigation" class="md-nav__link">
    allocate_organic_irrigation()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.nutrient_pool.NutrientPool.allocate_residue" class="md-nav__link">
    allocate_residue()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.nutrient_pool.NutrientPool.allocate_wet_deposition" class="md-nav__link">
    allocate_wet_deposition()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.nutrient_pool.NutrientPool.erode_P" class="md-nav__link">
    erode_P()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.nutrient_pool.NutrientPool.extract" class="md-nav__link">
    extract()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.nutrient_pool.NutrientPool.extract_dissolved" class="md-nav__link">
    extract_dissolved()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.nutrient_pool.NutrientPool.get_empty_nutrient" class="md-nav__link">
    get_empty_nutrient()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.nutrient_pool.NutrientPool.get_erodable_P" class="md-nav__link">
    get_erodable_P()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.nutrient_pool.NutrientPool.init_empty" class="md-nav__link">
    init_empty()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.nutrient_pool.NutrientPool.init_store" class="md-nav__link">
    init_store()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.nutrient_pool.NutrientPool.multiply_nutrients" class="md-nav__link">
    multiply_nutrients()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.nutrient_pool.NutrientPool.receive" class="md-nav__link">
    receive()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.nutrient_pool.NutrientPool.soil_pool_transformation" class="md-nav__link">
    soil_pool_transformation()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.nutrient_pool.NutrientPool.subtract_nutrients" class="md-nav__link">
    subtract_nutrients()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.nutrient_pool.NutrientPool.sum_nutrients" class="md-nav__link">
    sum_nutrients()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.nutrient_pool.NutrientPool.temp_soil_process" class="md-nav__link">
    temp_soil_process()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wsimod.nodes.nutrient_pool.NutrientStore" class="md-nav__link">
    NutrientStore
  </a>
  
    <nav class="md-nav" aria-label="NutrientStore">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#wsimod.nodes.nutrient_pool.NutrientStore.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="api-reference-land">API Reference - Land</h1>
<p>This section of the documentation provides a reference for the API of the nodes.land and nodes.nutrient_pool modules.</p>


<div class="doc doc-object doc-module">


<a id="wsimod.nodes.land"></a>
  <div class="doc doc-contents first">
  
      <p>Created on Fri May 20 08:58:58 2022</p>
<p>@author: Barney</p>

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="wsimod.nodes.land.GardenSurface" class="doc doc-heading">
        <code>GardenSurface</code>


</h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="wsimod.nodes.land.GrowingSurface" href="#wsimod.nodes.land.GrowingSurface">GrowingSurface</a></code></p>



        <details class="quote">
          <summary>Source code in <code>wsimod\nodes\land.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span>
<span class="normal">1675</span>
<span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span>
<span class="normal">1685</span>
<span class="normal">1686</span>
<span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span>
<span class="normal">1691</span>
<span class="normal">1692</span>
<span class="normal">1693</span>
<span class="normal">1694</span>
<span class="normal">1695</span>
<span class="normal">1696</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">GardenSurface</span><span class="p">(</span><span class="n">GrowingSurface</span><span class="p">):</span>
    <span class="c1">#TODO - probably a simplier version of this is useful, building just on pervioussurface</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A specific surface for gardens that treats the garden as a grass crop, but </span>
<span class="sd">        that can calculate/receive irrigation through functions that are assigned by </span>
<span class="sd">        the parent land node&#39;s handlers, which in turn are expected to be triggered by </span>
<span class="sd">        a query from an attached Demand node.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">calculate_irrigation_demand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ignore_vqip</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A check function (assigned by parent to push check from demand nodes) that </span>
<span class="sd">        calculations irrigation demand (i.e., difference between evaporation and </span>
<span class="sd">        preciptiation)</span>

<span class="sd">        Args:</span>
<span class="sd">            ignore_vqip (any, optional): Conventional push checks send an optional </span>
<span class="sd">                VQIP amount, however the intention with this check is to get the </span>
<span class="sd">                irrigation demand</span>

<span class="sd">        Returns:</span>
<span class="sd">            reply (dict): A VQIP amount of irrigation demand (note only &#39;volume&#39; key </span>
<span class="sd">                is used)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#Calculate irrigation demand</span>
        <span class="n">irrigation_demand</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evaporation</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">precipitation</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">root_zone_depletion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cmd</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">root_zone_depletion</span> <span class="o">&lt;=</span> <span class="n">constants</span><span class="o">.</span><span class="n">FLOAT_ACCURACY</span><span class="p">:</span>
            <span class="c1">#TODO this isn&#39;t in FAO... but seems sensible</span>
            <span class="n">irrigation_demand</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1">#Reply as VQIP</span>
        <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
        <span class="n">reply</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">irrigation_demand</span>
        <span class="k">return</span> <span class="n">reply</span>

    <span class="k">def</span> <span class="nf">receive_irrigation_demand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vqip</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A set function (assigned by parent to push set from demand nodes) that assigns irrigation water supply to the surface tank</span>

<span class="sd">        Args:</span>
<span class="sd">            vqip (dict): A VQIP amount of irrigation to receive</span>

<span class="sd">        Returns:</span>
<span class="sd">            (dict): A VQIP amount of irrigation that was not received (should always </span>
<span class="sd">                be empty)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#update tank</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">vqip</span><span class="p">,</span> <span class="n">force</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.land.GardenSurface.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>A specific surface for gardens that treats the garden as a grass crop, but 
that can calculate/receive irrigation through functions that are assigned by 
the parent land node's handlers, which in turn are expected to be triggered by 
a query from an attached Demand node.</p>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\land.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A specific surface for gardens that treats the garden as a grass crop, but </span>
<span class="sd">    that can calculate/receive irrigation through functions that are assigned by </span>
<span class="sd">    the parent land node&#39;s handlers, which in turn are expected to be triggered by </span>
<span class="sd">    a query from an attached Demand node.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.land.GardenSurface.calculate_irrigation_demand" class="doc doc-heading">
<code class="highlight language-python"><span class="n">calculate_irrigation_demand</span><span class="p">(</span><span class="n">ignore_vqip</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>A check function (assigned by parent to push check from demand nodes) that 
calculations irrigation demand (i.e., difference between evaporation and 
preciptiation)</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>ignore_vqip</code></td>
          <td>
                <code>any</code>
          </td>
          <td><p>Conventional push checks send an optional 
VQIP amount, however the intention with this check is to get the 
irrigation demand</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>reply</code></td>          <td>
                <code>dict</code>
          </td>
          <td><p>A VQIP amount of irrigation demand (note only 'volume' key 
is used)</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\land.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span>
<span class="normal">1675</span>
<span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calculate_irrigation_demand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ignore_vqip</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A check function (assigned by parent to push check from demand nodes) that </span>
<span class="sd">    calculations irrigation demand (i.e., difference between evaporation and </span>
<span class="sd">    preciptiation)</span>

<span class="sd">    Args:</span>
<span class="sd">        ignore_vqip (any, optional): Conventional push checks send an optional </span>
<span class="sd">            VQIP amount, however the intention with this check is to get the </span>
<span class="sd">            irrigation demand</span>

<span class="sd">    Returns:</span>
<span class="sd">        reply (dict): A VQIP amount of irrigation demand (note only &#39;volume&#39; key </span>
<span class="sd">            is used)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#Calculate irrigation demand</span>
    <span class="n">irrigation_demand</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evaporation</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">precipitation</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">root_zone_depletion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cmd</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">root_zone_depletion</span> <span class="o">&lt;=</span> <span class="n">constants</span><span class="o">.</span><span class="n">FLOAT_ACCURACY</span><span class="p">:</span>
        <span class="c1">#TODO this isn&#39;t in FAO... but seems sensible</span>
        <span class="n">irrigation_demand</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1">#Reply as VQIP</span>
    <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
    <span class="n">reply</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">irrigation_demand</span>
    <span class="k">return</span> <span class="n">reply</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.land.GardenSurface.receive_irrigation_demand" class="doc doc-heading">
<code class="highlight language-python"><span class="n">receive_irrigation_demand</span><span class="p">(</span><span class="n">vqip</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>A set function (assigned by parent to push set from demand nodes) that assigns irrigation water supply to the surface tank</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>vqip</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>A VQIP amount of irrigation to receive</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>dict</code>
          </td>
          <td><p>A VQIP amount of irrigation that was not received (should always 
be empty)</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\land.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1685</span>
<span class="normal">1686</span>
<span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span>
<span class="normal">1691</span>
<span class="normal">1692</span>
<span class="normal">1693</span>
<span class="normal">1694</span>
<span class="normal">1695</span>
<span class="normal">1696</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">receive_irrigation_demand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vqip</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A set function (assigned by parent to push set from demand nodes) that assigns irrigation water supply to the surface tank</span>

<span class="sd">    Args:</span>
<span class="sd">        vqip (dict): A VQIP amount of irrigation to receive</span>

<span class="sd">    Returns:</span>
<span class="sd">        (dict): A VQIP amount of irrigation that was not received (should always </span>
<span class="sd">            be empty)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#update tank</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">vqip</span><span class="p">,</span> <span class="n">force</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="wsimod.nodes.land.GrowingSurface" class="doc doc-heading">
        <code>GrowingSurface</code>


</h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="wsimod.nodes.land.PerviousSurface" href="#wsimod.nodes.land.PerviousSurface">PerviousSurface</a></code></p>



        <details class="quote">
          <summary>Source code in <code>wsimod\nodes\land.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">GrowingSurface</span><span class="p">(</span><span class="n">PerviousSurface</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                       <span class="n">rooting_depth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="n">ET_depletion_factor</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="n">crop_factor_stages</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> 
                        <span class="n">crop_factor_stage_dates</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">365</span><span class="p">],</span> 
                        <span class="n">sowing_day</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="n">harvest_day</span> <span class="o">=</span> <span class="mi">365</span><span class="p">,</span>
                        <span class="n">initial_soil_storage</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                       <span class="o">**</span><span class="n">kwargs</span>
                        <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Extensive surface subclass that implements the CatchWat equations (Liu, </span>
<span class="sd">        Dobson &amp; Mijic (2022) Science of the total environment), which in turn are </span>
<span class="sd">        primarily based on FAO document: </span>
<span class="sd">        https://www.fao.org/3/x0490e/x0490e0ehtm#soil%20water%20availability. </span>
<span class="sd">        This surface is a pervious surface that also has things that grow on it. This </span>
<span class="sd">        behaviour includes soil nutrient pools, crop planting/harvest calendars, </span>
<span class="sd">        erosion, crop behaviour.</span>

<span class="sd">        A key complexity of this surface is the nutrient pool (see wsimod/nodes/</span>
<span class="sd">        nutrient_pool.py), which is a class that tracks the amount of phosphorus and </span>
<span class="sd">        nitrogen in different states and performs transformations that occur in the </span>
<span class="sd">        phosphorus/nitrogen cycle. It is assumed that the phosphate/nitrate/nitrite/</span>
<span class="sd">        ammonia amounts in this Surface tank should track the dissolved inorganic pool </span>
<span class="sd">        in the nutrient pool. Meanwhile, the org-phosphorus/org-nitrogen amounts in </span>
<span class="sd">        this tank should track the dissolved organic pool in the nutrient pool. The </span>
<span class="sd">        total amount of pollutants that enter this tank may not be the same as the </span>
<span class="sd">        total amount that leave, because pollutants are transformed between inorganic/</span>
<span class="sd">        organic and between wet/dry states - these transformations are accounted for </span>
<span class="sd">        in mass balance.</span>

<span class="sd">        For users to quickly enable/disable these nutrient processes, which are </span>
<span class="sd">        computationally intensive (in current case studies they account for about half </span>
<span class="sd">        of the total runtime), they are only active if &#39;nitrate&#39; is one of the </span>
<span class="sd">        modelled pollutants. Note that the code will not check if nitrite/phosphate/</span>
<span class="sd">        org-phosphorus/org-nitrogen/ammonia are also included, but they should be if nitrate is included and otherwise the code will crash with a key error.</span>

<span class="sd">        Args:</span>
<span class="sd">            rooting_depth (float, optional): Depth of the soil tank (i.e., how deep do </span>
<span class="sd">                crop roots go). Defaults to 1.</span>
<span class="sd">            ET_depletion_factor (float, optional): Average fraction of soil that can be </span>
<span class="sd">                depleted from the root zone before moisture stress (reduction in ET) </span>
<span class="sd">                occurs. Defaults to 1.</span>
<span class="sd">            crop_factor_stages (list, optional): Crop factor is a multiplier on et0, </span>
<span class="sd">                more grown plants have higher transpiration and higher crop factors.   </span>
<span class="sd">                This list shows changing crop factor at different times of year in </span>
<span class="sd">                relation to crop_factor_stage_dates. See wsimod/preprocessing/</span>
<span class="sd">                england_data_formatting.py/format_surfaces for further details on </span>
<span class="sd">                formulating these - since the interpolation used to find crop_factors </span>
<span class="sd">                in between the given values in the list is a bit involved. Defaults to </span>
<span class="sd">                [1,1].</span>
<span class="sd">            crop_factor_stage_dates (list, optional): Dates associated with </span>
<span class="sd">                crop_factor_stages. Defaults to [0, 365].</span>
<span class="sd">            sowing_day (int, optional): day of year that crops are sown. Defaults to 1.</span>
<span class="sd">            harvest_day (int, optional): day of year that crops are harvest. Defaults </span>
<span class="sd">                to 365.</span>
<span class="sd">            initial_soil_storage (dict or float, optional): Initial mass of solid pollutants</span>
<span class="sd">                in the soil nutrient pools (fast and adsorbed inorganic pools)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">#Crop factors (set when creating object)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ET_depletion_factor</span> <span class="o">=</span> <span class="n">ET_depletion_factor</span> <span class="c1">#To do with water availability, p from FAOSTAT</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rooting_depth</span> <span class="o">=</span> <span class="n">rooting_depth</span> <span class="c1">#maximum depth that plants can absorb, Zr from FAOSTAT</span>
        <span class="n">depth</span> <span class="o">=</span> <span class="n">rooting_depth</span>

        <span class="c1">#Crop parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">crop_cover_max</span> <span class="o">=</span> <span class="mf">0.9</span> <span class="c1"># [-] 0~1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ground_cover_max</span> <span class="o">=</span> <span class="mf">0.3</span> <span class="c1"># [-]</span>
        <span class="c1">#TODO... really I should just have this as an annual profile parameter and do away with interpolation etc.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">crop_factor_stages</span> <span class="o">=</span> <span class="n">crop_factor_stages</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">crop_factor_stage_dates</span> <span class="o">=</span> <span class="n">crop_factor_stage_dates</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sowing_day</span> <span class="o">=</span> <span class="n">sowing_day</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">harvest_day</span> <span class="o">=</span> <span class="n">harvest_day</span>

        <span class="c1">#Soil moisture dependence parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">satact</span> <span class="o">=</span> <span class="mf">0.6</span> <span class="c1"># [-] for calculating soil_moisture_dependence_factor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thetaupp</span> <span class="o">=</span> <span class="mf">0.12</span> <span class="c1"># [-] for calculating soil_moisture_dependence_factor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thetalow</span> <span class="o">=</span> <span class="mf">0.08</span> <span class="c1"># [-] for calculating soil_moisture_dependence_factor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thetapow</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># [-] for calculating soil_moisture_dependence_factorself.satact = 0.6 # [-] for calculating soil_moisture_dependence_factor</span>

        <span class="c1">#Crop uptake parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uptake1</span> <span class="o">=</span> <span class="mi">15</span> <span class="c1"># [g/m2/y] shape factor for crop (Dissolved) Inorganic nitrogen uptake</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uptake2</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># [-] shape factor for crop (Dissolved) Inorganic nitrogen uptake</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uptake3</span> <span class="o">=</span> <span class="mf">0.02</span> <span class="c1"># [1/day] shape factor for crop (Dissolved) Inorganic nitrogen uptake</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uptake_PNratio</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mf">7.2</span> <span class="c1"># [-] P:N during crop uptake</span>

        <span class="c1">#Erosion parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">erodibility</span> <span class="o">=</span> <span class="mf">0.0025</span> <span class="c1"># [g * d / (J * mm)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sreroexp</span> <span class="o">=</span> <span class="mf">1.2</span> <span class="c1"># [-] surface runoff erosion exponent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cohesion</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># [kPa]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slope</span> <span class="o">=</span> <span class="mi">5</span> <span class="c1"># [-] every 100</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">srfilt</span> <span class="o">=</span> <span class="mf">0.95</span> <span class="c1"># [-] ratio of eroded sediment left in surface runoff after filtration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">macrofilt</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="c1"># [-] ratio of eroded sediment left in subsurface flow after filtration</span>

        <span class="c1">#Denitrification parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">limpar</span> <span class="o">=</span> <span class="mf">0.7</span> <span class="c1"># [-] above which denitrification begins</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exppar</span> <span class="o">=</span> <span class="mf">2.5</span> <span class="c1"># [-] exponential parameter for soil_moisture_dependence_factor_exp calculation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hsatINs</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># [mg/l] for calculation of half-saturation concentration dependence factor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">denpar</span> <span class="o">=</span> <span class="mf">0.015</span> <span class="c1"># [-] denitrification rate coefficient</span>

        <span class="c1">#Adsorption parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">adosorption_nr_limit</span> <span class="o">=</span> <span class="mf">0.00001</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">adsorption_nr_maxiter</span> <span class="o">=</span> <span class="mi">20</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kfr</span> <span class="o">=</span> <span class="mf">153.7</span> <span class="c1"># [1/kg] freundlich adsorption isoterm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfr</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mf">2.6</span> <span class="c1"># [-] freundlich exponential coefficient</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kadsdes</span> <span class="o">=</span> <span class="mf">0.03</span> <span class="c1"># [1/day] adsorption/desorption coefficient</span>

        <span class="c1">#Other soil parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bulk_density</span> <span class="o">=</span> <span class="mi">1300</span> <span class="c1"># [kg/m3]        </span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">depth</span> <span class="o">=</span> <span class="n">depth</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1">#Infer basic sow/harvest calendar        </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">harvest_sow_calendar</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sowing_day</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">harvest_day</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">harvest_day</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">365</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ground_cover_stages</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ground_cover_max</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">crop_cover_stages</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">crop_cover_max</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1">#This is just based on googling when is autumn...</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sowing_day</span> <span class="o">&gt;</span> <span class="mi">265</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">autumn_sow</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">autumn_sow</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1">#State variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">days_after_sow</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">crop_cover</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ground_cover</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">crop_factor</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">et0_coefficient</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1">#Calculate parameters based on capacity/wp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_available_water</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">field_capacity</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">wilting_point</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_available_water</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;warning: TAW &lt; 0...&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">readily_available_water</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_available_water</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ET_depletion_factor</span>

        <span class="c1">#Initiliase nutrient pools</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span> <span class="o">=</span> <span class="n">NutrientPool</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">inflows</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_crop_cover</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;nitrate&#39;</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">POLLUTANTS</span><span class="p">:</span>
            <span class="c1">#Populate function lists </span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inflows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fertiliser</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inflows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">manure</span><span class="p">)</span>
            <span class="c1"># self.inflows.append(self.residue)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">processes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calc_temperature_dependence_factor</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">processes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calc_soil_moisture_dependence_factor</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">processes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">soil_pool_transformation</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">processes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calc_crop_uptake</span><span class="p">)</span>

            <span class="c1"># TODO possibly move these into nutrient pool</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">processes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">erosion</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">processes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">denitrification</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">processes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">adsorption</span><span class="p">)</span>

            <span class="c1">#Reflect initial water concentration in dissolved nutrient pools</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">dissolved_inorganic_pool</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;phosphate&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">dissolved_inorganic_pool</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;nitrate&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;ammonia&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;nitrite&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">dissolved_organic_pool</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;org-phosphorus&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">dissolved_organic_pool</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;org-nitrogen&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">initial_soil_storage</span><span class="p">:</span>
                <span class="c1">#Reflect initial nutrient stores in solid nutrient pools</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">adsorbed_inorganic_pool</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">initial_soil_storage</span><span class="p">[</span><span class="s1">&#39;phosphate&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">adsorbed_inorganic_pool</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">initial_soil_storage</span><span class="p">[</span><span class="s1">&#39;ammonia&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">initial_soil_storage</span><span class="p">[</span><span class="s1">&#39;nitrate&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">initial_soil_storage</span><span class="p">[</span><span class="s1">&#39;nitrite&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">fast_pool</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">initial_soil_storage</span><span class="p">[</span><span class="s1">&#39;org-nitrogen&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">fast_pool</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">initial_soil_storage</span><span class="p">[</span><span class="s1">&#39;org-phosphorus&#39;</span><span class="p">]</span>


    <span class="k">def</span> <span class="nf">pull_storage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vqip</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Pull water from the surface, updating the surface storage VQIP. Nutrient </span>
<span class="sd">        pool pollutants (nitrate/nitrite/ammonia/phosphate/org-phosphorus/</span>
<span class="sd">        org-nitrogen) are removed in proportion to their amounts in the dissolved </span>
<span class="sd">        nutrient pools, if they are simulated. Other pollutants are removed in proportion to their amount in the surface tank.</span>

<span class="sd">        Args:</span>
<span class="sd">            vqip (dict): VQIP amount to be pulled, (only &#39;volume&#39; key is needed)</span>

<span class="sd">        Returns:</span>
<span class="sd">            reply (dict): A VQIP amount successfully pulled from the tank</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>

        <span class="c1">#Adjust based on available volume</span>
        <span class="n">reply</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">])</span>

        <span class="c1">#Update reply to vqip (get concentration for non-nutrients)</span>
        <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_change_vqip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">,</span> <span class="n">reply</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;nitrate&#39;</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">POLLUTANTS</span><span class="p">:</span>
            <span class="c1">#Update nutrient pool and get concentration for nutrients</span>
            <span class="n">prop</span> <span class="o">=</span> <span class="n">reply</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span>
            <span class="n">nutrients</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">extract_dissolved</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>
            <span class="n">reply</span><span class="p">[</span><span class="s1">&#39;nitrate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nutrients</span><span class="p">[</span><span class="s1">&#39;inorganic&#39;</span><span class="p">][</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;nitrate&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;nitrate&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;ammonia&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;nitrite&#39;</span><span class="p">])</span>
            <span class="n">reply</span><span class="p">[</span><span class="s1">&#39;ammonia&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nutrients</span><span class="p">[</span><span class="s1">&#39;inorganic&#39;</span><span class="p">][</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;ammonia&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;nitrate&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;ammonia&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;nitrite&#39;</span><span class="p">])</span>
            <span class="n">reply</span><span class="p">[</span><span class="s1">&#39;nitrite&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nutrients</span><span class="p">[</span><span class="s1">&#39;inorganic&#39;</span><span class="p">][</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;nitrite&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;nitrate&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;ammonia&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;nitrite&#39;</span><span class="p">])</span>
            <span class="n">reply</span><span class="p">[</span><span class="s1">&#39;phosphate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nutrients</span><span class="p">[</span><span class="s1">&#39;inorganic&#39;</span><span class="p">][</span><span class="s1">&#39;P&#39;</span><span class="p">]</span>
            <span class="n">reply</span><span class="p">[</span><span class="s1">&#39;org-phosphorus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nutrients</span><span class="p">[</span><span class="s1">&#39;organic&#39;</span><span class="p">][</span><span class="s1">&#39;P&#39;</span><span class="p">]</span>
            <span class="n">reply</span><span class="p">[</span><span class="s1">&#39;org-nitrogen&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nutrients</span><span class="p">[</span><span class="s1">&#39;organic&#39;</span><span class="p">][</span><span class="s1">&#39;N&#39;</span><span class="p">]</span>

        <span class="c1">#Extract from storage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">storage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_vqip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">,</span> <span class="n">reply</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">reply</span>

    <span class="k">def</span> <span class="nf">quick_interp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">xp</span><span class="p">,</span> <span class="n">yp</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A simple version of np.interp to intepolate crop information on the fly</span>

<span class="sd">        Args:</span>
<span class="sd">            x (int): Current time (i.e., day of year)</span>
<span class="sd">            xp (list): Predefined times (i.e., list of days of year)</span>
<span class="sd">            yp (list): Predefined values associated with xp</span>

<span class="sd">        Returns:</span>
<span class="sd">            y (float): Interpolated value for current time</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x_ind</span> <span class="o">=</span> <span class="n">bisect_left</span><span class="p">(</span><span class="n">xp</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">x_left</span> <span class="o">=</span> <span class="n">xp</span><span class="p">[</span><span class="n">x_ind</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">x_right</span> <span class="o">=</span> <span class="n">xp</span><span class="p">[</span><span class="n">x_ind</span><span class="p">]</span>
        <span class="n">dif</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">x_left</span>
        <span class="n">y_left</span> <span class="o">=</span> <span class="n">yp</span><span class="p">[</span><span class="n">x_ind</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">y_right</span> <span class="o">=</span> <span class="n">yp</span><span class="p">[</span><span class="n">x_ind</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">y_left</span> <span class="o">+</span> <span class="p">(</span><span class="n">y_right</span> <span class="o">-</span> <span class="n">y_left</span><span class="p">)</span> <span class="o">*</span> <span class="n">dif</span> <span class="o">/</span> <span class="p">(</span><span class="n">x_right</span> <span class="o">-</span> <span class="n">x_left</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">y</span>

    <span class="k">def</span> <span class="nf">calc_crop_cover</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Process function that calculates how much crop cover there is, assigns </span>
<span class="sd">        whether crops are sown/harvested, and calculates et0_coefficient based on </span>
<span class="sd">        growth stage of crops.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (tuple): A tuple containing a VQIP amount for model inputs and outputs </span>
<span class="sd">                for mass balance checking. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#Get current day of year</span>
        <span class="n">doy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">dayofyear</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">is_leap_year</span><span class="p">:</span>
            <span class="c1">#Hacky way to handle leap years</span>
            <span class="k">if</span> <span class="n">doy</span> <span class="o">&gt;</span> <span class="mi">59</span><span class="p">:</span>
                <span class="n">doy</span> <span class="o">-=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">days_after_sow</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">dayofyear</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">sowing_day</span><span class="p">:</span>
                <span class="c1">#sow</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">days_after_sow</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">dayofyear</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">harvest_day</span><span class="p">:</span>
                <span class="c1">#harvest</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">days_after_sow</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">crop_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_factor_stages</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">crop_cover</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ground_cover</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1">#increment days since sow</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">days_after_sow</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1">#Calculate relevant parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">crop_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">quick_interp</span><span class="p">(</span><span class="n">doy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_factor_stage_dates</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_factor_stages</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">days_after_sow</span><span class="p">:</span>
            <span class="c1">#Move outside of this if, if you want nonzero crop/ground cover outside of season</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">crop_cover</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">quick_interp</span><span class="p">(</span><span class="n">doy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">harvest_sow_calendar</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_cover_stages</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ground_cover</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">quick_interp</span><span class="p">(</span><span class="n">doy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">harvest_sow_calendar</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ground_cover_stages</span><span class="p">)</span>

        <span class="n">root_zone_depletion</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">field_capacity</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_smc</span><span class="p">(),</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">root_zone_depletion</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">readily_available_water</span> <span class="p">:</span>
            <span class="n">crop_water_stress_coefficient</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">crop_water_stress_coefficient</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_available_water</span> <span class="o">-</span> <span class="n">root_zone_depletion</span><span class="p">)</span> <span class="o">/</span>\
                                                <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">ET_depletion_factor</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_available_water</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">et0_coefficient</span> <span class="o">=</span> <span class="n">crop_water_stress_coefficient</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_factor</span>

        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">())</span>


    <span class="k">def</span> <span class="nf">adjust_vqip_to_liquid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vqip</span><span class="p">,</span> <span class="n">deposition</span><span class="p">,</span> <span class="n">in_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Function to interoperate between surface tank and nutrient pool. Most </span>
<span class="sd">        depositions are given in terms of ammonia/nitrate/phosphate - they are then </span>
<span class="sd">        aggregated to total N or P to enter the nutrient pools. Depending on the </span>
<span class="sd">        source of deposition these may transform (e.g., some go to dissolved and some </span>
<span class="sd">        to solids) upon entering the nutrient pool. To reflect these transformations </span>
<span class="sd">        in the soil tank, the amounts entering the soil tank are adjusted </span>
<span class="sd">        proportionately.</span>

<span class="sd">        Args:</span>
<span class="sd">            vqip (dict): A VQIP amount of pollutants originally intended to enter the </span>
<span class="sd">                soil tank</span>
<span class="sd">            deposition (dict): A dict with nutrients (N and P) as keys, showing the </span>
<span class="sd">                total amount of nutrients entering the nutrient pool</span>
<span class="sd">            in_ (dict): A dict with nutrients as keys, showing the updated amount of </span>
<span class="sd">                nutrients that entered the nutrient pool as dissolved pollutants</span>

<span class="sd">        Returns:</span>
<span class="sd">            vqip (dict): A VQIP amount of pollutants that have been scaled to account </span>
<span class="sd">                for nutrient pool transformations</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;nitrate&#39;</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">POLLUTANTS</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">deposition</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;nitrate&#39;</span><span class="p">]</span> <span class="o">*=</span> <span class="p">(</span><span class="n">in_</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">deposition</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">])</span>
                <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;ammonia&#39;</span><span class="p">]</span> <span class="o">*=</span> <span class="p">(</span><span class="n">in_</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">deposition</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">])</span>
                <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;org-nitrogen&#39;</span><span class="p">]</span> <span class="o">*=</span> <span class="p">(</span><span class="n">in_</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">deposition</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">deposition</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;phosphate&#39;</span><span class="p">]</span> <span class="o">*=</span> <span class="p">(</span><span class="n">in_</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">deposition</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">])</span>
                <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;org-phosphorus&#39;</span><span class="p">]</span> <span class="o">*=</span> <span class="p">(</span><span class="n">in_</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">deposition</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">vqip</span>

    <span class="k">def</span> <span class="nf">fertiliser</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read, scale and allocate fertiliser, updating the tank</span>

<span class="sd">        Returns:</span>
<span class="sd">            (tuple): A tuple containing a VQIP amount for model inputs and outputs </span>
<span class="sd">                for mass balance checking. </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">#TODO tidy up fertiliser/manure/residue/deposition once preprocessing is sorted</span>

        <span class="c1">#Scale for surface</span>
        <span class="n">nhx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_input_surface</span><span class="p">(</span><span class="s1">&#39;nhx-fertiliser&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>
        <span class="n">noy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_input_surface</span><span class="p">(</span><span class="s1">&#39;noy-fertiliser&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>
        <span class="n">srp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_input_surface</span><span class="p">(</span><span class="s1">&#39;srp-fertiliser&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>

        <span class="c1">#Update as VQIP</span>
        <span class="n">vqip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
        <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;ammonia&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nhx</span>
        <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;nitrate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">noy</span>
        <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;phosphate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">srp</span>

        <span class="c1">#Enter nutrient pool</span>
        <span class="n">deposition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">get_empty_nutrient</span><span class="p">()</span>
        <span class="n">deposition</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;nitrate&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;ammonia&#39;</span><span class="p">]</span>
        <span class="n">deposition</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;phosphate&#39;</span><span class="p">]</span>
        <span class="n">in_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">allocate_fertiliser</span><span class="p">(</span><span class="n">deposition</span><span class="p">)</span>

        <span class="c1">#Update tank</span>
        <span class="n">vqip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adjust_vqip_to_liquid</span><span class="p">(</span><span class="n">vqip</span><span class="p">,</span> <span class="n">deposition</span><span class="p">,</span> <span class="n">in_</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">vqip</span><span class="p">,</span> <span class="n">force</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">vqip</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">manure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read, scale and allocate manure, updating the tank</span>

<span class="sd">        Returns:</span>
<span class="sd">            (tuple): A tuple containing a VQIP amount for model inputs and outputs </span>
<span class="sd">                for mass balance checking. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#Scale for surface</span>
        <span class="n">nhx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_input_surface</span><span class="p">(</span><span class="s1">&#39;nhx-manure&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>
        <span class="n">noy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_input_surface</span><span class="p">(</span><span class="s1">&#39;noy-manure&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>
        <span class="n">srp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_input_surface</span><span class="p">(</span><span class="s1">&#39;srp-manure&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>

        <span class="c1">#Formulate as VQIP</span>
        <span class="n">vqip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
        <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;ammonia&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nhx</span>
        <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;nitrate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">noy</span>
        <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;phosphate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">srp</span>

        <span class="c1">#Enter nutrient pool</span>
        <span class="n">deposition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">get_empty_nutrient</span><span class="p">()</span>
        <span class="n">deposition</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;nitrate&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;ammonia&#39;</span><span class="p">]</span>
        <span class="n">deposition</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;phosphate&#39;</span><span class="p">]</span>
        <span class="n">in_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">allocate_manure</span><span class="p">(</span><span class="n">deposition</span><span class="p">)</span>

        <span class="c1">#Update tank</span>
        <span class="n">vqip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adjust_vqip_to_liquid</span><span class="p">(</span><span class="n">vqip</span><span class="p">,</span> <span class="n">deposition</span><span class="p">,</span> <span class="n">in_</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">vqip</span><span class="p">,</span> <span class="n">force</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">vqip</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">residue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read, scale and allocate residue, updating the tank (NOT CURRENTLY USED </span>
<span class="sd">        BECAUSE NO DATA SOURCES FOR RESIDUE CAN BE IDENTIFIED)</span>

<span class="sd">        Returns:</span>
<span class="sd">            (tuple): A tuple containing a VQIP amount for model inputs and outputs </span>
<span class="sd">                for mass balance checking. </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">nhx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_input_surface</span><span class="p">(</span><span class="s1">&#39;nhx-residue&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>
        <span class="n">noy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_input_surface</span><span class="p">(</span><span class="s1">&#39;noy-residue&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>
        <span class="n">srp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_input_surface</span><span class="p">(</span><span class="s1">&#39;srp-residue&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>

        <span class="n">vqip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
        <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;ammonia&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nhx</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">fraction_residue_to_fast</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span>
        <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;nitrate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">noy</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">fraction_residue_to_fast</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span>
        <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;org-nitrogen&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">nhx</span> <span class="o">+</span> <span class="n">noy</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">fraction_residue_to_humus</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span>
        <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;phosphate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">srp</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">fraction_residue_to_fast</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span>
        <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;org-phosphorus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">srp</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">fraction_residue_to_humus</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span>

        <span class="n">deposition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">get_empty_nutrient</span><span class="p">()</span>
        <span class="n">deposition</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;nitrate&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;ammonia&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;org-nitrogen&#39;</span><span class="p">]</span>
        <span class="n">deposition</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;phosphate&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;org-phosphorus&#39;</span><span class="p">]</span>

        <span class="n">in_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">allocate_residue</span><span class="p">(</span><span class="n">deposition</span><span class="p">)</span>
        <span class="n">vqip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adjust_vqip_to_liquid</span><span class="p">(</span><span class="n">vqip</span><span class="p">,</span> <span class="n">deposition</span><span class="p">,</span> <span class="n">in_</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">vqip</span><span class="p">,</span> <span class="n">force</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">vqip</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">soil_pool_transformation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A process function that run transformation functions in the nutrient pool </span>
<span class="sd">        and updates the pollutant concentrations in the surface tank</span>

<span class="sd">        Returns:</span>
<span class="sd">            (tuple): A tuple containing a VQIP amount for model inputs and outputs </span>
<span class="sd">                for mass balance checking. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#Initialise mass balance tracking variables</span>
        <span class="n">in_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
        <span class="n">out_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>

        <span class="c1">#Get proportion of nitrogen that is nitrate in the soil tank</span>
        <span class="c1">#NOTE ignores nitrite - couldn&#39;t find enough information on it</span>
        <span class="n">nitrate_proportion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;nitrate&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;nitrate&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;ammonia&#39;</span><span class="p">])</span>

        <span class="c1">#Run soil pool functions</span>
        <span class="n">increase_in_dissolved_inorganic</span><span class="p">,</span> <span class="n">increase_in_dissolved_organic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">soil_pool_transformation</span><span class="p">()</span>

        <span class="c1">#Update tank and mass balance</span>
        <span class="c1">#TODO .. there is definitely a neater way to write  this</span>
        <span class="k">if</span> <span class="n">increase_in_dissolved_inorganic</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1">#Increase in inorganic nitrogen, rescale back to nitrate and ammonia</span>
            <span class="n">in_</span><span class="p">[</span><span class="s1">&#39;nitrate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">increase_in_dissolved_inorganic</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">nitrate_proportion</span>
            <span class="n">in_</span><span class="p">[</span><span class="s1">&#39;ammonia&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">increase_in_dissolved_inorganic</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">nitrate_proportion</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#Decrease in inorganic nitrogen, rescale back to nitrate and ammonia</span>
            <span class="n">out_</span><span class="p">[</span><span class="s1">&#39;nitrate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">increase_in_dissolved_inorganic</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">nitrate_proportion</span>
            <span class="n">out_</span><span class="p">[</span><span class="s1">&#39;ammonia&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">increase_in_dissolved_inorganic</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">nitrate_proportion</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">increase_in_dissolved_organic</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1">#Increase in organic nitrogen</span>
            <span class="n">in_</span><span class="p">[</span><span class="s1">&#39;org-nitrogen&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">increase_in_dissolved_organic</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#Decrease in organic nitrogen</span>
            <span class="n">out_</span><span class="p">[</span><span class="s1">&#39;org-nitrogen&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">increase_in_dissolved_organic</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">increase_in_dissolved_inorganic</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1">#Increase in inorganic phosphate</span>
            <span class="n">in_</span><span class="p">[</span><span class="s1">&#39;phosphate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">increase_in_dissolved_inorganic</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#Decrease in inorganic phosphate</span>
            <span class="n">out_</span><span class="p">[</span><span class="s1">&#39;phosphate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">increase_in_dissolved_inorganic</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">increase_in_dissolved_organic</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1">#Increase in organic phosphorus</span>
            <span class="n">in_</span><span class="p">[</span><span class="s1">&#39;org-phosphorus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">increase_in_dissolved_organic</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#Decrease in organic phosphorus</span>
            <span class="n">out_</span><span class="p">[</span><span class="s1">&#39;org-phosphorus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">increase_in_dissolved_organic</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span>

        <span class="c1">#Update tank with inputs/outputs of pollutants</span>
        <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">in_</span><span class="p">,</span> <span class="n">force</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">out2_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pull_pollutants</span><span class="p">(</span><span class="n">out_</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">compare_vqip</span><span class="p">(</span><span class="n">out_</span><span class="p">,</span> <span class="n">out2_</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;nutrient pool not tracking soil tank&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">in_</span><span class="p">,</span> <span class="n">out_</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">calc_temperature_dependence_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Process function that calculates the temperature dependence factor for the </span>
<span class="sd">        nutrient pool (which impacts soil pool transformations)</span>

<span class="sd">        Returns:</span>
<span class="sd">            (tuple): A tuple containing a VQIP amount for model inputs and outputs </span>
<span class="sd">                for mass balance checking. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#Parameters/equations from HYPE documentation</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">temperature_dependence_factor</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">**</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">20</span><span class="p">)</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">temperature_dependence_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">5</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">temperature_dependence_factor</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">temperature_dependence_factor</span> <span class="o">=</span> <span class="n">temperature_dependence_factor</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">calc_soil_moisture_dependence_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>        
        <span class="sd">&quot;&quot;&quot;Process function that calculates the soil moisture dependence factor for </span>
<span class="sd">        the nutrient pool (which impacts soil pool transformations)</span>

<span class="sd">        Returns:</span>
<span class="sd">            (tuple): A tuple containing a VQIP amount for model inputs and outputs </span>
<span class="sd">                for mass balance checking. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#Parameters/equations from HYPE documentation</span>
        <span class="n">current_soil_moisture</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_smc</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">current_soil_moisture</span>  <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_capacity</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">soil_moisture_dependence_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">satact</span>
        <span class="k">elif</span> <span class="n">current_soil_moisture</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wilting_point</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">soil_moisture_dependence_factor</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fc_diff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_capacity</span> <span class="o">-</span> <span class="n">current_soil_moisture</span>
            <span class="n">fc_comp</span> <span class="o">=</span> <span class="p">(</span><span class="n">fc_diff</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thetaupp</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">rooting_depth</span><span class="p">))</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">thetapow</span>
            <span class="n">fc_comp</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">satact</span><span class="p">)</span> <span class="o">*</span> <span class="n">fc_comp</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">satact</span>
            <span class="n">wp_diff</span> <span class="o">=</span> <span class="n">current_soil_moisture</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">wilting_point</span>
            <span class="n">wp_comp</span> <span class="o">=</span> <span class="p">(</span><span class="n">wp_diff</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thetalow</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">rooting_depth</span><span class="p">))</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">thetapow</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">soil_moisture_dependence_factor</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">wp_comp</span><span class="p">,</span> <span class="n">fc_comp</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">calc_crop_uptake</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Process function that calculates how much nutrient crops uptake and updates </span>
<span class="sd">        nutrient pool and surface tank</span>

<span class="sd">        Returns:</span>
<span class="sd">            (tuple): A tuple containing a VQIP amount for model inputs and outputs </span>
<span class="sd">                for mass balance checking. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#Parameters/equations from HYPE documentation</span>

        <span class="c1">#Initialise</span>
        <span class="n">N_common_uptake</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">P_common_uptake</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">days_after_sow</span><span class="p">:</span>
            <span class="c1">#If there are crops</span>

            <span class="n">days_after_sow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">days_after_sow</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">autumn_sow</span><span class="p">:</span>
                <span class="n">temp_func</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">5</span><span class="p">)</span> <span class="o">/</span> <span class="mi">20</span><span class="p">))</span>
                <span class="n">days_after_sow</span> <span class="o">-=</span> <span class="mi">25</span> <span class="c1">#Not sure why this is (but it&#39;s in HYPE)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">temp_func</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="c1">#Calculate uptake</span>
            <span class="n">uptake_par</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uptake1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">uptake2</span><span class="p">)</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">uptake3</span> <span class="o">*</span> <span class="n">days_after_sow</span><span class="p">)</span> <span class="o">*</span> <span class="n">temp_func</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">uptake_par</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">uptake2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">:</span>
                <span class="n">N_common_uptake</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uptake1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">uptake2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">uptake3</span> <span class="o">*</span> <span class="n">uptake_par</span> <span class="o">/</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">uptake2</span> <span class="o">+</span> <span class="n">uptake_par</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">N_common_uptake</span> <span class="o">*=</span> <span class="n">constants</span><span class="o">.</span><span class="n">G_M2_TO_KG_M2</span>
            <span class="n">P_common_uptake</span> <span class="o">=</span> <span class="n">N_common_uptake</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">uptake_PNratio</span>
            <span class="n">uptake</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;P&#39;</span> <span class="p">:</span> <span class="n">P_common_uptake</span><span class="p">,</span>
                      <span class="s1">&#39;N&#39;</span> <span class="p">:</span> <span class="n">N_common_uptake</span><span class="p">}</span>
            <span class="n">crop_uptake</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">dissolved_inorganic_pool</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">uptake</span><span class="p">)</span>
            <span class="n">out_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>

            <span class="c1"># Assuming plants eat N and P as nitrate and phosphate</span>
            <span class="n">out_</span><span class="p">[</span><span class="s1">&#39;nitrate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">crop_uptake</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> 
            <span class="n">out_</span><span class="p">[</span><span class="s1">&#39;phosphate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">crop_uptake</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> 

            <span class="n">out2_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pull_pollutants</span><span class="p">(</span><span class="n">out_</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">compare_vqip</span><span class="p">(</span><span class="n">out_</span><span class="p">,</span> <span class="n">out2_</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;nutrient pool not tracking soil tank&#39;</span><span class="p">)</span>

            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">(),</span> <span class="n">out_</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">erosion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Outflow function that erodes adsorbed/humus phosphorus and sediment and sends onwards to percolation/surface runoff/subsurface runoff</span>

<span class="sd">        Returns:</span>
<span class="sd">            (tuple): A tuple containing a VQIP amount for model inputs and outputs </span>
<span class="sd">                for mass balance checking. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#Parameters/equations from HYPE documentation (which explains why my documentation is a bit ambiguous - because theirs is too)</span>

        <span class="c1">#Convert precipitation to MM since all the equations assume that</span>
        <span class="n">precipitation_depth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_input</span><span class="p">(</span><span class="s1">&#39;precipitation&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="n">constants</span><span class="o">.</span><span class="n">M_TO_MM</span>

        <span class="c1">#Calculate how much rain is mobilising erosion</span>
        <span class="k">if</span> <span class="n">precipitation_depth</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">rainfall_energy</span> <span class="o">=</span> <span class="mf">8.95</span> <span class="o">+</span> <span class="mf">8.44</span> <span class="o">*</span> <span class="n">log10</span><span class="p">(</span><span class="n">precipitation_depth</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.257</span> <span class="o">+</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">constants</span><span class="o">.</span><span class="n">PI</span> <span class="o">*</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">dayofyear</span> <span class="o">-</span> <span class="mi">70</span><span class="p">)</span> <span class="o">/</span> <span class="mi">365</span><span class="p">))</span> <span class="o">*</span> <span class="mf">0.09</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">rainfall_energy</span> <span class="o">*=</span> <span class="n">precipitation_depth</span>
            <span class="n">mobilised_rain</span> <span class="o">=</span> <span class="n">rainfall_energy</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_cover</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">erodibility</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mobilised_rain</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1">#Calculate if any infiltration is mobilising erosion</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">infiltration_excess</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">mobilised_flow</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">infiltration_excess</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span> <span class="o">*</span> <span class="n">constants</span><span class="o">.</span><span class="n">M_TO_MM</span> <span class="o">*</span> <span class="mi">365</span><span class="p">)</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">sreroexp</span>
            <span class="n">mobilised_flow</span> <span class="o">*=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">ground_cover</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cohesion</span><span class="p">))</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slope</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span> <span class="o">/</span> <span class="mi">365</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mobilised_flow</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1">#Sum flows (not sure why surface runoff isn&#39;t included)</span>
        <span class="c1">#TODO I&#39;m pretty sure it should be included here</span>
        <span class="n">total_flows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infiltration_excess</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">subsurface_flow</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">percolation</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="c1">#m3/dt + self.tank_recharge[&#39;volume&#39;] (guess not needed)</span>

        <span class="c1">#Convert to MM/M2</span>
        <span class="n">erodingflow</span> <span class="o">=</span> <span class="n">total_flows</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span> <span class="o">*</span> <span class="n">constants</span><span class="o">.</span><span class="n">M_TO_MM</span>

        <span class="c1">#Calculate eroded sediment</span>
        <span class="n">transportfactor</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">erodingflow</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span> <span class="o">**</span> <span class="mf">1.3</span><span class="p">)</span>
        <span class="n">erodedsed</span> <span class="o">=</span> <span class="mi">1000</span> <span class="o">*</span> <span class="p">(</span><span class="n">mobilised_flow</span> <span class="o">+</span>  <span class="n">mobilised_rain</span><span class="p">)</span> <span class="o">*</span> <span class="n">transportfactor</span> <span class="c1"># [kg/km2]</span>
        <span class="c1">#TODO not sure what conversion this HYPE 1000 is referring to</span>

        <span class="c1"># soil erosion with adsorbed inorganic phosphorus and humus phosphorus (erodedP as P in eroded sediments and effect of enrichment)</span>
        <span class="k">if</span> <span class="n">erodingflow</span> <span class="o">&gt;</span> <span class="mi">4</span> <span class="p">:</span>
            <span class="n">enrichment</span> <span class="o">=</span> <span class="mf">1.5</span>
        <span class="k">elif</span> <span class="n">erodingflow</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">enrichment</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">-</span> <span class="p">(</span><span class="mi">4</span> <span class="o">-</span> <span class="mf">1.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">erodingflow</span> <span class="o">/</span> <span class="mi">4</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">())</span>

        <span class="c1">#Get erodable phosphorus</span>
        <span class="n">erodableP</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">get_erodable_P</span><span class="p">()</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span> <span class="o">*</span> <span class="n">constants</span><span class="o">.</span><span class="n">KG_M2_TO_KG_KM2</span>
        <span class="n">erodedP</span> <span class="o">=</span> <span class="n">erodedsed</span> <span class="o">*</span> <span class="p">(</span><span class="n">erodableP</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rooting_depth</span> <span class="o">*</span> <span class="n">constants</span><span class="o">.</span><span class="n">M_TO_KM</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">bulk_density</span> <span class="o">*</span> <span class="n">constants</span><span class="o">.</span><span class="n">KG_M3_TO_KG_KM3</span><span class="p">))</span> <span class="o">*</span> <span class="n">enrichment</span> <span class="c1"># [kg/km2]</span>

        <span class="c1">#Convert to kg</span>
        <span class="n">erodedP</span> <span class="o">*=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">area</span> <span class="o">*</span> <span class="n">constants</span><span class="o">.</span><span class="n">M2_TO_KM2</span><span class="p">)</span> <span class="c1"># [kg]</span>
        <span class="n">erodedsed</span> <span class="o">*=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">area</span> <span class="o">*</span> <span class="n">constants</span><span class="o">.</span><span class="n">M2_TO_KM2</span><span class="p">)</span> <span class="c1"># [kg]</span>

        <span class="c1">#Allocate to different flows</span>
        <span class="n">surface_erodedP</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">srfilt</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">infiltration_excess</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">total_flows</span> <span class="o">*</span> <span class="n">erodedP</span> <span class="c1"># [kg]</span>
        <span class="n">surface_erodedsed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">srfilt</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">infiltration_excess</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">total_flows</span> <span class="o">*</span> <span class="n">erodedsed</span> <span class="c1"># [kg]</span>

        <span class="n">subsurface_erodedP</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">macrofilt</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">subsurface_flow</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">total_flows</span> <span class="o">*</span> <span class="n">erodedP</span> <span class="c1"># [kg]</span>
        <span class="n">subsurface_erodedsed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">macrofilt</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">subsurface_flow</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">total_flows</span> <span class="o">*</span> <span class="n">erodedsed</span> <span class="c1"># [kg]</span>

        <span class="n">percolation_erodedP</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">macrofilt</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">percolation</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">total_flows</span> <span class="o">*</span> <span class="n">erodedP</span> <span class="c1"># [kg]</span>
        <span class="n">percolation_erodedsed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">macrofilt</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">percolation</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">total_flows</span> <span class="o">*</span> <span class="n">erodedsed</span> <span class="c1"># [kg]</span>

        <span class="c1">#Track mass balance</span>
        <span class="n">in_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>

        <span class="c1">#Total eroded phosphorus </span>
        <span class="n">eff_erodedP</span> <span class="o">=</span> <span class="n">percolation_erodedP</span> <span class="o">+</span> <span class="n">surface_erodedP</span> <span class="o">+</span> <span class="n">subsurface_erodedP</span> <span class="c1"># [kg]</span>
        <span class="k">if</span> <span class="n">eff_erodedP</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1">#Update nutrient pool</span>
            <span class="n">org_removed</span><span class="p">,</span> <span class="n">inorg_removed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">erode_P</span><span class="p">(</span><span class="n">eff_erodedP</span><span class="p">)</span>
            <span class="n">total_removed</span> <span class="o">=</span> <span class="n">inorg_removed</span> <span class="o">+</span> <span class="n">org_removed</span> 

            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">total_removed</span> <span class="o">-</span> <span class="n">eff_erodedP</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">constants</span><span class="o">.</span><span class="n">FLOAT_ACCURACY</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;weird nutrients&#39;</span><span class="p">)</span>

            <span class="c1">#scale flows to split between inorganic and organic eroded P  </span>
            <span class="bp">self</span><span class="o">.</span><span class="n">infiltration_excess</span><span class="p">[</span><span class="s1">&#39;org-phosphorus&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">surface_erodedP</span> <span class="o">*</span> <span class="n">org_removed</span> <span class="o">/</span> <span class="n">eff_erodedP</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">subsurface_flow</span><span class="p">[</span><span class="s1">&#39;org-phosphorus&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">subsurface_erodedP</span> <span class="o">*</span> <span class="n">org_removed</span> <span class="o">/</span> <span class="n">eff_erodedP</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">percolation</span><span class="p">[</span><span class="s1">&#39;org-phosphorus&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">percolation_erodedP</span> <span class="o">*</span> <span class="n">org_removed</span> <span class="o">/</span> <span class="n">eff_erodedP</span><span class="p">)</span>

            <span class="c1">#TODO Leon reckons this is conceptually dodgy.. but i&#39;m not sure where else adsorbed inorganic phosphorus should go</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">infiltration_excess</span><span class="p">[</span><span class="s1">&#39;phosphate&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">surface_erodedP</span> <span class="o">*</span> <span class="n">inorg_removed</span> <span class="o">/</span> <span class="n">eff_erodedP</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">subsurface_flow</span><span class="p">[</span><span class="s1">&#39;phosphate&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">subsurface_erodedP</span> <span class="o">*</span> <span class="n">inorg_removed</span> <span class="o">/</span> <span class="n">eff_erodedP</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">percolation</span><span class="p">[</span><span class="s1">&#39;phosphate&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">percolation_erodedP</span> <span class="o">*</span> <span class="n">inorg_removed</span> <span class="o">/</span> <span class="n">eff_erodedP</span><span class="p">)</span>

            <span class="c1">#Entering the model (no need to uptake surface tank because both adsorbed inorganic pool and humus pool are solids and so no tracked in the soil water tank)</span>
            <span class="n">in_</span><span class="p">[</span><span class="s1">&#39;phosphate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inorg_removed</span>
            <span class="n">in_</span><span class="p">[</span><span class="s1">&#39;org-phosphorus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">org_removed</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">inorg_to_org_P</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1">#Track sediment as solids</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">infiltration_excess</span><span class="p">[</span><span class="s1">&#39;solids&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">surface_erodedsed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subsurface_flow</span><span class="p">[</span><span class="s1">&#39;solids&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">subsurface_erodedsed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">percolation</span><span class="p">[</span><span class="s1">&#39;solids&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">percolation_erodedsed</span>


        <span class="n">in_</span><span class="p">[</span><span class="s1">&#39;solids&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">surface_erodedsed</span> <span class="o">+</span> <span class="n">subsurface_erodedsed</span> <span class="o">+</span> <span class="n">percolation_erodedsed</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">in_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">denitrification</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Outflow function that performs denitirication processes, updating nutrient pool and soil tank</span>

<span class="sd">        Returns:</span>
<span class="sd">            (tuple): A tuple containing a VQIP amount for model inputs and outputs </span>
<span class="sd">                for mass balance checking. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#Parameters/equations from HYPE documentation </span>
        <span class="c1">#TODO could more of this be moved to NutrientPool</span>
        <span class="c1">#Calculate soil moisture dependence of denitrification</span>
        <span class="n">soil_moisture_content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_smc</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">soil_moisture_content</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_capacity</span><span class="p">:</span>
            <span class="n">denitrifying_soil_moisture_dependence</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">soil_moisture_content</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_capacity</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">limpar</span><span class="p">:</span>
            <span class="n">denitrifying_soil_moisture_dependence</span> <span class="o">=</span> <span class="p">(((</span><span class="n">soil_moisture_content</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_capacity</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">limpar</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">limpar</span><span class="p">))</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">exppar</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">denitrifying_soil_moisture_dependence</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">())</span>

        <span class="c1">#Get dissolved inorg nitrogen as a concentration and calculate factor</span>
        <span class="n">din_conc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">dissolved_inorganic_pool</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="c1"># [kg/m3]</span>
        <span class="n">din_conc</span> <span class="o">*=</span> <span class="n">constants</span><span class="o">.</span><span class="n">KG_M3_TO_MG_L</span>
        <span class="n">half_saturation_concentration_dependence_factor</span> <span class="o">=</span> <span class="n">din_conc</span> <span class="o">/</span> <span class="p">(</span><span class="n">din_conc</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsatINs</span><span class="p">)</span>

        <span class="c1">#Calculate and extract dentrified nitrogen</span>
        <span class="n">denitrified_N</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">dissolved_inorganic_pool</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">*</span>\
                            <span class="n">half_saturation_concentration_dependence_factor</span> <span class="o">*</span>\
                                <span class="n">denitrifying_soil_moisture_dependence</span> <span class="o">*</span>\
                                    <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">temperature_dependence_factor</span> <span class="o">*</span>\
                                        <span class="bp">self</span><span class="o">.</span><span class="n">denpar</span>
        <span class="n">denitrified_request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">get_empty_nutrient</span><span class="p">()</span>
        <span class="n">denitrified_request</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">denitrified_N</span>
        <span class="n">denitrified_N</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">dissolved_inorganic_pool</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">denitrified_request</span><span class="p">)</span>

        <span class="c1">#Leon reckons this should leave the model (though I think technically some small amount goes to nitrite)</span>
        <span class="n">out_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
        <span class="n">out_</span><span class="p">[</span><span class="s1">&#39;nitrate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">denitrified_N</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> 

        <span class="c1">#Update tank</span>
        <span class="n">out2_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pull_pollutants</span><span class="p">(</span><span class="n">out_</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">compare_vqip</span><span class="p">(</span><span class="n">out_</span><span class="p">,</span> <span class="n">out2_</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;nutrient pool not tracking soil tank&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">(),</span> <span class="n">out_</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">adsorption</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Outflow function that calculates phosphorus adsorption/desorptions and </span>
<span class="sd">        updates soil tank and nutrient pools</span>

<span class="sd">        Returns:</span>
<span class="sd">            (tuple): A tuple containing a VQIP amount for model inputs and outputs </span>
<span class="sd">                for mass balance checking. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#Parameters/equations from HYPE documentation </span>
        <span class="c1">#TODO could this be moved to the nutrient pool?</span>

        <span class="c1">#Initialise mass balance checking</span>
        <span class="n">in_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
        <span class="n">out_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>

        <span class="c1">#Get total phosphorus in pool available for adsorption/desorption</span>
        <span class="n">limit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adosorption_nr_limit</span>
        <span class="n">ad_de_P_pool</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">adsorbed_inorganic_pool</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">dissolved_inorganic_pool</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="c1"># [kg]</span>
        <span class="n">ad_de_P_pool</span> <span class="o">/=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">area</span> <span class="o">*</span> <span class="n">constants</span><span class="o">.</span><span class="n">M2_TO_KM2</span><span class="p">)</span> <span class="c1"># [kg/km2]</span>
        <span class="k">if</span> <span class="n">ad_de_P_pool</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">())</span>

        <span class="c1">#Calculate coefficient and concentration of adsorbed phosphorus</span>
        <span class="n">soil_moisture_content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_smc</span><span class="p">()</span> <span class="o">*</span> <span class="n">constants</span><span class="o">.</span><span class="n">M_TO_MM</span> <span class="c1"># [mm] (not sure why HYPE has this in mm but whatever)</span>
        <span class="n">conc_sol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">adsorbed_inorganic_pool</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">constants</span><span class="o">.</span><span class="n">KG_TO_MG</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bulk_density</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">rooting_depth</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span><span class="p">)</span><span class="c1"># [mg P/kg soil]</span>
        <span class="n">coeff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kfr</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">bulk_density</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">rooting_depth</span> <span class="o">*</span> <span class="n">constants</span><span class="o">.</span><span class="n">M_TO_MM</span> <span class="c1"># [mm]</span>

        <span class="c1"># calculate equilibrium concentration</span>
        <span class="k">if</span> <span class="n">conc_sol</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="p">:</span>
            <span class="c1">#Not sure how this would happen</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: soil partP &lt;=0. Freundlich will give error, take shortcut.&#39;</span><span class="p">)</span>
            <span class="n">xn_1</span> <span class="o">=</span> <span class="n">ad_de_P_pool</span> <span class="o">/</span> <span class="p">(</span><span class="n">soil_moisture_content</span> <span class="o">+</span> <span class="n">coeff</span><span class="p">)</span> <span class="c1"># [mg/l]</span>
            <span class="n">ad_P_equi_conc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kfr</span> <span class="o">*</span> <span class="n">xn_1</span>   <span class="c1"># [mg/ kg]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Newton-Raphson method</span>
            <span class="n">x0</span> <span class="o">=</span> <span class="n">exp</span><span class="p">((</span><span class="n">log</span><span class="p">(</span><span class="n">conc_sol</span><span class="p">)</span> <span class="o">-</span> <span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kfr</span><span class="p">))</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">nfr</span><span class="p">)</span> <span class="c1"># initial guess of equilibrium liquid concentration</span>
            <span class="n">fxn</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">*</span> <span class="n">soil_moisture_content</span> <span class="o">+</span> <span class="n">coeff</span> <span class="o">*</span> <span class="p">(</span><span class="n">x0</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">nfr</span><span class="p">)</span> <span class="o">-</span> <span class="n">ad_de_P_pool</span>
            <span class="n">xn</span> <span class="o">=</span> <span class="n">x0</span>
            <span class="n">xn_1</span> <span class="o">=</span> <span class="n">xn</span>
            <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">fxn</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">limit</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">adsorption_nr_maxiter</span><span class="p">)</span> <span class="p">:</span> <span class="c1"># iteration to calculate equilibrium concentations</span>
                <span class="n">fxn</span> <span class="o">=</span> <span class="n">xn</span> <span class="o">*</span> <span class="n">soil_moisture_content</span> <span class="o">+</span> <span class="n">coeff</span> <span class="o">*</span> <span class="p">(</span><span class="n">xn</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">nfr</span><span class="p">)</span> <span class="o">-</span> <span class="n">ad_de_P_pool</span>
                <span class="n">fprimxn</span> <span class="o">=</span> <span class="n">soil_moisture_content</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">nfr</span> <span class="o">*</span> <span class="n">coeff</span> <span class="o">*</span> <span class="p">(</span><span class="n">xn</span> <span class="o">**</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nfr</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
                <span class="n">dx</span> <span class="o">=</span> <span class="n">fxn</span> <span class="o">/</span> <span class="n">fprimxn</span>
                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mf">0.000001</span> <span class="o">*</span> <span class="n">xn</span><span class="p">):</span>
                    <span class="c1">#From HYPE... not sure what it means</span>
                    <span class="k">break</span>
                <span class="n">xn_1</span> <span class="o">=</span> <span class="n">xn</span> <span class="o">-</span> <span class="n">dx</span>
                <span class="k">if</span> <span class="n">xn_1</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="p">:</span>
                    <span class="n">xn_1</span> <span class="o">=</span> <span class="mf">1e-10</span>
                <span class="n">xn</span> <span class="o">=</span> <span class="n">xn_1</span>
                <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">ad_P_equi_conc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kfr</span> <span class="o">*</span> <span class="p">(</span><span class="n">xn_1</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">nfr</span><span class="p">)</span>
            <span class="c1">#print(ad_P_equi_conc, conc_sol)</span>

        <span class="c1"># Calculate new pool and concentration, depends on the equilibrium concentration</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ad_P_equi_conc</span> <span class="o">-</span> <span class="n">conc_sol</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1e-6</span> <span class="p">:</span>
            <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">get_empty_nutrient</span><span class="p">()</span>

            <span class="c1">#TODO not sure about this if statement, surely it would be triggered every time</span>
            <span class="n">adsdes</span> <span class="o">=</span> <span class="p">(</span><span class="n">ad_P_equi_conc</span> <span class="o">-</span> <span class="n">conc_sol</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">kadsdes</span><span class="p">))</span> <span class="c1"># kinetic adsorption/desorption</span>
            <span class="n">request</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">adsdes</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">bulk_density</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">rooting_depth</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">area</span> <span class="o">*</span> <span class="n">constants</span><span class="o">.</span><span class="n">M2_TO_KM2</span><span class="p">)</span> <span class="c1"># [kg]</span>
            <span class="k">if</span> <span class="n">request</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1">#Adsorption</span>
                <span class="n">adsorbed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">dissolved_inorganic_pool</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">adsorbed</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">request</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">constants</span><span class="o">.</span><span class="n">FLOAT_ACCURACY</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: freundlich flow adjusted, was larger than pool&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">adsorbed_inorganic_pool</span><span class="o">.</span><span class="n">receive</span><span class="p">(</span><span class="n">adsorbed</span><span class="p">)</span>

                <span class="c1">#Dissolved leaving the soil water tank and becoming solid</span>
                <span class="n">out_</span><span class="p">[</span><span class="s1">&#39;phosphate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">adsorbed</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span>

                <span class="c1">#Update tank</span>
                <span class="n">out2_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pull_pollutants</span><span class="p">(</span><span class="n">out_</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">compare_vqip</span><span class="p">(</span><span class="n">out_</span><span class="p">,</span> <span class="n">out2_</span><span class="p">):</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;nutrient pool not tracking soil tank&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1">#Desorption</span>
                <span class="n">request</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">request</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span>
                <span class="n">desorbed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">adsorbed_inorganic_pool</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">desorbed</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">request</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">constants</span><span class="o">.</span><span class="n">FLOAT_ACCURACY</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: freundlich flow adjusted, was larger than pool&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">dissolved_inorganic_pool</span><span class="o">.</span><span class="n">receive</span><span class="p">(</span><span class="n">desorbed</span><span class="p">)</span>

                <span class="c1">#Solid phosphorus becoming inorganic P in the soil water tank</span>
                <span class="n">in_</span><span class="p">[</span><span class="s1">&#39;phosphate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">desorbed</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span>
                <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">in_</span><span class="p">,</span> <span class="n">force</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">in_</span><span class="p">,</span> <span class="n">out_</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">dry_deposition_to_tank</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vqip</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Allocate dry deposition to surface tank, updating nutrient pool accordingly.</span>

<span class="sd">        Args:</span>
<span class="sd">            vqip (dict): A VQIP amount of dry deposition to send to tank</span>

<span class="sd">        Returns:</span>
<span class="sd">            vqip (dict): A VQIP amount of dry deposition that entered the tank (used </span>
<span class="sd">                for mass balance checking)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">#Convert to nutrients</span>
        <span class="n">deposition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">get_empty_nutrient</span><span class="p">()</span>
        <span class="n">deposition</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;nitrate&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;ammonia&#39;</span><span class="p">]</span>
        <span class="n">deposition</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;phosphate&#39;</span><span class="p">]</span>

        <span class="c1">#Update nutrient pool</span>
        <span class="n">in_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">allocate_dry_deposition</span><span class="p">(</span><span class="n">deposition</span><span class="p">)</span>
        <span class="n">vqip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adjust_vqip_to_liquid</span><span class="p">(</span><span class="n">vqip</span><span class="p">,</span> <span class="n">deposition</span><span class="p">,</span> <span class="n">in_</span><span class="p">)</span>

        <span class="c1">#Update tank</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">vqip</span><span class="p">,</span> <span class="n">force</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">vqip</span>

    <span class="k">def</span> <span class="nf">wet_deposition_to_tank</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vqip</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Allocate wet deposition to surface tank, updating nutrient pool accordingly.</span>

<span class="sd">        Args:</span>
<span class="sd">            vqip (dict): A VQIP amount of dry deposition to send to tank</span>

<span class="sd">        Returns:</span>
<span class="sd">            vqip (dict): A VQIP amount of dry deposition that entered the tank (used </span>
<span class="sd">                for mass balance checking)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#Convert to nutrients</span>
        <span class="n">deposition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">get_empty_nutrient</span><span class="p">()</span>
        <span class="n">deposition</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;nitrate&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;ammonia&#39;</span><span class="p">]</span>
        <span class="n">deposition</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;phosphate&#39;</span><span class="p">]</span>

        <span class="c1">#Update nutrient pool</span>
        <span class="n">in_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">allocate_wet_deposition</span><span class="p">(</span><span class="n">deposition</span><span class="p">)</span>
        <span class="n">vqip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adjust_vqip_to_liquid</span><span class="p">(</span><span class="n">vqip</span><span class="p">,</span> <span class="n">deposition</span><span class="p">,</span> <span class="n">in_</span><span class="p">)</span>

        <span class="c1">#Update tank</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">vqip</span><span class="p">,</span> <span class="n">force</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">vqip</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.land.GrowingSurface.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">rooting_depth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ET_depletion_factor</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">crop_factor_stages</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">crop_factor_stage_dates</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">365</span><span class="p">],</span> <span class="n">sowing_day</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">harvest_day</span><span class="o">=</span><span class="mi">365</span><span class="p">,</span> <span class="n">initial_soil_storage</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Extensive surface subclass that implements the CatchWat equations (Liu, 
Dobson &amp; Mijic (2022) Science of the total environment), which in turn are 
primarily based on FAO document: 
https://www.fao.org/3/x0490e/x0490e0ehtm#soil%20water%20availability. 
This surface is a pervious surface that also has things that grow on it. This 
behaviour includes soil nutrient pools, crop planting/harvest calendars, 
erosion, crop behaviour.</p>
<p>A key complexity of this surface is the nutrient pool (see wsimod/nodes/
nutrient_pool.py), which is a class that tracks the amount of phosphorus and 
nitrogen in different states and performs transformations that occur in the 
phosphorus/nitrogen cycle. It is assumed that the phosphate/nitrate/nitrite/
ammonia amounts in this Surface tank should track the dissolved inorganic pool 
in the nutrient pool. Meanwhile, the org-phosphorus/org-nitrogen amounts in 
this tank should track the dissolved organic pool in the nutrient pool. The 
total amount of pollutants that enter this tank may not be the same as the 
total amount that leave, because pollutants are transformed between inorganic/
organic and between wet/dry states - these transformations are accounted for 
in mass balance.</p>
<p>For users to quickly enable/disable these nutrient processes, which are 
computationally intensive (in current case studies they account for about half 
of the total runtime), they are only active if 'nitrate' is one of the 
modelled pollutants. Note that the code will not check if nitrite/phosphate/
org-phosphorus/org-nitrogen/ammonia are also included, but they should be if nitrate is included and otherwise the code will crash with a key error.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>rooting_depth</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Depth of the soil tank (i.e., how deep do 
crop roots go). Defaults to 1.</p></td>
          <td>
                <code>1</code>
          </td>
        </tr>
        <tr>
          <td><code>ET_depletion_factor</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Average fraction of soil that can be 
depleted from the root zone before moisture stress (reduction in ET) 
occurs. Defaults to 1.</p></td>
          <td>
                <code>1</code>
          </td>
        </tr>
        <tr>
          <td><code>crop_factor_stages</code></td>
          <td>
                <code>list</code>
          </td>
          <td><p>Crop factor is a multiplier on et0, 
more grown plants have higher transpiration and higher crop factors. <br />
This list shows changing crop factor at different times of year in 
relation to crop_factor_stage_dates. See wsimod/preprocessing/
england_data_formatting.py/format_surfaces for further details on 
formulating these - since the interpolation used to find crop_factors 
in between the given values in the list is a bit involved. Defaults to 
[1,1].</p></td>
          <td>
                <code>[1, 1]</code>
          </td>
        </tr>
        <tr>
          <td><code>crop_factor_stage_dates</code></td>
          <td>
                <code>list</code>
          </td>
          <td><p>Dates associated with 
crop_factor_stages. Defaults to [0, 365].</p></td>
          <td>
                <code>[0, 365]</code>
          </td>
        </tr>
        <tr>
          <td><code>sowing_day</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>day of year that crops are sown. Defaults to 1.</p></td>
          <td>
                <code>1</code>
          </td>
        </tr>
        <tr>
          <td><code>harvest_day</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>day of year that crops are harvest. Defaults 
to 365.</p></td>
          <td>
                <code>365</code>
          </td>
        </tr>
        <tr>
          <td><code>initial_soil_storage</code></td>
          <td>
                <code>dict or float</code>
          </td>
          <td><p>Initial mass of solid pollutants
in the soil nutrient pools (fast and adsorbed inorganic pools)</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\land.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                   <span class="n">rooting_depth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="n">ET_depletion_factor</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="n">crop_factor_stages</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> 
                    <span class="n">crop_factor_stage_dates</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">365</span><span class="p">],</span> 
                    <span class="n">sowing_day</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="n">harvest_day</span> <span class="o">=</span> <span class="mi">365</span><span class="p">,</span>
                    <span class="n">initial_soil_storage</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                   <span class="o">**</span><span class="n">kwargs</span>
                    <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Extensive surface subclass that implements the CatchWat equations (Liu, </span>
<span class="sd">    Dobson &amp; Mijic (2022) Science of the total environment), which in turn are </span>
<span class="sd">    primarily based on FAO document: </span>
<span class="sd">    https://www.fao.org/3/x0490e/x0490e0ehtm#soil%20water%20availability. </span>
<span class="sd">    This surface is a pervious surface that also has things that grow on it. This </span>
<span class="sd">    behaviour includes soil nutrient pools, crop planting/harvest calendars, </span>
<span class="sd">    erosion, crop behaviour.</span>

<span class="sd">    A key complexity of this surface is the nutrient pool (see wsimod/nodes/</span>
<span class="sd">    nutrient_pool.py), which is a class that tracks the amount of phosphorus and </span>
<span class="sd">    nitrogen in different states and performs transformations that occur in the </span>
<span class="sd">    phosphorus/nitrogen cycle. It is assumed that the phosphate/nitrate/nitrite/</span>
<span class="sd">    ammonia amounts in this Surface tank should track the dissolved inorganic pool </span>
<span class="sd">    in the nutrient pool. Meanwhile, the org-phosphorus/org-nitrogen amounts in </span>
<span class="sd">    this tank should track the dissolved organic pool in the nutrient pool. The </span>
<span class="sd">    total amount of pollutants that enter this tank may not be the same as the </span>
<span class="sd">    total amount that leave, because pollutants are transformed between inorganic/</span>
<span class="sd">    organic and between wet/dry states - these transformations are accounted for </span>
<span class="sd">    in mass balance.</span>

<span class="sd">    For users to quickly enable/disable these nutrient processes, which are </span>
<span class="sd">    computationally intensive (in current case studies they account for about half </span>
<span class="sd">    of the total runtime), they are only active if &#39;nitrate&#39; is one of the </span>
<span class="sd">    modelled pollutants. Note that the code will not check if nitrite/phosphate/</span>
<span class="sd">    org-phosphorus/org-nitrogen/ammonia are also included, but they should be if nitrate is included and otherwise the code will crash with a key error.</span>

<span class="sd">    Args:</span>
<span class="sd">        rooting_depth (float, optional): Depth of the soil tank (i.e., how deep do </span>
<span class="sd">            crop roots go). Defaults to 1.</span>
<span class="sd">        ET_depletion_factor (float, optional): Average fraction of soil that can be </span>
<span class="sd">            depleted from the root zone before moisture stress (reduction in ET) </span>
<span class="sd">            occurs. Defaults to 1.</span>
<span class="sd">        crop_factor_stages (list, optional): Crop factor is a multiplier on et0, </span>
<span class="sd">            more grown plants have higher transpiration and higher crop factors.   </span>
<span class="sd">            This list shows changing crop factor at different times of year in </span>
<span class="sd">            relation to crop_factor_stage_dates. See wsimod/preprocessing/</span>
<span class="sd">            england_data_formatting.py/format_surfaces for further details on </span>
<span class="sd">            formulating these - since the interpolation used to find crop_factors </span>
<span class="sd">            in between the given values in the list is a bit involved. Defaults to </span>
<span class="sd">            [1,1].</span>
<span class="sd">        crop_factor_stage_dates (list, optional): Dates associated with </span>
<span class="sd">            crop_factor_stages. Defaults to [0, 365].</span>
<span class="sd">        sowing_day (int, optional): day of year that crops are sown. Defaults to 1.</span>
<span class="sd">        harvest_day (int, optional): day of year that crops are harvest. Defaults </span>
<span class="sd">            to 365.</span>
<span class="sd">        initial_soil_storage (dict or float, optional): Initial mass of solid pollutants</span>
<span class="sd">            in the soil nutrient pools (fast and adsorbed inorganic pools)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#Crop factors (set when creating object)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ET_depletion_factor</span> <span class="o">=</span> <span class="n">ET_depletion_factor</span> <span class="c1">#To do with water availability, p from FAOSTAT</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">rooting_depth</span> <span class="o">=</span> <span class="n">rooting_depth</span> <span class="c1">#maximum depth that plants can absorb, Zr from FAOSTAT</span>
    <span class="n">depth</span> <span class="o">=</span> <span class="n">rooting_depth</span>

    <span class="c1">#Crop parameters</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">crop_cover_max</span> <span class="o">=</span> <span class="mf">0.9</span> <span class="c1"># [-] 0~1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ground_cover_max</span> <span class="o">=</span> <span class="mf">0.3</span> <span class="c1"># [-]</span>
    <span class="c1">#TODO... really I should just have this as an annual profile parameter and do away with interpolation etc.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">crop_factor_stages</span> <span class="o">=</span> <span class="n">crop_factor_stages</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">crop_factor_stage_dates</span> <span class="o">=</span> <span class="n">crop_factor_stage_dates</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sowing_day</span> <span class="o">=</span> <span class="n">sowing_day</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">harvest_day</span> <span class="o">=</span> <span class="n">harvest_day</span>

    <span class="c1">#Soil moisture dependence parameters</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">satact</span> <span class="o">=</span> <span class="mf">0.6</span> <span class="c1"># [-] for calculating soil_moisture_dependence_factor</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">thetaupp</span> <span class="o">=</span> <span class="mf">0.12</span> <span class="c1"># [-] for calculating soil_moisture_dependence_factor</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">thetalow</span> <span class="o">=</span> <span class="mf">0.08</span> <span class="c1"># [-] for calculating soil_moisture_dependence_factor</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">thetapow</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># [-] for calculating soil_moisture_dependence_factorself.satact = 0.6 # [-] for calculating soil_moisture_dependence_factor</span>

    <span class="c1">#Crop uptake parameters</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">uptake1</span> <span class="o">=</span> <span class="mi">15</span> <span class="c1"># [g/m2/y] shape factor for crop (Dissolved) Inorganic nitrogen uptake</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">uptake2</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># [-] shape factor for crop (Dissolved) Inorganic nitrogen uptake</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">uptake3</span> <span class="o">=</span> <span class="mf">0.02</span> <span class="c1"># [1/day] shape factor for crop (Dissolved) Inorganic nitrogen uptake</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">uptake_PNratio</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mf">7.2</span> <span class="c1"># [-] P:N during crop uptake</span>

    <span class="c1">#Erosion parameters</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">erodibility</span> <span class="o">=</span> <span class="mf">0.0025</span> <span class="c1"># [g * d / (J * mm)]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sreroexp</span> <span class="o">=</span> <span class="mf">1.2</span> <span class="c1"># [-] surface runoff erosion exponent</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cohesion</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># [kPa]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">slope</span> <span class="o">=</span> <span class="mi">5</span> <span class="c1"># [-] every 100</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">srfilt</span> <span class="o">=</span> <span class="mf">0.95</span> <span class="c1"># [-] ratio of eroded sediment left in surface runoff after filtration</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">macrofilt</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="c1"># [-] ratio of eroded sediment left in subsurface flow after filtration</span>

    <span class="c1">#Denitrification parameters</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">limpar</span> <span class="o">=</span> <span class="mf">0.7</span> <span class="c1"># [-] above which denitrification begins</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">exppar</span> <span class="o">=</span> <span class="mf">2.5</span> <span class="c1"># [-] exponential parameter for soil_moisture_dependence_factor_exp calculation</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">hsatINs</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># [mg/l] for calculation of half-saturation concentration dependence factor</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">denpar</span> <span class="o">=</span> <span class="mf">0.015</span> <span class="c1"># [-] denitrification rate coefficient</span>

    <span class="c1">#Adsorption parameters</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">adosorption_nr_limit</span> <span class="o">=</span> <span class="mf">0.00001</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">adsorption_nr_maxiter</span> <span class="o">=</span> <span class="mi">20</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kfr</span> <span class="o">=</span> <span class="mf">153.7</span> <span class="c1"># [1/kg] freundlich adsorption isoterm</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nfr</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mf">2.6</span> <span class="c1"># [-] freundlich exponential coefficient</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kadsdes</span> <span class="o">=</span> <span class="mf">0.03</span> <span class="c1"># [1/day] adsorption/desorption coefficient</span>

    <span class="c1">#Other soil parameters</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bulk_density</span> <span class="o">=</span> <span class="mi">1300</span> <span class="c1"># [kg/m3]        </span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">depth</span> <span class="o">=</span> <span class="n">depth</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1">#Infer basic sow/harvest calendar        </span>
    <span class="bp">self</span><span class="o">.</span><span class="n">harvest_sow_calendar</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sowing_day</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">harvest_day</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">harvest_day</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">365</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ground_cover_stages</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ground_cover_max</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">crop_cover_stages</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">crop_cover_max</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1">#This is just based on googling when is autumn...</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sowing_day</span> <span class="o">&gt;</span> <span class="mi">265</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">autumn_sow</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">autumn_sow</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1">#State variables</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">days_after_sow</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">crop_cover</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ground_cover</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">crop_factor</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">et0_coefficient</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="c1">#Calculate parameters based on capacity/wp</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">total_available_water</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">field_capacity</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">wilting_point</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_available_water</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;warning: TAW &lt; 0...&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">readily_available_water</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_available_water</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ET_depletion_factor</span>

    <span class="c1">#Initiliase nutrient pools</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span> <span class="o">=</span> <span class="n">NutrientPool</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">inflows</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_crop_cover</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;nitrate&#39;</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">POLLUTANTS</span><span class="p">:</span>
        <span class="c1">#Populate function lists </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inflows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fertiliser</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inflows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">manure</span><span class="p">)</span>
        <span class="c1"># self.inflows.append(self.residue)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">processes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calc_temperature_dependence_factor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calc_soil_moisture_dependence_factor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">soil_pool_transformation</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calc_crop_uptake</span><span class="p">)</span>

        <span class="c1"># TODO possibly move these into nutrient pool</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">erosion</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">denitrification</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">adsorption</span><span class="p">)</span>

        <span class="c1">#Reflect initial water concentration in dissolved nutrient pools</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">dissolved_inorganic_pool</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;phosphate&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">dissolved_inorganic_pool</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;nitrate&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;ammonia&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;nitrite&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">dissolved_organic_pool</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;org-phosphorus&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">dissolved_organic_pool</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;org-nitrogen&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">initial_soil_storage</span><span class="p">:</span>
            <span class="c1">#Reflect initial nutrient stores in solid nutrient pools</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">adsorbed_inorganic_pool</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">initial_soil_storage</span><span class="p">[</span><span class="s1">&#39;phosphate&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">adsorbed_inorganic_pool</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">initial_soil_storage</span><span class="p">[</span><span class="s1">&#39;ammonia&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">initial_soil_storage</span><span class="p">[</span><span class="s1">&#39;nitrate&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">initial_soil_storage</span><span class="p">[</span><span class="s1">&#39;nitrite&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">fast_pool</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">initial_soil_storage</span><span class="p">[</span><span class="s1">&#39;org-nitrogen&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">fast_pool</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">initial_soil_storage</span><span class="p">[</span><span class="s1">&#39;org-phosphorus&#39;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.land.GrowingSurface.adjust_vqip_to_liquid" class="doc doc-heading">
<code class="highlight language-python"><span class="n">adjust_vqip_to_liquid</span><span class="p">(</span><span class="n">vqip</span><span class="p">,</span> <span class="n">deposition</span><span class="p">,</span> <span class="n">in_</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Function to interoperate between surface tank and nutrient pool. Most 
depositions are given in terms of ammonia/nitrate/phosphate - they are then 
aggregated to total N or P to enter the nutrient pools. Depending on the 
source of deposition these may transform (e.g., some go to dissolved and some 
to solids) upon entering the nutrient pool. To reflect these transformations 
in the soil tank, the amounts entering the soil tank are adjusted 
proportionately.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>vqip</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>A VQIP amount of pollutants originally intended to enter the 
soil tank</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>deposition</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>A dict with nutrients (N and P) as keys, showing the 
total amount of nutrients entering the nutrient pool</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>in_</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>A dict with nutrients as keys, showing the updated amount of 
nutrients that entered the nutrient pool as dissolved pollutants</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>vqip</code></td>          <td>
                <code>dict</code>
          </td>
          <td><p>A VQIP amount of pollutants that have been scaled to account 
for nutrient pool transformations</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\land.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">adjust_vqip_to_liquid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vqip</span><span class="p">,</span> <span class="n">deposition</span><span class="p">,</span> <span class="n">in_</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function to interoperate between surface tank and nutrient pool. Most </span>
<span class="sd">    depositions are given in terms of ammonia/nitrate/phosphate - they are then </span>
<span class="sd">    aggregated to total N or P to enter the nutrient pools. Depending on the </span>
<span class="sd">    source of deposition these may transform (e.g., some go to dissolved and some </span>
<span class="sd">    to solids) upon entering the nutrient pool. To reflect these transformations </span>
<span class="sd">    in the soil tank, the amounts entering the soil tank are adjusted </span>
<span class="sd">    proportionately.</span>

<span class="sd">    Args:</span>
<span class="sd">        vqip (dict): A VQIP amount of pollutants originally intended to enter the </span>
<span class="sd">            soil tank</span>
<span class="sd">        deposition (dict): A dict with nutrients (N and P) as keys, showing the </span>
<span class="sd">            total amount of nutrients entering the nutrient pool</span>
<span class="sd">        in_ (dict): A dict with nutrients as keys, showing the updated amount of </span>
<span class="sd">            nutrients that entered the nutrient pool as dissolved pollutants</span>

<span class="sd">    Returns:</span>
<span class="sd">        vqip (dict): A VQIP amount of pollutants that have been scaled to account </span>
<span class="sd">            for nutrient pool transformations</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;nitrate&#39;</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">POLLUTANTS</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">deposition</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;nitrate&#39;</span><span class="p">]</span> <span class="o">*=</span> <span class="p">(</span><span class="n">in_</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">deposition</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">])</span>
            <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;ammonia&#39;</span><span class="p">]</span> <span class="o">*=</span> <span class="p">(</span><span class="n">in_</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">deposition</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">])</span>
            <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;org-nitrogen&#39;</span><span class="p">]</span> <span class="o">*=</span> <span class="p">(</span><span class="n">in_</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">deposition</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">deposition</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;phosphate&#39;</span><span class="p">]</span> <span class="o">*=</span> <span class="p">(</span><span class="n">in_</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">deposition</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">])</span>
            <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;org-phosphorus&#39;</span><span class="p">]</span> <span class="o">*=</span> <span class="p">(</span><span class="n">in_</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">deposition</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">vqip</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.land.GrowingSurface.adsorption" class="doc doc-heading">
<code class="highlight language-python"><span class="n">adsorption</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Outflow function that calculates phosphorus adsorption/desorptions and 
updates soil tank and nutrient pools</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>tuple</code>
          </td>
          <td><p>A tuple containing a VQIP amount for model inputs and outputs 
for mass balance checking.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\land.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">adsorption</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Outflow function that calculates phosphorus adsorption/desorptions and </span>
<span class="sd">    updates soil tank and nutrient pools</span>

<span class="sd">    Returns:</span>
<span class="sd">        (tuple): A tuple containing a VQIP amount for model inputs and outputs </span>
<span class="sd">            for mass balance checking. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#Parameters/equations from HYPE documentation </span>
    <span class="c1">#TODO could this be moved to the nutrient pool?</span>

    <span class="c1">#Initialise mass balance checking</span>
    <span class="n">in_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
    <span class="n">out_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>

    <span class="c1">#Get total phosphorus in pool available for adsorption/desorption</span>
    <span class="n">limit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adosorption_nr_limit</span>
    <span class="n">ad_de_P_pool</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">adsorbed_inorganic_pool</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">dissolved_inorganic_pool</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="c1"># [kg]</span>
    <span class="n">ad_de_P_pool</span> <span class="o">/=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">area</span> <span class="o">*</span> <span class="n">constants</span><span class="o">.</span><span class="n">M2_TO_KM2</span><span class="p">)</span> <span class="c1"># [kg/km2]</span>
    <span class="k">if</span> <span class="n">ad_de_P_pool</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">())</span>

    <span class="c1">#Calculate coefficient and concentration of adsorbed phosphorus</span>
    <span class="n">soil_moisture_content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_smc</span><span class="p">()</span> <span class="o">*</span> <span class="n">constants</span><span class="o">.</span><span class="n">M_TO_MM</span> <span class="c1"># [mm] (not sure why HYPE has this in mm but whatever)</span>
    <span class="n">conc_sol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">adsorbed_inorganic_pool</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">constants</span><span class="o">.</span><span class="n">KG_TO_MG</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bulk_density</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">rooting_depth</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span><span class="p">)</span><span class="c1"># [mg P/kg soil]</span>
    <span class="n">coeff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kfr</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">bulk_density</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">rooting_depth</span> <span class="o">*</span> <span class="n">constants</span><span class="o">.</span><span class="n">M_TO_MM</span> <span class="c1"># [mm]</span>

    <span class="c1"># calculate equilibrium concentration</span>
    <span class="k">if</span> <span class="n">conc_sol</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="p">:</span>
        <span class="c1">#Not sure how this would happen</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: soil partP &lt;=0. Freundlich will give error, take shortcut.&#39;</span><span class="p">)</span>
        <span class="n">xn_1</span> <span class="o">=</span> <span class="n">ad_de_P_pool</span> <span class="o">/</span> <span class="p">(</span><span class="n">soil_moisture_content</span> <span class="o">+</span> <span class="n">coeff</span><span class="p">)</span> <span class="c1"># [mg/l]</span>
        <span class="n">ad_P_equi_conc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kfr</span> <span class="o">*</span> <span class="n">xn_1</span>   <span class="c1"># [mg/ kg]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Newton-Raphson method</span>
        <span class="n">x0</span> <span class="o">=</span> <span class="n">exp</span><span class="p">((</span><span class="n">log</span><span class="p">(</span><span class="n">conc_sol</span><span class="p">)</span> <span class="o">-</span> <span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kfr</span><span class="p">))</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">nfr</span><span class="p">)</span> <span class="c1"># initial guess of equilibrium liquid concentration</span>
        <span class="n">fxn</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">*</span> <span class="n">soil_moisture_content</span> <span class="o">+</span> <span class="n">coeff</span> <span class="o">*</span> <span class="p">(</span><span class="n">x0</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">nfr</span><span class="p">)</span> <span class="o">-</span> <span class="n">ad_de_P_pool</span>
        <span class="n">xn</span> <span class="o">=</span> <span class="n">x0</span>
        <span class="n">xn_1</span> <span class="o">=</span> <span class="n">xn</span>
        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">fxn</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">limit</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">adsorption_nr_maxiter</span><span class="p">)</span> <span class="p">:</span> <span class="c1"># iteration to calculate equilibrium concentations</span>
            <span class="n">fxn</span> <span class="o">=</span> <span class="n">xn</span> <span class="o">*</span> <span class="n">soil_moisture_content</span> <span class="o">+</span> <span class="n">coeff</span> <span class="o">*</span> <span class="p">(</span><span class="n">xn</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">nfr</span><span class="p">)</span> <span class="o">-</span> <span class="n">ad_de_P_pool</span>
            <span class="n">fprimxn</span> <span class="o">=</span> <span class="n">soil_moisture_content</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">nfr</span> <span class="o">*</span> <span class="n">coeff</span> <span class="o">*</span> <span class="p">(</span><span class="n">xn</span> <span class="o">**</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nfr</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">dx</span> <span class="o">=</span> <span class="n">fxn</span> <span class="o">/</span> <span class="n">fprimxn</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mf">0.000001</span> <span class="o">*</span> <span class="n">xn</span><span class="p">):</span>
                <span class="c1">#From HYPE... not sure what it means</span>
                <span class="k">break</span>
            <span class="n">xn_1</span> <span class="o">=</span> <span class="n">xn</span> <span class="o">-</span> <span class="n">dx</span>
            <span class="k">if</span> <span class="n">xn_1</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="p">:</span>
                <span class="n">xn_1</span> <span class="o">=</span> <span class="mf">1e-10</span>
            <span class="n">xn</span> <span class="o">=</span> <span class="n">xn_1</span>
            <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">ad_P_equi_conc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kfr</span> <span class="o">*</span> <span class="p">(</span><span class="n">xn_1</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">nfr</span><span class="p">)</span>
        <span class="c1">#print(ad_P_equi_conc, conc_sol)</span>

    <span class="c1"># Calculate new pool and concentration, depends on the equilibrium concentration</span>
    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ad_P_equi_conc</span> <span class="o">-</span> <span class="n">conc_sol</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1e-6</span> <span class="p">:</span>
        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">get_empty_nutrient</span><span class="p">()</span>

        <span class="c1">#TODO not sure about this if statement, surely it would be triggered every time</span>
        <span class="n">adsdes</span> <span class="o">=</span> <span class="p">(</span><span class="n">ad_P_equi_conc</span> <span class="o">-</span> <span class="n">conc_sol</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">kadsdes</span><span class="p">))</span> <span class="c1"># kinetic adsorption/desorption</span>
        <span class="n">request</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">adsdes</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">bulk_density</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">rooting_depth</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">area</span> <span class="o">*</span> <span class="n">constants</span><span class="o">.</span><span class="n">M2_TO_KM2</span><span class="p">)</span> <span class="c1"># [kg]</span>
        <span class="k">if</span> <span class="n">request</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1">#Adsorption</span>
            <span class="n">adsorbed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">dissolved_inorganic_pool</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">adsorbed</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">request</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">constants</span><span class="o">.</span><span class="n">FLOAT_ACCURACY</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: freundlich flow adjusted, was larger than pool&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">adsorbed_inorganic_pool</span><span class="o">.</span><span class="n">receive</span><span class="p">(</span><span class="n">adsorbed</span><span class="p">)</span>

            <span class="c1">#Dissolved leaving the soil water tank and becoming solid</span>
            <span class="n">out_</span><span class="p">[</span><span class="s1">&#39;phosphate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">adsorbed</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span>

            <span class="c1">#Update tank</span>
            <span class="n">out2_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pull_pollutants</span><span class="p">(</span><span class="n">out_</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">compare_vqip</span><span class="p">(</span><span class="n">out_</span><span class="p">,</span> <span class="n">out2_</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;nutrient pool not tracking soil tank&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#Desorption</span>
            <span class="n">request</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">request</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span>
            <span class="n">desorbed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">adsorbed_inorganic_pool</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">desorbed</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">request</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">constants</span><span class="o">.</span><span class="n">FLOAT_ACCURACY</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: freundlich flow adjusted, was larger than pool&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">dissolved_inorganic_pool</span><span class="o">.</span><span class="n">receive</span><span class="p">(</span><span class="n">desorbed</span><span class="p">)</span>

            <span class="c1">#Solid phosphorus becoming inorganic P in the soil water tank</span>
            <span class="n">in_</span><span class="p">[</span><span class="s1">&#39;phosphate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">desorbed</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span>
            <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">in_</span><span class="p">,</span> <span class="n">force</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">in_</span><span class="p">,</span> <span class="n">out_</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.land.GrowingSurface.calc_crop_cover" class="doc doc-heading">
<code class="highlight language-python"><span class="n">calc_crop_cover</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Process function that calculates how much crop cover there is, assigns 
whether crops are sown/harvested, and calculates et0_coefficient based on 
growth stage of crops.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>tuple</code>
          </td>
          <td><p>A tuple containing a VQIP amount for model inputs and outputs 
for mass balance checking.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\land.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calc_crop_cover</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Process function that calculates how much crop cover there is, assigns </span>
<span class="sd">    whether crops are sown/harvested, and calculates et0_coefficient based on </span>
<span class="sd">    growth stage of crops.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (tuple): A tuple containing a VQIP amount for model inputs and outputs </span>
<span class="sd">            for mass balance checking. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#Get current day of year</span>
    <span class="n">doy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">dayofyear</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">is_leap_year</span><span class="p">:</span>
        <span class="c1">#Hacky way to handle leap years</span>
        <span class="k">if</span> <span class="n">doy</span> <span class="o">&gt;</span> <span class="mi">59</span><span class="p">:</span>
            <span class="n">doy</span> <span class="o">-=</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">days_after_sow</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">dayofyear</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">sowing_day</span><span class="p">:</span>
            <span class="c1">#sow</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">days_after_sow</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">dayofyear</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">harvest_day</span><span class="p">:</span>
            <span class="c1">#harvest</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">days_after_sow</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">crop_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_factor_stages</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">crop_cover</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ground_cover</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#increment days since sow</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">days_after_sow</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1">#Calculate relevant parameters</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">crop_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">quick_interp</span><span class="p">(</span><span class="n">doy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_factor_stage_dates</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_factor_stages</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">days_after_sow</span><span class="p">:</span>
        <span class="c1">#Move outside of this if, if you want nonzero crop/ground cover outside of season</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">crop_cover</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">quick_interp</span><span class="p">(</span><span class="n">doy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">harvest_sow_calendar</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_cover_stages</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ground_cover</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">quick_interp</span><span class="p">(</span><span class="n">doy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">harvest_sow_calendar</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ground_cover_stages</span><span class="p">)</span>

    <span class="n">root_zone_depletion</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">field_capacity</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_smc</span><span class="p">(),</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">root_zone_depletion</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">readily_available_water</span> <span class="p">:</span>
        <span class="n">crop_water_stress_coefficient</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">crop_water_stress_coefficient</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_available_water</span> <span class="o">-</span> <span class="n">root_zone_depletion</span><span class="p">)</span> <span class="o">/</span>\
                                            <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">ET_depletion_factor</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_available_water</span><span class="p">))</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">et0_coefficient</span> <span class="o">=</span> <span class="n">crop_water_stress_coefficient</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_factor</span>

    <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.land.GrowingSurface.calc_crop_uptake" class="doc doc-heading">
<code class="highlight language-python"><span class="n">calc_crop_uptake</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Process function that calculates how much nutrient crops uptake and updates 
nutrient pool and surface tank</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>tuple</code>
          </td>
          <td><p>A tuple containing a VQIP amount for model inputs and outputs 
for mass balance checking.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\land.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calc_crop_uptake</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Process function that calculates how much nutrient crops uptake and updates </span>
<span class="sd">    nutrient pool and surface tank</span>

<span class="sd">    Returns:</span>
<span class="sd">        (tuple): A tuple containing a VQIP amount for model inputs and outputs </span>
<span class="sd">            for mass balance checking. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#Parameters/equations from HYPE documentation</span>

    <span class="c1">#Initialise</span>
    <span class="n">N_common_uptake</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">P_common_uptake</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">days_after_sow</span><span class="p">:</span>
        <span class="c1">#If there are crops</span>

        <span class="n">days_after_sow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">days_after_sow</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">autumn_sow</span><span class="p">:</span>
            <span class="n">temp_func</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">5</span><span class="p">)</span> <span class="o">/</span> <span class="mi">20</span><span class="p">))</span>
            <span class="n">days_after_sow</span> <span class="o">-=</span> <span class="mi">25</span> <span class="c1">#Not sure why this is (but it&#39;s in HYPE)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">temp_func</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1">#Calculate uptake</span>
        <span class="n">uptake_par</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uptake1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">uptake2</span><span class="p">)</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">uptake3</span> <span class="o">*</span> <span class="n">days_after_sow</span><span class="p">)</span> <span class="o">*</span> <span class="n">temp_func</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">uptake_par</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">uptake2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">:</span>
            <span class="n">N_common_uptake</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uptake1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">uptake2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">uptake3</span> <span class="o">*</span> <span class="n">uptake_par</span> <span class="o">/</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">uptake2</span> <span class="o">+</span> <span class="n">uptake_par</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">N_common_uptake</span> <span class="o">*=</span> <span class="n">constants</span><span class="o">.</span><span class="n">G_M2_TO_KG_M2</span>
        <span class="n">P_common_uptake</span> <span class="o">=</span> <span class="n">N_common_uptake</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">uptake_PNratio</span>
        <span class="n">uptake</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;P&#39;</span> <span class="p">:</span> <span class="n">P_common_uptake</span><span class="p">,</span>
                  <span class="s1">&#39;N&#39;</span> <span class="p">:</span> <span class="n">N_common_uptake</span><span class="p">}</span>
        <span class="n">crop_uptake</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">dissolved_inorganic_pool</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">uptake</span><span class="p">)</span>
        <span class="n">out_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>

        <span class="c1"># Assuming plants eat N and P as nitrate and phosphate</span>
        <span class="n">out_</span><span class="p">[</span><span class="s1">&#39;nitrate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">crop_uptake</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> 
        <span class="n">out_</span><span class="p">[</span><span class="s1">&#39;phosphate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">crop_uptake</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> 

        <span class="n">out2_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pull_pollutants</span><span class="p">(</span><span class="n">out_</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">compare_vqip</span><span class="p">(</span><span class="n">out_</span><span class="p">,</span> <span class="n">out2_</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;nutrient pool not tracking soil tank&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">(),</span> <span class="n">out_</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.land.GrowingSurface.calc_soil_moisture_dependence_factor" class="doc doc-heading">
<code class="highlight language-python"><span class="n">calc_soil_moisture_dependence_factor</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Process function that calculates the soil moisture dependence factor for 
the nutrient pool (which impacts soil pool transformations)</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>tuple</code>
          </td>
          <td><p>A tuple containing a VQIP amount for model inputs and outputs 
for mass balance checking.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\land.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calc_soil_moisture_dependence_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>        
    <span class="sd">&quot;&quot;&quot;Process function that calculates the soil moisture dependence factor for </span>
<span class="sd">    the nutrient pool (which impacts soil pool transformations)</span>

<span class="sd">    Returns:</span>
<span class="sd">        (tuple): A tuple containing a VQIP amount for model inputs and outputs </span>
<span class="sd">            for mass balance checking. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#Parameters/equations from HYPE documentation</span>
    <span class="n">current_soil_moisture</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_smc</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">current_soil_moisture</span>  <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_capacity</span><span class="p">:</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">soil_moisture_dependence_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">satact</span>
    <span class="k">elif</span> <span class="n">current_soil_moisture</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wilting_point</span><span class="p">:</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">soil_moisture_dependence_factor</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fc_diff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_capacity</span> <span class="o">-</span> <span class="n">current_soil_moisture</span>
        <span class="n">fc_comp</span> <span class="o">=</span> <span class="p">(</span><span class="n">fc_diff</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thetaupp</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">rooting_depth</span><span class="p">))</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">thetapow</span>
        <span class="n">fc_comp</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">satact</span><span class="p">)</span> <span class="o">*</span> <span class="n">fc_comp</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">satact</span>
        <span class="n">wp_diff</span> <span class="o">=</span> <span class="n">current_soil_moisture</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">wilting_point</span>
        <span class="n">wp_comp</span> <span class="o">=</span> <span class="p">(</span><span class="n">wp_diff</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thetalow</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">rooting_depth</span><span class="p">))</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">thetapow</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">soil_moisture_dependence_factor</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">wp_comp</span><span class="p">,</span> <span class="n">fc_comp</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.land.GrowingSurface.calc_temperature_dependence_factor" class="doc doc-heading">
<code class="highlight language-python"><span class="n">calc_temperature_dependence_factor</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Process function that calculates the temperature dependence factor for the 
nutrient pool (which impacts soil pool transformations)</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>tuple</code>
          </td>
          <td><p>A tuple containing a VQIP amount for model inputs and outputs 
for mass balance checking.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\land.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calc_temperature_dependence_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Process function that calculates the temperature dependence factor for the </span>
<span class="sd">    nutrient pool (which impacts soil pool transformations)</span>

<span class="sd">    Returns:</span>
<span class="sd">        (tuple): A tuple containing a VQIP amount for model inputs and outputs </span>
<span class="sd">            for mass balance checking. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#Parameters/equations from HYPE documentation</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
        <span class="n">temperature_dependence_factor</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">**</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">20</span><span class="p">)</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">temperature_dependence_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">5</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">temperature_dependence_factor</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">temperature_dependence_factor</span> <span class="o">=</span> <span class="n">temperature_dependence_factor</span>
    <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.land.GrowingSurface.denitrification" class="doc doc-heading">
<code class="highlight language-python"><span class="n">denitrification</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Outflow function that performs denitirication processes, updating nutrient pool and soil tank</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>tuple</code>
          </td>
          <td><p>A tuple containing a VQIP amount for model inputs and outputs 
for mass balance checking.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\land.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">denitrification</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Outflow function that performs denitirication processes, updating nutrient pool and soil tank</span>

<span class="sd">    Returns:</span>
<span class="sd">        (tuple): A tuple containing a VQIP amount for model inputs and outputs </span>
<span class="sd">            for mass balance checking. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#Parameters/equations from HYPE documentation </span>
    <span class="c1">#TODO could more of this be moved to NutrientPool</span>
    <span class="c1">#Calculate soil moisture dependence of denitrification</span>
    <span class="n">soil_moisture_content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_smc</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">soil_moisture_content</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_capacity</span><span class="p">:</span>
        <span class="n">denitrifying_soil_moisture_dependence</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="n">soil_moisture_content</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_capacity</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">limpar</span><span class="p">:</span>
        <span class="n">denitrifying_soil_moisture_dependence</span> <span class="o">=</span> <span class="p">(((</span><span class="n">soil_moisture_content</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_capacity</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">limpar</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">limpar</span><span class="p">))</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">exppar</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">denitrifying_soil_moisture_dependence</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">())</span>

    <span class="c1">#Get dissolved inorg nitrogen as a concentration and calculate factor</span>
    <span class="n">din_conc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">dissolved_inorganic_pool</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="c1"># [kg/m3]</span>
    <span class="n">din_conc</span> <span class="o">*=</span> <span class="n">constants</span><span class="o">.</span><span class="n">KG_M3_TO_MG_L</span>
    <span class="n">half_saturation_concentration_dependence_factor</span> <span class="o">=</span> <span class="n">din_conc</span> <span class="o">/</span> <span class="p">(</span><span class="n">din_conc</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsatINs</span><span class="p">)</span>

    <span class="c1">#Calculate and extract dentrified nitrogen</span>
    <span class="n">denitrified_N</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">dissolved_inorganic_pool</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">*</span>\
                        <span class="n">half_saturation_concentration_dependence_factor</span> <span class="o">*</span>\
                            <span class="n">denitrifying_soil_moisture_dependence</span> <span class="o">*</span>\
                                <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">temperature_dependence_factor</span> <span class="o">*</span>\
                                    <span class="bp">self</span><span class="o">.</span><span class="n">denpar</span>
    <span class="n">denitrified_request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">get_empty_nutrient</span><span class="p">()</span>
    <span class="n">denitrified_request</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">denitrified_N</span>
    <span class="n">denitrified_N</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">dissolved_inorganic_pool</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">denitrified_request</span><span class="p">)</span>

    <span class="c1">#Leon reckons this should leave the model (though I think technically some small amount goes to nitrite)</span>
    <span class="n">out_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
    <span class="n">out_</span><span class="p">[</span><span class="s1">&#39;nitrate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">denitrified_N</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> 

    <span class="c1">#Update tank</span>
    <span class="n">out2_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pull_pollutants</span><span class="p">(</span><span class="n">out_</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">compare_vqip</span><span class="p">(</span><span class="n">out_</span><span class="p">,</span> <span class="n">out2_</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;nutrient pool not tracking soil tank&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">(),</span> <span class="n">out_</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.land.GrowingSurface.dry_deposition_to_tank" class="doc doc-heading">
<code class="highlight language-python"><span class="n">dry_deposition_to_tank</span><span class="p">(</span><span class="n">vqip</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Allocate dry deposition to surface tank, updating nutrient pool accordingly.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>vqip</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>A VQIP amount of dry deposition to send to tank</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>vqip</code></td>          <td>
                <code>dict</code>
          </td>
          <td><p>A VQIP amount of dry deposition that entered the tank (used 
for mass balance checking)</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\land.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">dry_deposition_to_tank</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vqip</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Allocate dry deposition to surface tank, updating nutrient pool accordingly.</span>

<span class="sd">    Args:</span>
<span class="sd">        vqip (dict): A VQIP amount of dry deposition to send to tank</span>

<span class="sd">    Returns:</span>
<span class="sd">        vqip (dict): A VQIP amount of dry deposition that entered the tank (used </span>
<span class="sd">            for mass balance checking)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#Convert to nutrients</span>
    <span class="n">deposition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">get_empty_nutrient</span><span class="p">()</span>
    <span class="n">deposition</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;nitrate&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;ammonia&#39;</span><span class="p">]</span>
    <span class="n">deposition</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;phosphate&#39;</span><span class="p">]</span>

    <span class="c1">#Update nutrient pool</span>
    <span class="n">in_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">allocate_dry_deposition</span><span class="p">(</span><span class="n">deposition</span><span class="p">)</span>
    <span class="n">vqip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adjust_vqip_to_liquid</span><span class="p">(</span><span class="n">vqip</span><span class="p">,</span> <span class="n">deposition</span><span class="p">,</span> <span class="n">in_</span><span class="p">)</span>

    <span class="c1">#Update tank</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">vqip</span><span class="p">,</span> <span class="n">force</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">vqip</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.land.GrowingSurface.erosion" class="doc doc-heading">
<code class="highlight language-python"><span class="n">erosion</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Outflow function that erodes adsorbed/humus phosphorus and sediment and sends onwards to percolation/surface runoff/subsurface runoff</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>tuple</code>
          </td>
          <td><p>A tuple containing a VQIP amount for model inputs and outputs 
for mass balance checking.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\land.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">erosion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Outflow function that erodes adsorbed/humus phosphorus and sediment and sends onwards to percolation/surface runoff/subsurface runoff</span>

<span class="sd">    Returns:</span>
<span class="sd">        (tuple): A tuple containing a VQIP amount for model inputs and outputs </span>
<span class="sd">            for mass balance checking. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#Parameters/equations from HYPE documentation (which explains why my documentation is a bit ambiguous - because theirs is too)</span>

    <span class="c1">#Convert precipitation to MM since all the equations assume that</span>
    <span class="n">precipitation_depth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_input</span><span class="p">(</span><span class="s1">&#39;precipitation&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="n">constants</span><span class="o">.</span><span class="n">M_TO_MM</span>

    <span class="c1">#Calculate how much rain is mobilising erosion</span>
    <span class="k">if</span> <span class="n">precipitation_depth</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
        <span class="n">rainfall_energy</span> <span class="o">=</span> <span class="mf">8.95</span> <span class="o">+</span> <span class="mf">8.44</span> <span class="o">*</span> <span class="n">log10</span><span class="p">(</span><span class="n">precipitation_depth</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.257</span> <span class="o">+</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">constants</span><span class="o">.</span><span class="n">PI</span> <span class="o">*</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">dayofyear</span> <span class="o">-</span> <span class="mi">70</span><span class="p">)</span> <span class="o">/</span> <span class="mi">365</span><span class="p">))</span> <span class="o">*</span> <span class="mf">0.09</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">rainfall_energy</span> <span class="o">*=</span> <span class="n">precipitation_depth</span>
        <span class="n">mobilised_rain</span> <span class="o">=</span> <span class="n">rainfall_energy</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_cover</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">erodibility</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mobilised_rain</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1">#Calculate if any infiltration is mobilising erosion</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">infiltration_excess</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">mobilised_flow</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">infiltration_excess</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span> <span class="o">*</span> <span class="n">constants</span><span class="o">.</span><span class="n">M_TO_MM</span> <span class="o">*</span> <span class="mi">365</span><span class="p">)</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">sreroexp</span>
        <span class="n">mobilised_flow</span> <span class="o">*=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">ground_cover</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cohesion</span><span class="p">))</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slope</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span> <span class="o">/</span> <span class="mi">365</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mobilised_flow</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1">#Sum flows (not sure why surface runoff isn&#39;t included)</span>
    <span class="c1">#TODO I&#39;m pretty sure it should be included here</span>
    <span class="n">total_flows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infiltration_excess</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">subsurface_flow</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">percolation</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="c1">#m3/dt + self.tank_recharge[&#39;volume&#39;] (guess not needed)</span>

    <span class="c1">#Convert to MM/M2</span>
    <span class="n">erodingflow</span> <span class="o">=</span> <span class="n">total_flows</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span> <span class="o">*</span> <span class="n">constants</span><span class="o">.</span><span class="n">M_TO_MM</span>

    <span class="c1">#Calculate eroded sediment</span>
    <span class="n">transportfactor</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">erodingflow</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span> <span class="o">**</span> <span class="mf">1.3</span><span class="p">)</span>
    <span class="n">erodedsed</span> <span class="o">=</span> <span class="mi">1000</span> <span class="o">*</span> <span class="p">(</span><span class="n">mobilised_flow</span> <span class="o">+</span>  <span class="n">mobilised_rain</span><span class="p">)</span> <span class="o">*</span> <span class="n">transportfactor</span> <span class="c1"># [kg/km2]</span>
    <span class="c1">#TODO not sure what conversion this HYPE 1000 is referring to</span>

    <span class="c1"># soil erosion with adsorbed inorganic phosphorus and humus phosphorus (erodedP as P in eroded sediments and effect of enrichment)</span>
    <span class="k">if</span> <span class="n">erodingflow</span> <span class="o">&gt;</span> <span class="mi">4</span> <span class="p">:</span>
        <span class="n">enrichment</span> <span class="o">=</span> <span class="mf">1.5</span>
    <span class="k">elif</span> <span class="n">erodingflow</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">enrichment</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">-</span> <span class="p">(</span><span class="mi">4</span> <span class="o">-</span> <span class="mf">1.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">erodingflow</span> <span class="o">/</span> <span class="mi">4</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">())</span>

    <span class="c1">#Get erodable phosphorus</span>
    <span class="n">erodableP</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">get_erodable_P</span><span class="p">()</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span> <span class="o">*</span> <span class="n">constants</span><span class="o">.</span><span class="n">KG_M2_TO_KG_KM2</span>
    <span class="n">erodedP</span> <span class="o">=</span> <span class="n">erodedsed</span> <span class="o">*</span> <span class="p">(</span><span class="n">erodableP</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rooting_depth</span> <span class="o">*</span> <span class="n">constants</span><span class="o">.</span><span class="n">M_TO_KM</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">bulk_density</span> <span class="o">*</span> <span class="n">constants</span><span class="o">.</span><span class="n">KG_M3_TO_KG_KM3</span><span class="p">))</span> <span class="o">*</span> <span class="n">enrichment</span> <span class="c1"># [kg/km2]</span>

    <span class="c1">#Convert to kg</span>
    <span class="n">erodedP</span> <span class="o">*=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">area</span> <span class="o">*</span> <span class="n">constants</span><span class="o">.</span><span class="n">M2_TO_KM2</span><span class="p">)</span> <span class="c1"># [kg]</span>
    <span class="n">erodedsed</span> <span class="o">*=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">area</span> <span class="o">*</span> <span class="n">constants</span><span class="o">.</span><span class="n">M2_TO_KM2</span><span class="p">)</span> <span class="c1"># [kg]</span>

    <span class="c1">#Allocate to different flows</span>
    <span class="n">surface_erodedP</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">srfilt</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">infiltration_excess</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">total_flows</span> <span class="o">*</span> <span class="n">erodedP</span> <span class="c1"># [kg]</span>
    <span class="n">surface_erodedsed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">srfilt</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">infiltration_excess</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">total_flows</span> <span class="o">*</span> <span class="n">erodedsed</span> <span class="c1"># [kg]</span>

    <span class="n">subsurface_erodedP</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">macrofilt</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">subsurface_flow</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">total_flows</span> <span class="o">*</span> <span class="n">erodedP</span> <span class="c1"># [kg]</span>
    <span class="n">subsurface_erodedsed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">macrofilt</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">subsurface_flow</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">total_flows</span> <span class="o">*</span> <span class="n">erodedsed</span> <span class="c1"># [kg]</span>

    <span class="n">percolation_erodedP</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">macrofilt</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">percolation</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">total_flows</span> <span class="o">*</span> <span class="n">erodedP</span> <span class="c1"># [kg]</span>
    <span class="n">percolation_erodedsed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">macrofilt</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">percolation</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">total_flows</span> <span class="o">*</span> <span class="n">erodedsed</span> <span class="c1"># [kg]</span>

    <span class="c1">#Track mass balance</span>
    <span class="n">in_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>

    <span class="c1">#Total eroded phosphorus </span>
    <span class="n">eff_erodedP</span> <span class="o">=</span> <span class="n">percolation_erodedP</span> <span class="o">+</span> <span class="n">surface_erodedP</span> <span class="o">+</span> <span class="n">subsurface_erodedP</span> <span class="c1"># [kg]</span>
    <span class="k">if</span> <span class="n">eff_erodedP</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1">#Update nutrient pool</span>
        <span class="n">org_removed</span><span class="p">,</span> <span class="n">inorg_removed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">erode_P</span><span class="p">(</span><span class="n">eff_erodedP</span><span class="p">)</span>
        <span class="n">total_removed</span> <span class="o">=</span> <span class="n">inorg_removed</span> <span class="o">+</span> <span class="n">org_removed</span> 

        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">total_removed</span> <span class="o">-</span> <span class="n">eff_erodedP</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">constants</span><span class="o">.</span><span class="n">FLOAT_ACCURACY</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;weird nutrients&#39;</span><span class="p">)</span>

        <span class="c1">#scale flows to split between inorganic and organic eroded P  </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">infiltration_excess</span><span class="p">[</span><span class="s1">&#39;org-phosphorus&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">surface_erodedP</span> <span class="o">*</span> <span class="n">org_removed</span> <span class="o">/</span> <span class="n">eff_erodedP</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subsurface_flow</span><span class="p">[</span><span class="s1">&#39;org-phosphorus&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">subsurface_erodedP</span> <span class="o">*</span> <span class="n">org_removed</span> <span class="o">/</span> <span class="n">eff_erodedP</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">percolation</span><span class="p">[</span><span class="s1">&#39;org-phosphorus&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">percolation_erodedP</span> <span class="o">*</span> <span class="n">org_removed</span> <span class="o">/</span> <span class="n">eff_erodedP</span><span class="p">)</span>

        <span class="c1">#TODO Leon reckons this is conceptually dodgy.. but i&#39;m not sure where else adsorbed inorganic phosphorus should go</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">infiltration_excess</span><span class="p">[</span><span class="s1">&#39;phosphate&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">surface_erodedP</span> <span class="o">*</span> <span class="n">inorg_removed</span> <span class="o">/</span> <span class="n">eff_erodedP</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subsurface_flow</span><span class="p">[</span><span class="s1">&#39;phosphate&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">subsurface_erodedP</span> <span class="o">*</span> <span class="n">inorg_removed</span> <span class="o">/</span> <span class="n">eff_erodedP</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">percolation</span><span class="p">[</span><span class="s1">&#39;phosphate&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">percolation_erodedP</span> <span class="o">*</span> <span class="n">inorg_removed</span> <span class="o">/</span> <span class="n">eff_erodedP</span><span class="p">)</span>

        <span class="c1">#Entering the model (no need to uptake surface tank because both adsorbed inorganic pool and humus pool are solids and so no tracked in the soil water tank)</span>
        <span class="n">in_</span><span class="p">[</span><span class="s1">&#39;phosphate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inorg_removed</span>
        <span class="n">in_</span><span class="p">[</span><span class="s1">&#39;org-phosphorus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">org_removed</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">inorg_to_org_P</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1">#Track sediment as solids</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">infiltration_excess</span><span class="p">[</span><span class="s1">&#39;solids&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">surface_erodedsed</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">subsurface_flow</span><span class="p">[</span><span class="s1">&#39;solids&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">subsurface_erodedsed</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">percolation</span><span class="p">[</span><span class="s1">&#39;solids&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">percolation_erodedsed</span>


    <span class="n">in_</span><span class="p">[</span><span class="s1">&#39;solids&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">surface_erodedsed</span> <span class="o">+</span> <span class="n">subsurface_erodedsed</span> <span class="o">+</span> <span class="n">percolation_erodedsed</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">in_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.land.GrowingSurface.fertiliser" class="doc doc-heading">
<code class="highlight language-python"><span class="n">fertiliser</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Read, scale and allocate fertiliser, updating the tank</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>tuple</code>
          </td>
          <td><p>A tuple containing a VQIP amount for model inputs and outputs 
for mass balance checking.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\land.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fertiliser</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Read, scale and allocate fertiliser, updating the tank</span>

<span class="sd">    Returns:</span>
<span class="sd">        (tuple): A tuple containing a VQIP amount for model inputs and outputs </span>
<span class="sd">            for mass balance checking. </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#TODO tidy up fertiliser/manure/residue/deposition once preprocessing is sorted</span>

    <span class="c1">#Scale for surface</span>
    <span class="n">nhx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_input_surface</span><span class="p">(</span><span class="s1">&#39;nhx-fertiliser&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>
    <span class="n">noy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_input_surface</span><span class="p">(</span><span class="s1">&#39;noy-fertiliser&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>
    <span class="n">srp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_input_surface</span><span class="p">(</span><span class="s1">&#39;srp-fertiliser&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>

    <span class="c1">#Update as VQIP</span>
    <span class="n">vqip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
    <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;ammonia&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nhx</span>
    <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;nitrate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">noy</span>
    <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;phosphate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">srp</span>

    <span class="c1">#Enter nutrient pool</span>
    <span class="n">deposition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">get_empty_nutrient</span><span class="p">()</span>
    <span class="n">deposition</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;nitrate&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;ammonia&#39;</span><span class="p">]</span>
    <span class="n">deposition</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;phosphate&#39;</span><span class="p">]</span>
    <span class="n">in_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">allocate_fertiliser</span><span class="p">(</span><span class="n">deposition</span><span class="p">)</span>

    <span class="c1">#Update tank</span>
    <span class="n">vqip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adjust_vqip_to_liquid</span><span class="p">(</span><span class="n">vqip</span><span class="p">,</span> <span class="n">deposition</span><span class="p">,</span> <span class="n">in_</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">vqip</span><span class="p">,</span> <span class="n">force</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">vqip</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.land.GrowingSurface.manure" class="doc doc-heading">
<code class="highlight language-python"><span class="n">manure</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Read, scale and allocate manure, updating the tank</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>tuple</code>
          </td>
          <td><p>A tuple containing a VQIP amount for model inputs and outputs 
for mass balance checking.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\land.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">manure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Read, scale and allocate manure, updating the tank</span>

<span class="sd">    Returns:</span>
<span class="sd">        (tuple): A tuple containing a VQIP amount for model inputs and outputs </span>
<span class="sd">            for mass balance checking. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#Scale for surface</span>
    <span class="n">nhx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_input_surface</span><span class="p">(</span><span class="s1">&#39;nhx-manure&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>
    <span class="n">noy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_input_surface</span><span class="p">(</span><span class="s1">&#39;noy-manure&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>
    <span class="n">srp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_input_surface</span><span class="p">(</span><span class="s1">&#39;srp-manure&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>

    <span class="c1">#Formulate as VQIP</span>
    <span class="n">vqip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
    <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;ammonia&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nhx</span>
    <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;nitrate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">noy</span>
    <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;phosphate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">srp</span>

    <span class="c1">#Enter nutrient pool</span>
    <span class="n">deposition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">get_empty_nutrient</span><span class="p">()</span>
    <span class="n">deposition</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;nitrate&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;ammonia&#39;</span><span class="p">]</span>
    <span class="n">deposition</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;phosphate&#39;</span><span class="p">]</span>
    <span class="n">in_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">allocate_manure</span><span class="p">(</span><span class="n">deposition</span><span class="p">)</span>

    <span class="c1">#Update tank</span>
    <span class="n">vqip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adjust_vqip_to_liquid</span><span class="p">(</span><span class="n">vqip</span><span class="p">,</span> <span class="n">deposition</span><span class="p">,</span> <span class="n">in_</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">vqip</span><span class="p">,</span> <span class="n">force</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">vqip</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.land.GrowingSurface.pull_storage" class="doc doc-heading">
<code class="highlight language-python"><span class="n">pull_storage</span><span class="p">(</span><span class="n">vqip</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Pull water from the surface, updating the surface storage VQIP. Nutrient 
pool pollutants (nitrate/nitrite/ammonia/phosphate/org-phosphorus/
org-nitrogen) are removed in proportion to their amounts in the dissolved 
nutrient pools, if they are simulated. Other pollutants are removed in proportion to their amount in the surface tank.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>vqip</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>VQIP amount to be pulled, (only 'volume' key is needed)</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>reply</code></td>          <td>
                <code>dict</code>
          </td>
          <td><p>A VQIP amount successfully pulled from the tank</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\land.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">pull_storage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vqip</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Pull water from the surface, updating the surface storage VQIP. Nutrient </span>
<span class="sd">    pool pollutants (nitrate/nitrite/ammonia/phosphate/org-phosphorus/</span>
<span class="sd">    org-nitrogen) are removed in proportion to their amounts in the dissolved </span>
<span class="sd">    nutrient pools, if they are simulated. Other pollutants are removed in proportion to their amount in the surface tank.</span>

<span class="sd">    Args:</span>
<span class="sd">        vqip (dict): VQIP amount to be pulled, (only &#39;volume&#39; key is needed)</span>

<span class="sd">    Returns:</span>
<span class="sd">        reply (dict): A VQIP amount successfully pulled from the tank</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>

    <span class="c1">#Adjust based on available volume</span>
    <span class="n">reply</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">])</span>

    <span class="c1">#Update reply to vqip (get concentration for non-nutrients)</span>
    <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_change_vqip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">,</span> <span class="n">reply</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;nitrate&#39;</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">POLLUTANTS</span><span class="p">:</span>
        <span class="c1">#Update nutrient pool and get concentration for nutrients</span>
        <span class="n">prop</span> <span class="o">=</span> <span class="n">reply</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span>
        <span class="n">nutrients</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">extract_dissolved</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>
        <span class="n">reply</span><span class="p">[</span><span class="s1">&#39;nitrate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nutrients</span><span class="p">[</span><span class="s1">&#39;inorganic&#39;</span><span class="p">][</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;nitrate&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;nitrate&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;ammonia&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;nitrite&#39;</span><span class="p">])</span>
        <span class="n">reply</span><span class="p">[</span><span class="s1">&#39;ammonia&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nutrients</span><span class="p">[</span><span class="s1">&#39;inorganic&#39;</span><span class="p">][</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;ammonia&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;nitrate&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;ammonia&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;nitrite&#39;</span><span class="p">])</span>
        <span class="n">reply</span><span class="p">[</span><span class="s1">&#39;nitrite&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nutrients</span><span class="p">[</span><span class="s1">&#39;inorganic&#39;</span><span class="p">][</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;nitrite&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;nitrate&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;ammonia&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;nitrite&#39;</span><span class="p">])</span>
        <span class="n">reply</span><span class="p">[</span><span class="s1">&#39;phosphate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nutrients</span><span class="p">[</span><span class="s1">&#39;inorganic&#39;</span><span class="p">][</span><span class="s1">&#39;P&#39;</span><span class="p">]</span>
        <span class="n">reply</span><span class="p">[</span><span class="s1">&#39;org-phosphorus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nutrients</span><span class="p">[</span><span class="s1">&#39;organic&#39;</span><span class="p">][</span><span class="s1">&#39;P&#39;</span><span class="p">]</span>
        <span class="n">reply</span><span class="p">[</span><span class="s1">&#39;org-nitrogen&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nutrients</span><span class="p">[</span><span class="s1">&#39;organic&#39;</span><span class="p">][</span><span class="s1">&#39;N&#39;</span><span class="p">]</span>

    <span class="c1">#Extract from storage</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">storage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_vqip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">,</span> <span class="n">reply</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">reply</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.land.GrowingSurface.quick_interp" class="doc doc-heading">
<code class="highlight language-python"><span class="n">quick_interp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">xp</span><span class="p">,</span> <span class="n">yp</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>A simple version of np.interp to intepolate crop information on the fly</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>x</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Current time (i.e., day of year)</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>xp</code></td>
          <td>
                <code>list</code>
          </td>
          <td><p>Predefined times (i.e., list of days of year)</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>yp</code></td>
          <td>
                <code>list</code>
          </td>
          <td><p>Predefined values associated with xp</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>y</code></td>          <td>
                <code>float</code>
          </td>
          <td><p>Interpolated value for current time</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\land.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">966</span>
<span class="normal">967</span>
<span class="normal">968</span>
<span class="normal">969</span>
<span class="normal">970</span>
<span class="normal">971</span>
<span class="normal">972</span>
<span class="normal">973</span>
<span class="normal">974</span>
<span class="normal">975</span>
<span class="normal">976</span>
<span class="normal">977</span>
<span class="normal">978</span>
<span class="normal">979</span>
<span class="normal">980</span>
<span class="normal">981</span>
<span class="normal">982</span>
<span class="normal">983</span>
<span class="normal">984</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">quick_interp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">xp</span><span class="p">,</span> <span class="n">yp</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A simple version of np.interp to intepolate crop information on the fly</span>

<span class="sd">    Args:</span>
<span class="sd">        x (int): Current time (i.e., day of year)</span>
<span class="sd">        xp (list): Predefined times (i.e., list of days of year)</span>
<span class="sd">        yp (list): Predefined values associated with xp</span>

<span class="sd">    Returns:</span>
<span class="sd">        y (float): Interpolated value for current time</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x_ind</span> <span class="o">=</span> <span class="n">bisect_left</span><span class="p">(</span><span class="n">xp</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="n">x_left</span> <span class="o">=</span> <span class="n">xp</span><span class="p">[</span><span class="n">x_ind</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">x_right</span> <span class="o">=</span> <span class="n">xp</span><span class="p">[</span><span class="n">x_ind</span><span class="p">]</span>
    <span class="n">dif</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">x_left</span>
    <span class="n">y_left</span> <span class="o">=</span> <span class="n">yp</span><span class="p">[</span><span class="n">x_ind</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">y_right</span> <span class="o">=</span> <span class="n">yp</span><span class="p">[</span><span class="n">x_ind</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">y_left</span> <span class="o">+</span> <span class="p">(</span><span class="n">y_right</span> <span class="o">-</span> <span class="n">y_left</span><span class="p">)</span> <span class="o">*</span> <span class="n">dif</span> <span class="o">/</span> <span class="p">(</span><span class="n">x_right</span> <span class="o">-</span> <span class="n">x_left</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">y</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.land.GrowingSurface.residue" class="doc doc-heading">
<code class="highlight language-python"><span class="n">residue</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Read, scale and allocate residue, updating the tank (NOT CURRENTLY USED 
BECAUSE NO DATA SOURCES FOR RESIDUE CAN BE IDENTIFIED)</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>tuple</code>
          </td>
          <td><p>A tuple containing a VQIP amount for model inputs and outputs 
for mass balance checking.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\land.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">residue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Read, scale and allocate residue, updating the tank (NOT CURRENTLY USED </span>
<span class="sd">    BECAUSE NO DATA SOURCES FOR RESIDUE CAN BE IDENTIFIED)</span>

<span class="sd">    Returns:</span>
<span class="sd">        (tuple): A tuple containing a VQIP amount for model inputs and outputs </span>
<span class="sd">            for mass balance checking. </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">nhx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_input_surface</span><span class="p">(</span><span class="s1">&#39;nhx-residue&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>
    <span class="n">noy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_input_surface</span><span class="p">(</span><span class="s1">&#39;noy-residue&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>
    <span class="n">srp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_input_surface</span><span class="p">(</span><span class="s1">&#39;srp-residue&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>

    <span class="n">vqip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
    <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;ammonia&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nhx</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">fraction_residue_to_fast</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span>
    <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;nitrate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">noy</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">fraction_residue_to_fast</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span>
    <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;org-nitrogen&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">nhx</span> <span class="o">+</span> <span class="n">noy</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">fraction_residue_to_humus</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span>
    <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;phosphate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">srp</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">fraction_residue_to_fast</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span>
    <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;org-phosphorus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">srp</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">fraction_residue_to_humus</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span>

    <span class="n">deposition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">get_empty_nutrient</span><span class="p">()</span>
    <span class="n">deposition</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;nitrate&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;ammonia&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;org-nitrogen&#39;</span><span class="p">]</span>
    <span class="n">deposition</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;phosphate&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;org-phosphorus&#39;</span><span class="p">]</span>

    <span class="n">in_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">allocate_residue</span><span class="p">(</span><span class="n">deposition</span><span class="p">)</span>
    <span class="n">vqip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adjust_vqip_to_liquid</span><span class="p">(</span><span class="n">vqip</span><span class="p">,</span> <span class="n">deposition</span><span class="p">,</span> <span class="n">in_</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">vqip</span><span class="p">,</span> <span class="n">force</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">vqip</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.land.GrowingSurface.soil_pool_transformation" class="doc doc-heading">
<code class="highlight language-python"><span class="n">soil_pool_transformation</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>A process function that run transformation functions in the nutrient pool 
and updates the pollutant concentrations in the surface tank</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>tuple</code>
          </td>
          <td><p>A tuple containing a VQIP amount for model inputs and outputs 
for mass balance checking.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\land.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">soil_pool_transformation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A process function that run transformation functions in the nutrient pool </span>
<span class="sd">    and updates the pollutant concentrations in the surface tank</span>

<span class="sd">    Returns:</span>
<span class="sd">        (tuple): A tuple containing a VQIP amount for model inputs and outputs </span>
<span class="sd">            for mass balance checking. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#Initialise mass balance tracking variables</span>
    <span class="n">in_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
    <span class="n">out_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>

    <span class="c1">#Get proportion of nitrogen that is nitrate in the soil tank</span>
    <span class="c1">#NOTE ignores nitrite - couldn&#39;t find enough information on it</span>
    <span class="n">nitrate_proportion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;nitrate&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;nitrate&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;ammonia&#39;</span><span class="p">])</span>

    <span class="c1">#Run soil pool functions</span>
    <span class="n">increase_in_dissolved_inorganic</span><span class="p">,</span> <span class="n">increase_in_dissolved_organic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">soil_pool_transformation</span><span class="p">()</span>

    <span class="c1">#Update tank and mass balance</span>
    <span class="c1">#TODO .. there is definitely a neater way to write  this</span>
    <span class="k">if</span> <span class="n">increase_in_dissolved_inorganic</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1">#Increase in inorganic nitrogen, rescale back to nitrate and ammonia</span>
        <span class="n">in_</span><span class="p">[</span><span class="s1">&#39;nitrate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">increase_in_dissolved_inorganic</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">nitrate_proportion</span>
        <span class="n">in_</span><span class="p">[</span><span class="s1">&#39;ammonia&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">increase_in_dissolved_inorganic</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">nitrate_proportion</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1">#Decrease in inorganic nitrogen, rescale back to nitrate and ammonia</span>
        <span class="n">out_</span><span class="p">[</span><span class="s1">&#39;nitrate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">increase_in_dissolved_inorganic</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">nitrate_proportion</span>
        <span class="n">out_</span><span class="p">[</span><span class="s1">&#39;ammonia&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">increase_in_dissolved_inorganic</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">nitrate_proportion</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">increase_in_dissolved_organic</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1">#Increase in organic nitrogen</span>
        <span class="n">in_</span><span class="p">[</span><span class="s1">&#39;org-nitrogen&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">increase_in_dissolved_organic</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1">#Decrease in organic nitrogen</span>
        <span class="n">out_</span><span class="p">[</span><span class="s1">&#39;org-nitrogen&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">increase_in_dissolved_organic</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">increase_in_dissolved_inorganic</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1">#Increase in inorganic phosphate</span>
        <span class="n">in_</span><span class="p">[</span><span class="s1">&#39;phosphate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">increase_in_dissolved_inorganic</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1">#Decrease in inorganic phosphate</span>
        <span class="n">out_</span><span class="p">[</span><span class="s1">&#39;phosphate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">increase_in_dissolved_inorganic</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">increase_in_dissolved_organic</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1">#Increase in organic phosphorus</span>
        <span class="n">in_</span><span class="p">[</span><span class="s1">&#39;org-phosphorus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">increase_in_dissolved_organic</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1">#Decrease in organic phosphorus</span>
        <span class="n">out_</span><span class="p">[</span><span class="s1">&#39;org-phosphorus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">increase_in_dissolved_organic</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span>

    <span class="c1">#Update tank with inputs/outputs of pollutants</span>
    <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">in_</span><span class="p">,</span> <span class="n">force</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">out2_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pull_pollutants</span><span class="p">(</span><span class="n">out_</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">compare_vqip</span><span class="p">(</span><span class="n">out_</span><span class="p">,</span> <span class="n">out2_</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;nutrient pool not tracking soil tank&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">in_</span><span class="p">,</span> <span class="n">out_</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.land.GrowingSurface.wet_deposition_to_tank" class="doc doc-heading">
<code class="highlight language-python"><span class="n">wet_deposition_to_tank</span><span class="p">(</span><span class="n">vqip</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Allocate wet deposition to surface tank, updating nutrient pool accordingly.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>vqip</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>A VQIP amount of dry deposition to send to tank</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>vqip</code></td>          <td>
                <code>dict</code>
          </td>
          <td><p>A VQIP amount of dry deposition that entered the tank (used 
for mass balance checking)</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\land.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">wet_deposition_to_tank</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vqip</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Allocate wet deposition to surface tank, updating nutrient pool accordingly.</span>

<span class="sd">    Args:</span>
<span class="sd">        vqip (dict): A VQIP amount of dry deposition to send to tank</span>

<span class="sd">    Returns:</span>
<span class="sd">        vqip (dict): A VQIP amount of dry deposition that entered the tank (used </span>
<span class="sd">            for mass balance checking)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#Convert to nutrients</span>
    <span class="n">deposition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">get_empty_nutrient</span><span class="p">()</span>
    <span class="n">deposition</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;nitrate&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;ammonia&#39;</span><span class="p">]</span>
    <span class="n">deposition</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;phosphate&#39;</span><span class="p">]</span>

    <span class="c1">#Update nutrient pool</span>
    <span class="n">in_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">allocate_wet_deposition</span><span class="p">(</span><span class="n">deposition</span><span class="p">)</span>
    <span class="n">vqip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adjust_vqip_to_liquid</span><span class="p">(</span><span class="n">vqip</span><span class="p">,</span> <span class="n">deposition</span><span class="p">,</span> <span class="n">in_</span><span class="p">)</span>

    <span class="c1">#Update tank</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">vqip</span><span class="p">,</span> <span class="n">force</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">vqip</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="wsimod.nodes.land.ImperviousSurface" class="doc doc-heading">
        <code>ImperviousSurface</code>


</h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="wsimod.nodes.land.Surface" href="#wsimod.nodes.land.Surface">Surface</a></code></p>



        <details class="quote">
          <summary>Source code in <code>wsimod\nodes\land.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ImperviousSurface</span><span class="p">(</span><span class="n">Surface</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                        <span class="n">pore_depth</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                        <span class="n">et0_to_e</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A surface to represent impervious surfaces that drain to storm sewers. </span>
<span class="sd">        Runoff is generated by the surface tank overflowing, if a user wants all </span>
<span class="sd">        precipitation to immediately go to runoff then they should reduce &#39;pore_depth&#39;, </span>
<span class="sd">        however generally this is not what happens and a small (a few mm) depth should </span>
<span class="sd">        be assigned to the tank. Also includes urban pollution deposition, though this </span>
<span class="sd">        will only be mobilised if runoff occurs. </span>

<span class="sd">        Note that the tank does not have a runoff coefficient because it doesn&#39;t make </span>
<span class="sd">        sense from an integrated perspective. If a user wants to mimic runoff </span>
<span class="sd">        coefficient-like behaviour, then they should reduce the ImperviousSurface tank </span>
<span class="sd">        size, and increase other surfaces of the parent land node accordingly.</span>

<span class="sd">        Args:</span>
<span class="sd">            pore_depth (float, optional): The depth of the tank that must be exceeded </span>
<span class="sd">                to generate runoff. Intended to represent the pores in ashpalt that </span>
<span class="sd">                water accumulates in before flowing. Defaults to 0.</span>
<span class="sd">            et0_to_e (float, optional): Multiplier applied to the parent&#39;s data </span>
<span class="sd">                timeseries of et0 to determine how much evaporation takes place on the </span>
<span class="sd">                ImperviousSurface. Defaults to 1.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">#Assign parameters </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">et0_to_e</span> <span class="o">=</span> <span class="n">et0_to_e</span> <span class="c1">#Total evaporation</span>


        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">depth</span> <span class="o">=</span> <span class="n">pore_depth</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1">#Initialise state variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evaporation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">precipitation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>

        <span class="c1">#Populate function lists</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inflows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">precipitation_evaporation</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">outflows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">push_to_sewers</span><span class="p">)</span>




    <span class="k">def</span> <span class="nf">precipitation_evaporation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Inflow function that is a simple rainfall-evaporation model, updating the </span>
<span class="sd">        surface tank. All precipitation that is not evaporated is forced into the tank </span>
<span class="sd">        (even though some of that will later be pushed to sewers) - this enables runoff </span>
<span class="sd">        to mix with the accumulated pollutants in the surface pores.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (tuple): A tuple containing a VQIP amount for model inputs and outputs </span>
<span class="sd">                for mass balance checking. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#Read data in length units</span>
        <span class="n">precipitation_depth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_input</span><span class="p">(</span><span class="s1">&#39;precipitation&#39;</span><span class="p">)</span>
        <span class="n">evaporation_depth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_input</span><span class="p">(</span><span class="s1">&#39;et0&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">et0_to_e</span>

        <span class="k">if</span> <span class="n">precipitation_depth</span> <span class="o">&lt;</span> <span class="n">evaporation_depth</span><span class="p">:</span>
            <span class="c1">#No effective precipitation</span>
            <span class="n">net_precipitation</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="c1">#Calculate how much should be evaporated from pores</span>
            <span class="n">evaporation_from_pores</span> <span class="o">=</span> <span class="n">evaporation_depth</span> <span class="o">-</span> <span class="n">precipitation_depth</span>

            <span class="c1">#Scale</span>
            <span class="n">evaporation_from_pores</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>

            <span class="c1">#Pull from tank</span>
            <span class="n">evaporation_from_pores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaporate</span><span class="p">(</span><span class="n">evaporation_from_pores</span><span class="p">)</span>

            <span class="c1">#Scale to get actual evaporation</span>
            <span class="n">total_evaporation</span> <span class="o">=</span> <span class="n">evaporation_from_pores</span> <span class="o">+</span> <span class="n">precipitation_depth</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#Effective precipitation</span>
            <span class="n">net_precipitation</span> <span class="o">=</span> <span class="n">precipitation_depth</span> <span class="o">-</span> <span class="n">evaporation_depth</span>

            <span class="c1">#Scale</span>
            <span class="n">net_precipitation</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>
            <span class="n">net_precipitation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_change_vqip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">(),</span> <span class="n">net_precipitation</span><span class="p">)</span>

            <span class="c1">#Assign a temperature value</span>
            <span class="c1">#TODO how hot is rain? No idea... just going to use surface air temperature</span>
            <span class="n">net_precipitation</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_input</span><span class="p">(</span><span class="s1">&#39;temperature&#39;</span><span class="p">)</span>

            <span class="c1">#Update tank</span>
            <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">net_precipitation</span><span class="p">,</span> <span class="n">force</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">total_evaporation</span> <span class="o">=</span> <span class="n">evaporation_depth</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>

        <span class="c1">#Converrt to VQIP</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evaporation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_change_vqip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">(),</span> <span class="n">total_evaporation</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">precipitation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_change_vqip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">(),</span> <span class="n">precipitation_depth</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">precipitation</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaporation</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">push_to_sewers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Outflow function that distributes ponded water (i.e., surface runoff) to the </span>
<span class="sd">        parent node&#39;s attached sewers</span>

<span class="sd">        Returns:</span>
<span class="sd">            (tuple): A tuple containing a VQIP amount for model inputs and outputs </span>
<span class="sd">                for mass balance checking. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#Get runoff</span>
        <span class="n">surface_runoff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pull_ponded</span><span class="p">()</span>

        <span class="c1">#Distribute</span>
        <span class="c1">#TODO in cwsd_partition this is done with timearea</span>
        <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">push_distributed</span><span class="p">(</span><span class="n">surface_runoff</span><span class="p">,</span> <span class="n">of_type</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Sewer&#39;</span><span class="p">])</span>

        <span class="c1">#Update tank (forcing, because if the water can&#39;t go to the sewer, where else can it go)</span>
        <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">reply</span><span class="p">,</span> <span class="n">force</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="c1">#TODO... possibly this could flow to attached river or land nodes.. or other surfaces? I expect this doesn&#39;t matter for large scale models.. but may need to be revisited for detailed sewer models</span>

        <span class="c1">#Return empty mass balance because outflows are handled by parent</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.land.ImperviousSurface.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">pore_depth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">et0_to_e</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>A surface to represent impervious surfaces that drain to storm sewers. 
Runoff is generated by the surface tank overflowing, if a user wants all 
precipitation to immediately go to runoff then they should reduce 'pore_depth', 
however generally this is not what happens and a small (a few mm) depth should 
be assigned to the tank. Also includes urban pollution deposition, though this 
will only be mobilised if runoff occurs. </p>
<p>Note that the tank does not have a runoff coefficient because it doesn't make 
sense from an integrated perspective. If a user wants to mimic runoff 
coefficient-like behaviour, then they should reduce the ImperviousSurface tank 
size, and increase other surfaces of the parent land node accordingly.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>pore_depth</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>The depth of the tank that must be exceeded 
to generate runoff. Intended to represent the pores in ashpalt that 
water accumulates in before flowing. Defaults to 0.</p></td>
          <td>
                <code>0</code>
          </td>
        </tr>
        <tr>
          <td><code>et0_to_e</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Multiplier applied to the parent's data 
timeseries of et0 to determine how much evaporation takes place on the 
ImperviousSurface. Defaults to 1.</p></td>
          <td>
                <code>1</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\land.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                    <span class="n">pore_depth</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="n">et0_to_e</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A surface to represent impervious surfaces that drain to storm sewers. </span>
<span class="sd">    Runoff is generated by the surface tank overflowing, if a user wants all </span>
<span class="sd">    precipitation to immediately go to runoff then they should reduce &#39;pore_depth&#39;, </span>
<span class="sd">    however generally this is not what happens and a small (a few mm) depth should </span>
<span class="sd">    be assigned to the tank. Also includes urban pollution deposition, though this </span>
<span class="sd">    will only be mobilised if runoff occurs. </span>

<span class="sd">    Note that the tank does not have a runoff coefficient because it doesn&#39;t make </span>
<span class="sd">    sense from an integrated perspective. If a user wants to mimic runoff </span>
<span class="sd">    coefficient-like behaviour, then they should reduce the ImperviousSurface tank </span>
<span class="sd">    size, and increase other surfaces of the parent land node accordingly.</span>

<span class="sd">    Args:</span>
<span class="sd">        pore_depth (float, optional): The depth of the tank that must be exceeded </span>
<span class="sd">            to generate runoff. Intended to represent the pores in ashpalt that </span>
<span class="sd">            water accumulates in before flowing. Defaults to 0.</span>
<span class="sd">        et0_to_e (float, optional): Multiplier applied to the parent&#39;s data </span>
<span class="sd">            timeseries of et0 to determine how much evaporation takes place on the </span>
<span class="sd">            ImperviousSurface. Defaults to 1.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#Assign parameters </span>
    <span class="bp">self</span><span class="o">.</span><span class="n">et0_to_e</span> <span class="o">=</span> <span class="n">et0_to_e</span> <span class="c1">#Total evaporation</span>


    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">depth</span> <span class="o">=</span> <span class="n">pore_depth</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1">#Initialise state variables</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">evaporation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">precipitation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>

    <span class="c1">#Populate function lists</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">inflows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">precipitation_evaporation</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">outflows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">push_to_sewers</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.land.ImperviousSurface.precipitation_evaporation" class="doc doc-heading">
<code class="highlight language-python"><span class="n">precipitation_evaporation</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Inflow function that is a simple rainfall-evaporation model, updating the 
surface tank. All precipitation that is not evaporated is forced into the tank 
(even though some of that will later be pushed to sewers) - this enables runoff 
to mix with the accumulated pollutants in the surface pores.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>tuple</code>
          </td>
          <td><p>A tuple containing a VQIP amount for model inputs and outputs 
for mass balance checking.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\land.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">precipitation_evaporation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Inflow function that is a simple rainfall-evaporation model, updating the </span>
<span class="sd">    surface tank. All precipitation that is not evaporated is forced into the tank </span>
<span class="sd">    (even though some of that will later be pushed to sewers) - this enables runoff </span>
<span class="sd">    to mix with the accumulated pollutants in the surface pores.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (tuple): A tuple containing a VQIP amount for model inputs and outputs </span>
<span class="sd">            for mass balance checking. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#Read data in length units</span>
    <span class="n">precipitation_depth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_input</span><span class="p">(</span><span class="s1">&#39;precipitation&#39;</span><span class="p">)</span>
    <span class="n">evaporation_depth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_input</span><span class="p">(</span><span class="s1">&#39;et0&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">et0_to_e</span>

    <span class="k">if</span> <span class="n">precipitation_depth</span> <span class="o">&lt;</span> <span class="n">evaporation_depth</span><span class="p">:</span>
        <span class="c1">#No effective precipitation</span>
        <span class="n">net_precipitation</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1">#Calculate how much should be evaporated from pores</span>
        <span class="n">evaporation_from_pores</span> <span class="o">=</span> <span class="n">evaporation_depth</span> <span class="o">-</span> <span class="n">precipitation_depth</span>

        <span class="c1">#Scale</span>
        <span class="n">evaporation_from_pores</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>

        <span class="c1">#Pull from tank</span>
        <span class="n">evaporation_from_pores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaporate</span><span class="p">(</span><span class="n">evaporation_from_pores</span><span class="p">)</span>

        <span class="c1">#Scale to get actual evaporation</span>
        <span class="n">total_evaporation</span> <span class="o">=</span> <span class="n">evaporation_from_pores</span> <span class="o">+</span> <span class="n">precipitation_depth</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1">#Effective precipitation</span>
        <span class="n">net_precipitation</span> <span class="o">=</span> <span class="n">precipitation_depth</span> <span class="o">-</span> <span class="n">evaporation_depth</span>

        <span class="c1">#Scale</span>
        <span class="n">net_precipitation</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>
        <span class="n">net_precipitation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_change_vqip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">(),</span> <span class="n">net_precipitation</span><span class="p">)</span>

        <span class="c1">#Assign a temperature value</span>
        <span class="c1">#TODO how hot is rain? No idea... just going to use surface air temperature</span>
        <span class="n">net_precipitation</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_input</span><span class="p">(</span><span class="s1">&#39;temperature&#39;</span><span class="p">)</span>

        <span class="c1">#Update tank</span>
        <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">net_precipitation</span><span class="p">,</span> <span class="n">force</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">total_evaporation</span> <span class="o">=</span> <span class="n">evaporation_depth</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>

    <span class="c1">#Converrt to VQIP</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">evaporation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_change_vqip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">(),</span> <span class="n">total_evaporation</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">precipitation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_change_vqip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">(),</span> <span class="n">precipitation_depth</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">precipitation</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaporation</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.land.ImperviousSurface.push_to_sewers" class="doc doc-heading">
<code class="highlight language-python"><span class="n">push_to_sewers</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Outflow function that distributes ponded water (i.e., surface runoff) to the 
parent node's attached sewers</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>tuple</code>
          </td>
          <td><p>A tuple containing a VQIP amount for model inputs and outputs 
for mass balance checking.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\land.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">push_to_sewers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Outflow function that distributes ponded water (i.e., surface runoff) to the </span>
<span class="sd">    parent node&#39;s attached sewers</span>

<span class="sd">    Returns:</span>
<span class="sd">        (tuple): A tuple containing a VQIP amount for model inputs and outputs </span>
<span class="sd">            for mass balance checking. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#Get runoff</span>
    <span class="n">surface_runoff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pull_ponded</span><span class="p">()</span>

    <span class="c1">#Distribute</span>
    <span class="c1">#TODO in cwsd_partition this is done with timearea</span>
    <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">push_distributed</span><span class="p">(</span><span class="n">surface_runoff</span><span class="p">,</span> <span class="n">of_type</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Sewer&#39;</span><span class="p">])</span>

    <span class="c1">#Update tank (forcing, because if the water can&#39;t go to the sewer, where else can it go)</span>
    <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">reply</span><span class="p">,</span> <span class="n">force</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="c1">#TODO... possibly this could flow to attached river or land nodes.. or other surfaces? I expect this doesn&#39;t matter for large scale models.. but may need to be revisited for detailed sewer models</span>

    <span class="c1">#Return empty mass balance because outflows are handled by parent</span>
    <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="wsimod.nodes.land.IrrigationSurface" class="doc doc-heading">
        <code>IrrigationSurface</code>


</h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="wsimod.nodes.land.GrowingSurface" href="#wsimod.nodes.land.GrowingSurface">GrowingSurface</a></code></p>



        <details class="quote">
          <summary>Source code in <code>wsimod\nodes\land.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">IrrigationSurface</span><span class="p">(</span><span class="n">GrowingSurface</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">irrigation_coefficient</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A subclass of GrowingSurface that can calculate water demand for the crops </span>
<span class="sd">        that is not met by precipitation and use the parent node to acquire water. </span>
<span class="sd">        When the surface is created by the parent node, the irrigate function below is </span>
<span class="sd">        assigned. </span>

<span class="sd">        Args:</span>
<span class="sd">            irrigation_coefficient (float, optional): proportion area irrigated * </span>
<span class="sd">                proportion of demand met. Defaults to 0.1.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#Assign param</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">irrigation_coefficient</span> <span class="o">=</span> <span class="n">irrigation_coefficient</span> <span class="c1">#proportion area irrigated * proportion of demand met</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">irrigate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate water demand for crops and call parent node to acquire water, </span>
<span class="sd">        updating surface tank and nutrient pools</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">days_after_sow</span><span class="p">:</span>
            <span class="c1">#Irrigation is just difference between evaporation and precipitation amount</span>
            <span class="n">irrigation_demand</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evaporation</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">precipitation</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">irrigation_coefficient</span>
            <span class="k">if</span> <span class="n">irrigation_demand</span> <span class="o">&gt;</span> <span class="n">constants</span><span class="o">.</span><span class="n">FLOAT_ACCURACY</span><span class="p">:</span>
                <span class="n">root_zone_depletion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cmd</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">root_zone_depletion</span> <span class="o">&lt;=</span> <span class="n">constants</span><span class="o">.</span><span class="n">FLOAT_ACCURACY</span><span class="p">:</span>
                    <span class="c1">#TODO this isn&#39;t in FAO... but seems sensible</span>
                    <span class="n">irrigation_demand</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="c1">#Pull water using parent node</span>
                <span class="n">supplied</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">pull_distributed</span><span class="p">({</span><span class="s1">&#39;volume&#39;</span> <span class="p">:</span> <span class="n">irrigation_demand</span><span class="p">},</span> 
                                                         <span class="n">of_type</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;River&#39;</span><span class="p">,</span>
                                                                    <span class="s1">&#39;Node&#39;</span><span class="p">,</span>
                                                                    <span class="s1">&#39;Groundwater&#39;</span><span class="p">,</span>
                                                                    <span class="s1">&#39;Reservoir&#39;</span>
                                                                    <span class="p">])</span>

                <span class="c1">#update tank</span>
                <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">supplied</span><span class="p">,</span> <span class="n">force</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

                <span class="c1">#update nutrient pools</span>
                <span class="n">organic</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;N&#39;</span> <span class="p">:</span> <span class="n">supplied</span><span class="p">[</span><span class="s1">&#39;org-nitrogen&#39;</span><span class="p">],</span> 
                           <span class="s1">&#39;P&#39;</span> <span class="p">:</span> <span class="n">supplied</span><span class="p">[</span><span class="s1">&#39;org-phosphorus&#39;</span><span class="p">]}</span>
                <span class="n">inorganic</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;N&#39;</span> <span class="p">:</span> <span class="n">supplied</span><span class="p">[</span><span class="s1">&#39;ammonia&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">supplied</span><span class="p">[</span><span class="s1">&#39;nitrate&#39;</span><span class="p">],</span> 
                             <span class="s1">&#39;P&#39;</span> <span class="p">:</span> <span class="n">supplied</span><span class="p">[</span><span class="s1">&#39;phosphate&#39;</span><span class="p">]}</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">allocate_organic_irrigation</span><span class="p">(</span><span class="n">organic</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">allocate_inorganic_irrigation</span><span class="p">(</span><span class="n">inorganic</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.land.IrrigationSurface.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">irrigation_coefficient</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>A subclass of GrowingSurface that can calculate water demand for the crops 
that is not met by precipitation and use the parent node to acquire water. 
When the surface is created by the parent node, the irrigate function below is 
assigned. </p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>irrigation_coefficient</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>proportion area irrigated * 
proportion of demand met. Defaults to 0.1.</p></td>
          <td>
                <code>0.1</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\land.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">irrigation_coefficient</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A subclass of GrowingSurface that can calculate water demand for the crops </span>
<span class="sd">    that is not met by precipitation and use the parent node to acquire water. </span>
<span class="sd">    When the surface is created by the parent node, the irrigate function below is </span>
<span class="sd">    assigned. </span>

<span class="sd">    Args:</span>
<span class="sd">        irrigation_coefficient (float, optional): proportion area irrigated * </span>
<span class="sd">            proportion of demand met. Defaults to 0.1.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#Assign param</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">irrigation_coefficient</span> <span class="o">=</span> <span class="n">irrigation_coefficient</span> <span class="c1">#proportion area irrigated * proportion of demand met</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.land.IrrigationSurface.irrigate" class="doc doc-heading">
<code class="highlight language-python"><span class="n">irrigate</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Calculate water demand for crops and call parent node to acquire water, 
updating surface tank and nutrient pools</p>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\land.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">irrigate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate water demand for crops and call parent node to acquire water, </span>
<span class="sd">    updating surface tank and nutrient pools</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">days_after_sow</span><span class="p">:</span>
        <span class="c1">#Irrigation is just difference between evaporation and precipitation amount</span>
        <span class="n">irrigation_demand</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evaporation</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">precipitation</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">irrigation_coefficient</span>
        <span class="k">if</span> <span class="n">irrigation_demand</span> <span class="o">&gt;</span> <span class="n">constants</span><span class="o">.</span><span class="n">FLOAT_ACCURACY</span><span class="p">:</span>
            <span class="n">root_zone_depletion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cmd</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">root_zone_depletion</span> <span class="o">&lt;=</span> <span class="n">constants</span><span class="o">.</span><span class="n">FLOAT_ACCURACY</span><span class="p">:</span>
                <span class="c1">#TODO this isn&#39;t in FAO... but seems sensible</span>
                <span class="n">irrigation_demand</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="c1">#Pull water using parent node</span>
            <span class="n">supplied</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">pull_distributed</span><span class="p">({</span><span class="s1">&#39;volume&#39;</span> <span class="p">:</span> <span class="n">irrigation_demand</span><span class="p">},</span> 
                                                     <span class="n">of_type</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;River&#39;</span><span class="p">,</span>
                                                                <span class="s1">&#39;Node&#39;</span><span class="p">,</span>
                                                                <span class="s1">&#39;Groundwater&#39;</span><span class="p">,</span>
                                                                <span class="s1">&#39;Reservoir&#39;</span>
                                                                <span class="p">])</span>

            <span class="c1">#update tank</span>
            <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">supplied</span><span class="p">,</span> <span class="n">force</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

            <span class="c1">#update nutrient pools</span>
            <span class="n">organic</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;N&#39;</span> <span class="p">:</span> <span class="n">supplied</span><span class="p">[</span><span class="s1">&#39;org-nitrogen&#39;</span><span class="p">],</span> 
                       <span class="s1">&#39;P&#39;</span> <span class="p">:</span> <span class="n">supplied</span><span class="p">[</span><span class="s1">&#39;org-phosphorus&#39;</span><span class="p">]}</span>
            <span class="n">inorganic</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;N&#39;</span> <span class="p">:</span> <span class="n">supplied</span><span class="p">[</span><span class="s1">&#39;ammonia&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">supplied</span><span class="p">[</span><span class="s1">&#39;nitrate&#39;</span><span class="p">],</span> 
                         <span class="s1">&#39;P&#39;</span> <span class="p">:</span> <span class="n">supplied</span><span class="p">[</span><span class="s1">&#39;phosphate&#39;</span><span class="p">]}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">allocate_organic_irrigation</span><span class="p">(</span><span class="n">organic</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nutrient_pool</span><span class="o">.</span><span class="n">allocate_inorganic_irrigation</span><span class="p">(</span><span class="n">inorganic</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="wsimod.nodes.land.Land" class="doc doc-heading">
        <code>Land</code>


</h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="wsimod.nodes.nodes.Node" href="../reference-nodes/#wsimod.nodes.nodes.Node">Node</a></code></p>



        <details class="quote">
          <summary>Source code in <code>wsimod\nodes\land.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Land</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                        <span class="n">name</span><span class="p">,</span>
                        <span class="n">subsurface_residence_time</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
                        <span class="n">percolation_residence_time</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
                        <span class="n">surface_residence_time</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="n">surfaces</span> <span class="o">=</span> <span class="p">[],</span>
                        <span class="n">data_input_dict</span> <span class="o">=</span> <span class="p">{}):</span>
        <span class="sd">&quot;&quot;&quot;An extensive node class that represents land processes (agriculture, soil, </span>
<span class="sd">        subsurface flow, rural runoff, urban drainage, pollution deposition). The </span>
<span class="sd">        expected use is that each distinctive type of land cover (different crop </span>
<span class="sd">        types, gardens, forests, impervious urban drainage, etc.) each have a Surface </span>
<span class="sd">        object, which is a subclass of Tank. The land node will iterate over its </span>
<span class="sd">        surfaces each timestep, which will generally (except in the case of an </span>
<span class="sd">        impervious surface) send water to three common Tanks: surface flow, </span>
<span class="sd">        subsurface flow and percolation. These tanks will then send flows to rivers </span>
<span class="sd">        or groundwater.</span>

<span class="sd">        (See wsimod/nodes/land.py/Surface and subclasses for currently available </span>
<span class="sd">        surfaces)</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): node name.</span>
<span class="sd">            subsurface_residence_time (float, optional): Residence time for     </span>
<span class="sd">                subsurface flow (see nodes.py/ResidenceTank). Defaults to 5.</span>
<span class="sd">            percolation_residence_time (int, optional): Residence time for </span>
<span class="sd">                percolation flow (see nodes.py/ResidenceTank). Defaults to 50.</span>
<span class="sd">            surface_residence_time (int, optional): Residence time for surface flow</span>
<span class="sd">                (see nodes.py/ResidenceTank). Defaults to 1.</span>
<span class="sd">            surfaces (list, optional): list of dicts where each dict describes the </span>
<span class="sd">                parameters of each surface in the Land node. Each dict also contains </span>
<span class="sd">                an entry under &#39;type_&#39; which describes which subclass of surface to </span>
<span class="sd">                use. Defaults to [].</span>
<span class="sd">            data_input_dict (dict, optional): Dictionary of data inputs relevant for </span>
<span class="sd">                the node (generally, et0, precipitation and temperature). Keys are </span>
<span class="sd">                tuples where first value is the name of the variable to read from the </span>
<span class="sd">                dict and the second value is the time. Defaults to {}.</span>

<span class="sd">        Functions intended to call in orchestration:</span>
<span class="sd">            run</span>

<span class="sd">            apply_irrigation (if used)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#Assign parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subsurface_residence_time</span> <span class="o">=</span> <span class="n">subsurface_residence_time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">percolation_residence_time</span> <span class="o">=</span> <span class="n">percolation_residence_time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">surface_residence_time</span> <span class="o">=</span> <span class="n">surface_residence_time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_input_dict</span> <span class="o">=</span> <span class="n">data_input_dict</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">data_input_dict</span> <span class="o">=</span> <span class="n">data_input_dict</span><span class="p">)</span>

        <span class="c1">#This could be a deny but then you would have to know in advance whether a demand node has any gardening or not</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_check_handler</span><span class="p">[(</span><span class="s1">&#39;Demand&#39;</span><span class="p">,</span><span class="s1">&#39;Garden&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_set_handler</span><span class="p">[(</span><span class="s1">&#39;Demand&#39;</span><span class="p">,</span><span class="s1">&#39;Garden&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>

        <span class="c1">#Create surfaces</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">irrigation_functions</span> <span class="o">=</span> <span class="p">[</span><span class="k">lambda</span> <span class="p">:</span> <span class="kc">None</span><span class="p">]</span>

        <span class="n">surfaces_</span> <span class="o">=</span> <span class="n">surfaces</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">surfaces</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">surface</span> <span class="ow">in</span> <span class="n">surfaces_</span><span class="p">:</span>
            <span class="c1">#Assign parent (for data reading and to determine where to send flows to)</span>
            <span class="n">surface</span><span class="p">[</span><span class="s1">&#39;parent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>

            <span class="c1">#Get surface type</span>
            <span class="n">type_</span> <span class="o">=</span> <span class="n">surface</span><span class="p">[</span><span class="s1">&#39;type_&#39;</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">surface</span><span class="p">[</span><span class="s1">&#39;type_&#39;</span><span class="p">]</span>

            <span class="c1">#Instantiate surface and store in list of surfaces</span>
            <span class="n">surfaces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="vm">__name__</span><span class="p">],</span> <span class="n">type_</span><span class="p">)(</span><span class="o">**</span><span class="n">surface</span><span class="p">))</span>

            <span class="c1">#Assign ds (mass balance checking)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mass_balance_ds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">surfaces</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">ds</span><span class="p">)</span>

            <span class="c1">#Assign any irrigation functions </span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">surfaces</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">IrrigationSurface</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">irrigation_functions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">surfaces</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">irrigate</span><span class="p">)</span>

            <span class="c1">#Assign garden surface functions</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">surfaces</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">GardenSurface</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">push_check_handler</span><span class="p">[(</span><span class="s1">&#39;Demand&#39;</span><span class="p">,</span><span class="s1">&#39;Garden&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">surfaces</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">calculate_irrigation_demand</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">push_set_handler</span><span class="p">[(</span><span class="s1">&#39;Demand&#39;</span><span class="p">,</span><span class="s1">&#39;Garden&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">surfaces</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">receive_irrigation_demand</span>

        <span class="c1">#Update handlers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_set_handler</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_set_deny</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_check_handler</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_check_deny</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_set_handler</span><span class="p">[</span><span class="s1">&#39;Sewer&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_set_sewer</span>

        <span class="c1">#Create subsurface runoff, surface runoff and percolation tanks</span>
        <span class="c1">#Can also do as timearea if this seems dodge (that is how it is done in IHACRES)</span>
        <span class="c1">#TODO should these be decayresidencetanks?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subsurface_runoff</span> <span class="o">=</span> <span class="n">ResidenceTank</span><span class="p">(</span><span class="n">residence_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subsurface_residence_time</span><span class="p">,</span> 
                                               <span class="n">capacity</span> <span class="o">=</span> <span class="n">constants</span><span class="o">.</span><span class="n">UNBOUNDED_CAPACITY</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">percolation</span> <span class="o">=</span> <span class="n">ResidenceTank</span><span class="p">(</span><span class="n">residence_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">percolation_residence_time</span><span class="p">,</span>
                                         <span class="n">capacity</span> <span class="o">=</span> <span class="n">constants</span><span class="o">.</span><span class="n">UNBOUNDED_CAPACITY</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">surface_runoff</span> <span class="o">=</span> <span class="n">ResidenceTank</span><span class="p">(</span><span class="n">residence_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">surface_residence_time</span><span class="p">,</span>
                                            <span class="n">capacity</span> <span class="o">=</span> <span class="n">constants</span><span class="o">.</span><span class="n">UNBOUNDED_CAPACITY</span><span class="p">)</span>

        <span class="c1">#Store surfaces</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">surfaces</span> <span class="o">=</span> <span class="n">surfaces</span>

        <span class="c1">#Mass balance checkign vqips and functions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">running_inflow_mb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">running_outflow_mb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mass_balance_in</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="k">lambda</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">running_inflow_mb</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mass_balance_out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="k">lambda</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">running_outflow_mb</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mass_balance_ds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">surface_runoff</span><span class="o">.</span><span class="n">ds</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mass_balance_ds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subsurface_runoff</span><span class="o">.</span><span class="n">ds</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mass_balance_ds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">percolation</span><span class="o">.</span><span class="n">ds</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">apply_irrigation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Iterate over any irrigation functions (needs further testing.. maybe)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">irrigation_functions</span><span class="p">:</span>
            <span class="n">f</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Call the run function in all surfaces, update surface/subsurface/</span>
<span class="sd">        percolation tanks, discharge to rivers/groundwater</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">#Run all surfaces</span>
        <span class="k">for</span> <span class="n">surface</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">surfaces</span><span class="p">:</span>
            <span class="n">surface</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

        <span class="c1">#Apply residence time to percolation</span>
        <span class="n">percolation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">percolation</span><span class="o">.</span><span class="n">pull_outflow</span><span class="p">()</span>

        <span class="c1">#Distribute percolation</span>
        <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_distributed</span><span class="p">(</span><span class="n">percolation</span><span class="p">,</span> <span class="n">of_type</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Groundwater&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">constants</span><span class="o">.</span><span class="n">FLOAT_ACCURACY</span><span class="p">:</span>
            <span class="c1">#Update percolation &#39;tank&#39;</span>
            <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">percolation</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">reply</span><span class="p">,</span> <span class="n">force</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

        <span class="c1">#Apply residence time to subsurface/surface runoff</span>
        <span class="n">surface_runoff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">surface_runoff</span><span class="o">.</span><span class="n">pull_outflow</span><span class="p">()</span>
        <span class="n">subsurface_runoff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subsurface_runoff</span><span class="o">.</span><span class="n">pull_outflow</span><span class="p">()</span>

        <span class="c1">#Total runoff</span>
        <span class="n">total_runoff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum_vqip</span><span class="p">(</span><span class="n">surface_runoff</span><span class="p">,</span> <span class="n">subsurface_runoff</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">total_runoff</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1">#Send to rivers (or nodes, which are assumed to be junctions)</span>
            <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_distributed</span><span class="p">(</span><span class="n">total_runoff</span><span class="p">,</span> <span class="n">of_type</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;River&#39;</span><span class="p">,</span><span class="s1">&#39;Node&#39;</span><span class="p">])</span>

            <span class="c1">#Redistribute total_runoff not sent</span>
            <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">reply_surface</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_change_vqip</span><span class="p">(</span><span class="n">reply</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">surface_runoff</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">total_runoff</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">])</span>
                <span class="n">reply_subsurface</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_change_vqip</span><span class="p">(</span><span class="n">reply</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">subsurface_runoff</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">total_runoff</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">])</span>

                <span class="c1">#Update surface/subsurface runoff &#39;tanks&#39;</span>
                <span class="k">if</span> <span class="n">reply_surface</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">surface_runoff</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">reply_surface</span><span class="p">,</span> <span class="n">force</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">reply_subsurface</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">subsurface_runoff</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">reply_subsurface</span><span class="p">,</span> <span class="n">force</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">push_set_sewer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vqip</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Receive water from a sewer and send it to the first ImperviousSurface in </span>
<span class="sd">        surfaces. </span>

<span class="sd">        Args:</span>
<span class="sd">            vqip (dict): A VQIP amount to be sent to the impervious surface</span>

<span class="sd">        Returns:</span>
<span class="sd">            vqip (dict): A VQIP amount of water that was not received</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#TODO currently just push to the first impervious surface... not sure if people will be having multiple impervious surfaces. If people would be only having one then it would make sense to store as a parameter... this is probably fine for now</span>
        <span class="k">for</span> <span class="n">surface</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">surfaces</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">surface</span><span class="p">,</span> <span class="n">ImperviousSurface</span><span class="p">):</span>
                <span class="n">vqip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">surface</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">vqip</span><span class="p">,</span> <span class="n">force</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
                <span class="k">break</span>
        <span class="k">return</span> <span class="n">vqip</span>

    <span class="k">def</span> <span class="nf">end_timestep</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update mass balance and end timestep of all tanks (and surfaces)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">running_inflow_mb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">running_outflow_mb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">tanks</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">surfaces</span> <span class="o">+</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">surface_runoff</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">subsurface_runoff</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">percolation</span><span class="p">]:</span>
            <span class="n">tanks</span><span class="o">.</span><span class="n">end_timestep</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_surface</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">surface_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a surface from the list of surfaces by the &#39;surface&#39; entry</span>
<span class="sd">        in the surface. I.e., the name of the surface</span>

<span class="sd">        Args:</span>
<span class="sd">            surface_ (str): Name of the surface</span>

<span class="sd">        Returns:</span>
<span class="sd">            surface (Surface): The first surface that matches the name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">surface</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">surfaces</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">surface</span><span class="o">.</span><span class="n">surface</span> <span class="o">==</span> <span class="n">surface_</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">surface</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">reinit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_timestep</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">surface</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">surfaces</span> <span class="o">+</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">surface_runoff</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">subsurface_runoff</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">percolation</span><span class="p">]:</span>
            <span class="n">surface</span><span class="o">.</span><span class="n">reinit</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.land.Land.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">subsurface_residence_time</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">percolation_residence_time</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">surface_residence_time</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">surfaces</span><span class="o">=</span><span class="p">[],</span> <span class="n">data_input_dict</span><span class="o">=</span><span class="p">{})</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>An extensive node class that represents land processes (agriculture, soil, 
subsurface flow, rural runoff, urban drainage, pollution deposition). The 
expected use is that each distinctive type of land cover (different crop 
types, gardens, forests, impervious urban drainage, etc.) each have a Surface 
object, which is a subclass of Tank. The land node will iterate over its 
surfaces each timestep, which will generally (except in the case of an 
impervious surface) send water to three common Tanks: surface flow, 
subsurface flow and percolation. These tanks will then send flows to rivers 
or groundwater.</p>
<p>(See wsimod/nodes/land.py/Surface and subclasses for currently available 
surfaces)</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>name</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>node name.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>subsurface_residence_time</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Residence time for   <br />
subsurface flow (see nodes.py/ResidenceTank). Defaults to 5.</p></td>
          <td>
                <code>5</code>
          </td>
        </tr>
        <tr>
          <td><code>percolation_residence_time</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Residence time for 
percolation flow (see nodes.py/ResidenceTank). Defaults to 50.</p></td>
          <td>
                <code>50</code>
          </td>
        </tr>
        <tr>
          <td><code>surface_residence_time</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Residence time for surface flow
(see nodes.py/ResidenceTank). Defaults to 1.</p></td>
          <td>
                <code>1</code>
          </td>
        </tr>
        <tr>
          <td><code>surfaces</code></td>
          <td>
                <code>list</code>
          </td>
          <td><p>list of dicts where each dict describes the 
parameters of each surface in the Land node. Each dict also contains 
an entry under 'type_' which describes which subclass of surface to 
use. Defaults to [].</p></td>
          <td>
                <code>[]</code>
          </td>
        </tr>
        <tr>
          <td><code>data_input_dict</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>Dictionary of data inputs relevant for 
the node (generally, et0, precipitation and temperature). Keys are 
tuples where first value is the name of the variable to read from the 
dict and the second value is the time. Defaults to {}.</p></td>
          <td>
                <code>{}</code>
          </td>
        </tr>
    </tbody>
  </table>

<details class="functions-intended-to-call-in-orchestration">
  <summary>Functions intended to call in orchestration</summary>
  <p>run</p>
<p>apply_irrigation (if used)</p>
</details>
      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\land.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                    <span class="n">name</span><span class="p">,</span>
                    <span class="n">subsurface_residence_time</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
                    <span class="n">percolation_residence_time</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
                    <span class="n">surface_residence_time</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="n">surfaces</span> <span class="o">=</span> <span class="p">[],</span>
                    <span class="n">data_input_dict</span> <span class="o">=</span> <span class="p">{}):</span>
    <span class="sd">&quot;&quot;&quot;An extensive node class that represents land processes (agriculture, soil, </span>
<span class="sd">    subsurface flow, rural runoff, urban drainage, pollution deposition). The </span>
<span class="sd">    expected use is that each distinctive type of land cover (different crop </span>
<span class="sd">    types, gardens, forests, impervious urban drainage, etc.) each have a Surface </span>
<span class="sd">    object, which is a subclass of Tank. The land node will iterate over its </span>
<span class="sd">    surfaces each timestep, which will generally (except in the case of an </span>
<span class="sd">    impervious surface) send water to three common Tanks: surface flow, </span>
<span class="sd">    subsurface flow and percolation. These tanks will then send flows to rivers </span>
<span class="sd">    or groundwater.</span>

<span class="sd">    (See wsimod/nodes/land.py/Surface and subclasses for currently available </span>
<span class="sd">    surfaces)</span>

<span class="sd">    Args:</span>
<span class="sd">        name (str): node name.</span>
<span class="sd">        subsurface_residence_time (float, optional): Residence time for     </span>
<span class="sd">            subsurface flow (see nodes.py/ResidenceTank). Defaults to 5.</span>
<span class="sd">        percolation_residence_time (int, optional): Residence time for </span>
<span class="sd">            percolation flow (see nodes.py/ResidenceTank). Defaults to 50.</span>
<span class="sd">        surface_residence_time (int, optional): Residence time for surface flow</span>
<span class="sd">            (see nodes.py/ResidenceTank). Defaults to 1.</span>
<span class="sd">        surfaces (list, optional): list of dicts where each dict describes the </span>
<span class="sd">            parameters of each surface in the Land node. Each dict also contains </span>
<span class="sd">            an entry under &#39;type_&#39; which describes which subclass of surface to </span>
<span class="sd">            use. Defaults to [].</span>
<span class="sd">        data_input_dict (dict, optional): Dictionary of data inputs relevant for </span>
<span class="sd">            the node (generally, et0, precipitation and temperature). Keys are </span>
<span class="sd">            tuples where first value is the name of the variable to read from the </span>
<span class="sd">            dict and the second value is the time. Defaults to {}.</span>

<span class="sd">    Functions intended to call in orchestration:</span>
<span class="sd">        run</span>

<span class="sd">        apply_irrigation (if used)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#Assign parameters</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">subsurface_residence_time</span> <span class="o">=</span> <span class="n">subsurface_residence_time</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">percolation_residence_time</span> <span class="o">=</span> <span class="n">percolation_residence_time</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">surface_residence_time</span> <span class="o">=</span> <span class="n">surface_residence_time</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data_input_dict</span> <span class="o">=</span> <span class="n">data_input_dict</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">data_input_dict</span> <span class="o">=</span> <span class="n">data_input_dict</span><span class="p">)</span>

    <span class="c1">#This could be a deny but then you would have to know in advance whether a demand node has any gardening or not</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">push_check_handler</span><span class="p">[(</span><span class="s1">&#39;Demand&#39;</span><span class="p">,</span><span class="s1">&#39;Garden&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">push_set_handler</span><span class="p">[(</span><span class="s1">&#39;Demand&#39;</span><span class="p">,</span><span class="s1">&#39;Garden&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>

    <span class="c1">#Create surfaces</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">irrigation_functions</span> <span class="o">=</span> <span class="p">[</span><span class="k">lambda</span> <span class="p">:</span> <span class="kc">None</span><span class="p">]</span>

    <span class="n">surfaces_</span> <span class="o">=</span> <span class="n">surfaces</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">surfaces</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">surface</span> <span class="ow">in</span> <span class="n">surfaces_</span><span class="p">:</span>
        <span class="c1">#Assign parent (for data reading and to determine where to send flows to)</span>
        <span class="n">surface</span><span class="p">[</span><span class="s1">&#39;parent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="c1">#Get surface type</span>
        <span class="n">type_</span> <span class="o">=</span> <span class="n">surface</span><span class="p">[</span><span class="s1">&#39;type_&#39;</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">surface</span><span class="p">[</span><span class="s1">&#39;type_&#39;</span><span class="p">]</span>

        <span class="c1">#Instantiate surface and store in list of surfaces</span>
        <span class="n">surfaces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="vm">__name__</span><span class="p">],</span> <span class="n">type_</span><span class="p">)(</span><span class="o">**</span><span class="n">surface</span><span class="p">))</span>

        <span class="c1">#Assign ds (mass balance checking)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mass_balance_ds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">surfaces</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">ds</span><span class="p">)</span>

        <span class="c1">#Assign any irrigation functions </span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">surfaces</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">IrrigationSurface</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">irrigation_functions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">surfaces</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">irrigate</span><span class="p">)</span>

        <span class="c1">#Assign garden surface functions</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">surfaces</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">GardenSurface</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push_check_handler</span><span class="p">[(</span><span class="s1">&#39;Demand&#39;</span><span class="p">,</span><span class="s1">&#39;Garden&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">surfaces</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">calculate_irrigation_demand</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push_set_handler</span><span class="p">[(</span><span class="s1">&#39;Demand&#39;</span><span class="p">,</span><span class="s1">&#39;Garden&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">surfaces</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">receive_irrigation_demand</span>

    <span class="c1">#Update handlers</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">push_set_handler</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_set_deny</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">push_check_handler</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_check_deny</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">push_set_handler</span><span class="p">[</span><span class="s1">&#39;Sewer&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_set_sewer</span>

    <span class="c1">#Create subsurface runoff, surface runoff and percolation tanks</span>
    <span class="c1">#Can also do as timearea if this seems dodge (that is how it is done in IHACRES)</span>
    <span class="c1">#TODO should these be decayresidencetanks?</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">subsurface_runoff</span> <span class="o">=</span> <span class="n">ResidenceTank</span><span class="p">(</span><span class="n">residence_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subsurface_residence_time</span><span class="p">,</span> 
                                           <span class="n">capacity</span> <span class="o">=</span> <span class="n">constants</span><span class="o">.</span><span class="n">UNBOUNDED_CAPACITY</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">percolation</span> <span class="o">=</span> <span class="n">ResidenceTank</span><span class="p">(</span><span class="n">residence_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">percolation_residence_time</span><span class="p">,</span>
                                     <span class="n">capacity</span> <span class="o">=</span> <span class="n">constants</span><span class="o">.</span><span class="n">UNBOUNDED_CAPACITY</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">surface_runoff</span> <span class="o">=</span> <span class="n">ResidenceTank</span><span class="p">(</span><span class="n">residence_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">surface_residence_time</span><span class="p">,</span>
                                        <span class="n">capacity</span> <span class="o">=</span> <span class="n">constants</span><span class="o">.</span><span class="n">UNBOUNDED_CAPACITY</span><span class="p">)</span>

    <span class="c1">#Store surfaces</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">surfaces</span> <span class="o">=</span> <span class="n">surfaces</span>

    <span class="c1">#Mass balance checkign vqips and functions</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">running_inflow_mb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">running_outflow_mb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">mass_balance_in</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="k">lambda</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">running_inflow_mb</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mass_balance_out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="k">lambda</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">running_outflow_mb</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mass_balance_ds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">surface_runoff</span><span class="o">.</span><span class="n">ds</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mass_balance_ds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subsurface_runoff</span><span class="o">.</span><span class="n">ds</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mass_balance_ds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">percolation</span><span class="o">.</span><span class="n">ds</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.land.Land.apply_irrigation" class="doc doc-heading">
<code class="highlight language-python"><span class="n">apply_irrigation</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Iterate over any irrigation functions (needs further testing.. maybe)</p>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\land.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">apply_irrigation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Iterate over any irrigation functions (needs further testing.. maybe)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">irrigation_functions</span><span class="p">:</span>
        <span class="n">f</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.land.Land.end_timestep" class="doc doc-heading">
<code class="highlight language-python"><span class="n">end_timestep</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Update mass balance and end timestep of all tanks (and surfaces)</p>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\land.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">end_timestep</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Update mass balance and end timestep of all tanks (and surfaces)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">running_inflow_mb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">running_outflow_mb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">tanks</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">surfaces</span> <span class="o">+</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">surface_runoff</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">subsurface_runoff</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">percolation</span><span class="p">]:</span>
        <span class="n">tanks</span><span class="o">.</span><span class="n">end_timestep</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.land.Land.get_surface" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_surface</span><span class="p">(</span><span class="n">surface_</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Return a surface from the list of surfaces by the 'surface' entry
in the surface. I.e., the name of the surface</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>surface_</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Name of the surface</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>surface</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="wsimod.nodes.land.Surface" href="#wsimod.nodes.land.Surface">Surface</a></code>
          </td>
          <td><p>The first surface that matches the name</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\land.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_surface</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">surface_</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return a surface from the list of surfaces by the &#39;surface&#39; entry</span>
<span class="sd">    in the surface. I.e., the name of the surface</span>

<span class="sd">    Args:</span>
<span class="sd">        surface_ (str): Name of the surface</span>

<span class="sd">    Returns:</span>
<span class="sd">        surface (Surface): The first surface that matches the name</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">surface</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">surfaces</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">surface</span><span class="o">.</span><span class="n">surface</span> <span class="o">==</span> <span class="n">surface_</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">surface</span>
    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.land.Land.push_set_sewer" class="doc doc-heading">
<code class="highlight language-python"><span class="n">push_set_sewer</span><span class="p">(</span><span class="n">vqip</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Receive water from a sewer and send it to the first ImperviousSurface in 
surfaces. </p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>vqip</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>A VQIP amount to be sent to the impervious surface</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>vqip</code></td>          <td>
                <code>dict</code>
          </td>
          <td><p>A VQIP amount of water that was not received</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\land.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">push_set_sewer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vqip</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Receive water from a sewer and send it to the first ImperviousSurface in </span>
<span class="sd">    surfaces. </span>

<span class="sd">    Args:</span>
<span class="sd">        vqip (dict): A VQIP amount to be sent to the impervious surface</span>

<span class="sd">    Returns:</span>
<span class="sd">        vqip (dict): A VQIP amount of water that was not received</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#TODO currently just push to the first impervious surface... not sure if people will be having multiple impervious surfaces. If people would be only having one then it would make sense to store as a parameter... this is probably fine for now</span>
    <span class="k">for</span> <span class="n">surface</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">surfaces</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">surface</span><span class="p">,</span> <span class="n">ImperviousSurface</span><span class="p">):</span>
            <span class="n">vqip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">surface</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">vqip</span><span class="p">,</span> <span class="n">force</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="k">break</span>
    <span class="k">return</span> <span class="n">vqip</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.land.Land.run" class="doc doc-heading">
<code class="highlight language-python"><span class="n">run</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Call the run function in all surfaces, update surface/subsurface/
percolation tanks, discharge to rivers/groundwater</p>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\land.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Call the run function in all surfaces, update surface/subsurface/</span>
<span class="sd">    percolation tanks, discharge to rivers/groundwater</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#Run all surfaces</span>
    <span class="k">for</span> <span class="n">surface</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">surfaces</span><span class="p">:</span>
        <span class="n">surface</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

    <span class="c1">#Apply residence time to percolation</span>
    <span class="n">percolation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">percolation</span><span class="o">.</span><span class="n">pull_outflow</span><span class="p">()</span>

    <span class="c1">#Distribute percolation</span>
    <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_distributed</span><span class="p">(</span><span class="n">percolation</span><span class="p">,</span> <span class="n">of_type</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Groundwater&#39;</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">constants</span><span class="o">.</span><span class="n">FLOAT_ACCURACY</span><span class="p">:</span>
        <span class="c1">#Update percolation &#39;tank&#39;</span>
        <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">percolation</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">reply</span><span class="p">,</span> <span class="n">force</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

    <span class="c1">#Apply residence time to subsurface/surface runoff</span>
    <span class="n">surface_runoff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">surface_runoff</span><span class="o">.</span><span class="n">pull_outflow</span><span class="p">()</span>
    <span class="n">subsurface_runoff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subsurface_runoff</span><span class="o">.</span><span class="n">pull_outflow</span><span class="p">()</span>

    <span class="c1">#Total runoff</span>
    <span class="n">total_runoff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum_vqip</span><span class="p">(</span><span class="n">surface_runoff</span><span class="p">,</span> <span class="n">subsurface_runoff</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">total_runoff</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1">#Send to rivers (or nodes, which are assumed to be junctions)</span>
        <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_distributed</span><span class="p">(</span><span class="n">total_runoff</span><span class="p">,</span> <span class="n">of_type</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;River&#39;</span><span class="p">,</span><span class="s1">&#39;Node&#39;</span><span class="p">])</span>

        <span class="c1">#Redistribute total_runoff not sent</span>
        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">reply_surface</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_change_vqip</span><span class="p">(</span><span class="n">reply</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">surface_runoff</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">total_runoff</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">])</span>
            <span class="n">reply_subsurface</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_change_vqip</span><span class="p">(</span><span class="n">reply</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">subsurface_runoff</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">total_runoff</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">])</span>

            <span class="c1">#Update surface/subsurface runoff &#39;tanks&#39;</span>
            <span class="k">if</span> <span class="n">reply_surface</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">surface_runoff</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">reply_surface</span><span class="p">,</span> <span class="n">force</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">reply_subsurface</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">subsurface_runoff</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">reply_subsurface</span><span class="p">,</span> <span class="n">force</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="wsimod.nodes.land.PerviousSurface" class="doc doc-heading">
        <code>PerviousSurface</code>


</h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="wsimod.nodes.land.Surface" href="#wsimod.nodes.land.Surface">Surface</a></code></p>



        <details class="quote">
          <summary>Source code in <code>wsimod\nodes\land.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">PerviousSurface</span><span class="p">(</span><span class="n">Surface</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                        <span class="n">depth</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span>
                        <span class="n">field_capacity</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span>
                        <span class="n">wilting_point</span> <span class="o">=</span> <span class="mf">0.12</span><span class="p">,</span>
                        <span class="n">infiltration_capacity</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
                        <span class="n">surface_coefficient</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
                        <span class="n">percolation_coefficient</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span>
                        <span class="n">et0_coefficient</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
                        <span class="n">ihacres_p</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
                        <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A generic pervious surface that represents hydrology with the IHACRES model.</span>

<span class="sd">        Args:</span>
<span class="sd">            depth (float, optional): Soil tank (i.e., root) depth. Defaults to 0.75.</span>
<span class="sd">            field_capacity (float, optional): The field capacity IHACRES parameter</span>
<span class="sd">                (i.e., when water content in the soil tank is above this value - flows </span>
<span class="sd">                of any kind can be generated). Defaults to 0.3.</span>
<span class="sd">            wilting_point (float, optional): The wilting point IHACRES parameter (i.e., </span>
<span class="sd">                when water content content in the soil tank is above this value - </span>
<span class="sd">                plants can uptake water and evaporation from the soil tank can occur). </span>
<span class="sd">                Defaults to 0.12.</span>
<span class="sd">            infiltration_capacity (float, optional): Depth of water per day that can </span>
<span class="sd">                enter the soil tank. Non infiltrated water will pond and travel as </span>
<span class="sd">                surface runoff from the parent Land node. Defaults to 0.5.</span>
<span class="sd">            surface_coefficient (float, optional): If flow is generated, the proportion </span>
<span class="sd">                of flow that goes to surface runoff. Defaults to 0.05.</span>
<span class="sd">            percolation_coefficient (float, optional): If flow is generated, then the </span>
<span class="sd">                proportion of water that does not go to surface runoff that goes to </span>
<span class="sd">                percolation (i.e., groundwater) - the remainder goes to subsurface </span>
<span class="sd">                runoff. Defaults to 0.75.</span>
<span class="sd">            et0_coefficient (float, optional): Convert between the parent nodes data </span>
<span class="sd">                timeseries et0 - and potential evaptranspiration per unit area for this </span>
<span class="sd">                surface. Defaults to=0.5,</span>
<span class="sd">            ihacres_p (float, optional): The IHACRES p parameter. Unless it is an </span>
<span class="sd">                ephemeral stream this parameter probably can stay high. Defaults to 10.</span>
<span class="sd">        &quot;&quot;&quot;</span>
       <span class="c1">#Assign parameters (converting field capacity and wilting point to depth)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">field_capacity</span> <span class="o">=</span> <span class="n">field_capacity</span> <span class="o">*</span> <span class="n">depth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wilting_point</span> <span class="o">=</span> <span class="n">wilting_point</span> <span class="o">*</span> <span class="n">depth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">infiltration_capacity</span> <span class="o">=</span> <span class="n">infiltration_capacity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">surface_coefficient</span> <span class="o">=</span> <span class="n">surface_coefficient</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">percolation_coefficient</span> <span class="o">=</span> <span class="n">percolation_coefficient</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">et0_coefficient</span> <span class="o">=</span> <span class="n">et0_coefficient</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ihacres_p</span> <span class="o">=</span> <span class="n">ihacres_p</span>       

        <span class="c1">#Parameters to determine how to calculate the temperature of outflowing water</span>
        <span class="c1">#TODO what should these params be?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">soil_temp_w_prev</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="c1">#previous timestep weighting</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">soil_temp_w_air</span> <span class="o">=</span> <span class="mf">0.6</span> <span class="c1">#air temperature weighting</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">soil_temp_w_deep</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="c1">#deep soil temperature weighting</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">soil_temp_deep</span> <span class="o">=</span> <span class="mi">10</span> <span class="c1">#deep soil temperature</span>

        <span class="c1">#IHACRES is a deficit not a tank, so doesn&#39;t really have a capacity in this way... and if it did.. I don&#39;t know if it would be the root depth</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">depth</span><span class="o">=</span><span class="n">depth</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1">#Calculate subsurface coefficient</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subsurface_coefficient</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">percolation_coefficient</span> 


        <span class="c1">#Initiliase state variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">infiltration_excess</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subsurface_flow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">percolation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tank_recharge</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evaporation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">precipitation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>

        <span class="c1">#Populate function lists</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inflows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ihacres</span><span class="p">)</span> <span class="c1">#work out runoff</span>

        <span class="c1">#TODO interception if I hate myself enough?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calculate_soil_temperature</span><span class="p">)</span> <span class="c1"># Calculate soil temp + dependence factor</span>

        <span class="c1"># self.processes.append(self.decay) #apply generic decay (currently handled by decaytank at end of timestep)</span>
        <span class="c1">#TODO decaytank uses air temperature not soil temperature... probably need to just give it the decay function</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">outflows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">route</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_cmd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate moisture deficit (i.e., the tank excess converted to depth)</span>

<span class="sd">        Returns:</span>
<span class="sd">            (float): current moisture deficit</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_excess</span><span class="p">()[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>

    <span class="k">def</span> <span class="nf">get_smc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate moisture content (i.e., the tank volume converted to depth)</span>

<span class="sd">        Returns:</span>
<span class="sd">            (float): soil moisture content</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#Depth of soil moisture</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>

    <span class="k">def</span> <span class="nf">ihacres</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Inflow function that runs the IHACRES model equations, updates tanks, and </span>
<span class="sd">        store flows in state variables (which are later sent to the parent land node in </span>
<span class="sd">        the route function)</span>

<span class="sd">        Returns:</span>
<span class="sd">            (tuple): A tuple containing a VQIP amount for model inputs and outputs </span>
<span class="sd">                for mass balance checking. </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">#Read data (leave in depth units since that is what IHACRES equations are in)</span>
        <span class="n">precipitation_depth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_input</span><span class="p">(</span><span class="s1">&#39;precipitation&#39;</span><span class="p">)</span>
        <span class="n">evaporation_depth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_input</span><span class="p">(</span><span class="s1">&#39;et0&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">et0_coefficient</span>
        <span class="n">temperature</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_input</span><span class="p">(</span><span class="s1">&#39;temperature&#39;</span><span class="p">)</span>

        <span class="c1">#Apply infiltration</span>
        <span class="n">infiltrated_precipitation</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">precipitation_depth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">infiltration_capacity</span><span class="p">)</span>
        <span class="n">infiltration_excess</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">precipitation_depth</span> <span class="o">-</span> <span class="n">infiltrated_precipitation</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> 

        <span class="c1">#Get current moisture deficit</span>
        <span class="n">current_moisture_deficit_depth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cmd</span><span class="p">()</span>

        <span class="c1">#IHACRES equations (we do (depth - wilting_point or field capacity) to convert from a deficit to storage tank)</span>
        <span class="n">evaporation</span> <span class="o">=</span> <span class="n">evaporation_depth</span> <span class="o">*</span> <span class="nb">min</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">exp</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">current_moisture_deficit_depth</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">wilting_point</span><span class="p">))))</span>
        <span class="n">outflow</span> <span class="o">=</span> <span class="n">infiltrated_precipitation</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">current_moisture_deficit_depth</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_capacity</span><span class="p">))</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">ihacres_p</span><span class="p">))</span>

        <span class="c1">#Can&#39;t evaporate more than available moisture (presumably the IHACRES equation prevents this ever being needed)</span>
        <span class="n">evaporation</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">evaporation</span><span class="p">,</span> <span class="n">precipitation_depth</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_smc</span><span class="p">())</span>

        <span class="c1">#Scale to volumes and apply proportions to work out percolation/surface runoff/subsurface runoff</span>
        <span class="n">surface</span> <span class="o">=</span> <span class="n">outflow</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">surface_coefficient</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>
        <span class="n">percolation</span> <span class="o">=</span> <span class="n">outflow</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">surface_coefficient</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">percolation_coefficient</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>
        <span class="n">subsurface_flow</span> <span class="o">=</span> <span class="n">outflow</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">surface_coefficient</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">subsurface_coefficient</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>
        <span class="n">tank_recharge</span> <span class="o">=</span> <span class="p">(</span><span class="n">infiltrated_precipitation</span> <span class="o">-</span> <span class="n">evaporation</span> <span class="o">-</span> <span class="n">outflow</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>
        <span class="n">infiltration_excess</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>
        <span class="n">infiltration_excess</span> <span class="o">+=</span> <span class="n">surface</span>
        <span class="n">evaporation</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>
        <span class="n">precipitation</span> <span class="o">=</span> <span class="n">precipitation_depth</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>

        <span class="c1">#Mix in tank to calculate pollutant concentrations</span>
        <span class="n">total_water_passing_through_soil_tank</span> <span class="o">=</span> <span class="n">tank_recharge</span> <span class="o">+</span> <span class="n">subsurface_flow</span> <span class="o">+</span> <span class="n">percolation</span>

        <span class="k">if</span> <span class="n">total_water_passing_through_soil_tank</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1">#Net effective preipitation</span>
            <span class="n">total_water_passing_through_soil_tank</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_change_vqip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">(),</span> <span class="n">total_water_passing_through_soil_tank</span><span class="p">)</span>
            <span class="c1">#Assign a temperature before sending into tank</span>
            <span class="n">total_water_passing_through_soil_tank</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temperature</span>
            <span class="c1">#Assign to tank</span>
            <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">total_water_passing_through_soil_tank</span><span class="p">,</span> <span class="n">force</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="c1">#Pull flows (which now have nonzero pollutant concentrations)</span>
            <span class="n">subsurface_flow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pull_storage</span><span class="p">({</span><span class="s1">&#39;volume&#39;</span><span class="p">:</span> <span class="n">subsurface_flow</span><span class="p">})</span>
            <span class="n">percolation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pull_storage</span><span class="p">({</span><span class="s1">&#39;volume&#39;</span><span class="p">:</span><span class="n">percolation</span><span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#No net effective precipitation (instead evaporation occurs)</span>
            <span class="n">evap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaporate</span><span class="p">(</span><span class="o">-</span><span class="n">total_water_passing_through_soil_tank</span><span class="p">)</span>
            <span class="n">subsurface_flow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
            <span class="n">percolation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>

            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">evap</span> <span class="o">+</span> <span class="n">infiltrated_precipitation</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span> <span class="o">-</span> <span class="n">evaporation</span> <span class="o">-</span> <span class="n">infiltration_excess</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">constants</span><span class="o">.</span><span class="n">FLOAT_ACCURACY</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;inaccurate evaporation calculation&#39;</span><span class="p">)</span>

        <span class="c1">#TODO saturation excess (think it should just be &#39;pull_ponded&#39;  presumably in net effective precipitation? )</span>

        <span class="c1">#Convert to VQIPs</span>
        <span class="n">infiltration_excess</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_change_vqip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">(),</span> <span class="n">infiltration_excess</span><span class="p">)</span>
        <span class="n">infiltration_excess</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temperature</span>
        <span class="n">precipitation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_change_vqip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">(),</span> <span class="n">precipitation</span><span class="p">)</span>
        <span class="n">evaporation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_change_vqip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">(),</span> <span class="n">evaporation</span><span class="p">)</span>

        <span class="c1">#Track flows (these are sent onwards in the route function)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">infiltration_excess</span> <span class="o">=</span> <span class="n">infiltration_excess</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subsurface_flow</span> <span class="o">=</span> <span class="n">subsurface_flow</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">percolation</span> <span class="o">=</span> <span class="n">percolation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tank_recharge</span> <span class="o">=</span> <span class="n">tank_recharge</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evaporation</span> <span class="o">=</span> <span class="n">evaporation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">precipitation</span> <span class="o">=</span> <span class="n">precipitation</span>

        <span class="c1">#Mass balance</span>
        <span class="n">in_</span> <span class="o">=</span> <span class="n">precipitation</span>
        <span class="n">out_</span> <span class="o">=</span> <span class="n">evaporation</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">in_</span><span class="p">,</span> <span class="n">out_</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">route</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;An outflow function that sends percolation, subsurface runoff and surface runoff to their respective tanks in the parent land node.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (tuple): A tuple containing a VQIP amount for model inputs and outputs </span>
<span class="sd">                for mass balance checking. </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">surface_runoff</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">infiltration_excess</span><span class="p">,</span> <span class="n">force</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">subsurface_runoff</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subsurface_flow</span><span class="p">,</span> <span class="n">force</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">percolation</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">percolation</span><span class="p">,</span> <span class="n">force</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">())</span>


    <span class="k">def</span> <span class="nf">calculate_soil_temperature</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Process function that calculates soil temperature based on a weighted </span>
<span class="sd">        average. This equation is from Lindstrom, Bishop &amp; Lofvenius (2002), </span>
<span class="sd">        hydrological processes - but it is not clear what the parameters should be.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (tuple): A tuple containing a VQIP amount for model inputs and outputs </span>
<span class="sd">                for mass balance checking. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">auto</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">soil_temp_w_prev</span>
        <span class="n">air</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_input</span><span class="p">(</span><span class="s1">&#39;temperature&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">soil_temp_w_air</span>
        <span class="n">total_weight</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">soil_temp_w_air</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">soil_temp_w_deep</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">soil_temp_w_prev</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">auto</span> <span class="o">+</span> <span class="n">air</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">soil_temp_deep</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">soil_temp_w_deep</span><span class="p">)</span><span class="o">/</span><span class="n">total_weight</span>

        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">())</span>  
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.land.PerviousSurface.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">depth</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">field_capacity</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">wilting_point</span><span class="o">=</span><span class="mf">0.12</span><span class="p">,</span> <span class="n">infiltration_capacity</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">surface_coefficient</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">percolation_coefficient</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">et0_coefficient</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">ihacres_p</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>A generic pervious surface that represents hydrology with the IHACRES model.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>depth</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Soil tank (i.e., root) depth. Defaults to 0.75.</p></td>
          <td>
                <code>0.75</code>
          </td>
        </tr>
        <tr>
          <td><code>field_capacity</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>The field capacity IHACRES parameter
(i.e., when water content in the soil tank is above this value - flows 
of any kind can be generated). Defaults to 0.3.</p></td>
          <td>
                <code>0.3</code>
          </td>
        </tr>
        <tr>
          <td><code>wilting_point</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>The wilting point IHACRES parameter (i.e., 
when water content content in the soil tank is above this value - 
plants can uptake water and evaporation from the soil tank can occur). 
Defaults to 0.12.</p></td>
          <td>
                <code>0.12</code>
          </td>
        </tr>
        <tr>
          <td><code>infiltration_capacity</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Depth of water per day that can 
enter the soil tank. Non infiltrated water will pond and travel as 
surface runoff from the parent Land node. Defaults to 0.5.</p></td>
          <td>
                <code>0.5</code>
          </td>
        </tr>
        <tr>
          <td><code>surface_coefficient</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>If flow is generated, the proportion 
of flow that goes to surface runoff. Defaults to 0.05.</p></td>
          <td>
                <code>0.05</code>
          </td>
        </tr>
        <tr>
          <td><code>percolation_coefficient</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>If flow is generated, then the 
proportion of water that does not go to surface runoff that goes to 
percolation (i.e., groundwater) - the remainder goes to subsurface 
runoff. Defaults to 0.75.</p></td>
          <td>
                <code>0.75</code>
          </td>
        </tr>
        <tr>
          <td><code>et0_coefficient</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Convert between the parent nodes data 
timeseries et0 - and potential evaptranspiration per unit area for this 
surface. Defaults to=0.5,</p></td>
          <td>
                <code>0.5</code>
          </td>
        </tr>
        <tr>
          <td><code>ihacres_p</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>The IHACRES p parameter. Unless it is an 
ephemeral stream this parameter probably can stay high. Defaults to 10.</p></td>
          <td>
                <code>10</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\land.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                    <span class="n">depth</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span>
                    <span class="n">field_capacity</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span>
                    <span class="n">wilting_point</span> <span class="o">=</span> <span class="mf">0.12</span><span class="p">,</span>
                    <span class="n">infiltration_capacity</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
                    <span class="n">surface_coefficient</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
                    <span class="n">percolation_coefficient</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span>
                    <span class="n">et0_coefficient</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
                    <span class="n">ihacres_p</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A generic pervious surface that represents hydrology with the IHACRES model.</span>

<span class="sd">    Args:</span>
<span class="sd">        depth (float, optional): Soil tank (i.e., root) depth. Defaults to 0.75.</span>
<span class="sd">        field_capacity (float, optional): The field capacity IHACRES parameter</span>
<span class="sd">            (i.e., when water content in the soil tank is above this value - flows </span>
<span class="sd">            of any kind can be generated). Defaults to 0.3.</span>
<span class="sd">        wilting_point (float, optional): The wilting point IHACRES parameter (i.e., </span>
<span class="sd">            when water content content in the soil tank is above this value - </span>
<span class="sd">            plants can uptake water and evaporation from the soil tank can occur). </span>
<span class="sd">            Defaults to 0.12.</span>
<span class="sd">        infiltration_capacity (float, optional): Depth of water per day that can </span>
<span class="sd">            enter the soil tank. Non infiltrated water will pond and travel as </span>
<span class="sd">            surface runoff from the parent Land node. Defaults to 0.5.</span>
<span class="sd">        surface_coefficient (float, optional): If flow is generated, the proportion </span>
<span class="sd">            of flow that goes to surface runoff. Defaults to 0.05.</span>
<span class="sd">        percolation_coefficient (float, optional): If flow is generated, then the </span>
<span class="sd">            proportion of water that does not go to surface runoff that goes to </span>
<span class="sd">            percolation (i.e., groundwater) - the remainder goes to subsurface </span>
<span class="sd">            runoff. Defaults to 0.75.</span>
<span class="sd">        et0_coefficient (float, optional): Convert between the parent nodes data </span>
<span class="sd">            timeseries et0 - and potential evaptranspiration per unit area for this </span>
<span class="sd">            surface. Defaults to=0.5,</span>
<span class="sd">        ihacres_p (float, optional): The IHACRES p parameter. Unless it is an </span>
<span class="sd">            ephemeral stream this parameter probably can stay high. Defaults to 10.</span>
<span class="sd">    &quot;&quot;&quot;</span>
   <span class="c1">#Assign parameters (converting field capacity and wilting point to depth)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">field_capacity</span> <span class="o">=</span> <span class="n">field_capacity</span> <span class="o">*</span> <span class="n">depth</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">wilting_point</span> <span class="o">=</span> <span class="n">wilting_point</span> <span class="o">*</span> <span class="n">depth</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">infiltration_capacity</span> <span class="o">=</span> <span class="n">infiltration_capacity</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">surface_coefficient</span> <span class="o">=</span> <span class="n">surface_coefficient</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">percolation_coefficient</span> <span class="o">=</span> <span class="n">percolation_coefficient</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">et0_coefficient</span> <span class="o">=</span> <span class="n">et0_coefficient</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ihacres_p</span> <span class="o">=</span> <span class="n">ihacres_p</span>       

    <span class="c1">#Parameters to determine how to calculate the temperature of outflowing water</span>
    <span class="c1">#TODO what should these params be?</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">soil_temp_w_prev</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="c1">#previous timestep weighting</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">soil_temp_w_air</span> <span class="o">=</span> <span class="mf">0.6</span> <span class="c1">#air temperature weighting</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">soil_temp_w_deep</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="c1">#deep soil temperature weighting</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">soil_temp_deep</span> <span class="o">=</span> <span class="mi">10</span> <span class="c1">#deep soil temperature</span>

    <span class="c1">#IHACRES is a deficit not a tank, so doesn&#39;t really have a capacity in this way... and if it did.. I don&#39;t know if it would be the root depth</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">depth</span><span class="o">=</span><span class="n">depth</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1">#Calculate subsurface coefficient</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">subsurface_coefficient</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">percolation_coefficient</span> 


    <span class="c1">#Initiliase state variables</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">infiltration_excess</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">subsurface_flow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">percolation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tank_recharge</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">evaporation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">precipitation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>

    <span class="c1">#Populate function lists</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">inflows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ihacres</span><span class="p">)</span> <span class="c1">#work out runoff</span>

    <span class="c1">#TODO interception if I hate myself enough?</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">processes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calculate_soil_temperature</span><span class="p">)</span> <span class="c1"># Calculate soil temp + dependence factor</span>

    <span class="c1"># self.processes.append(self.decay) #apply generic decay (currently handled by decaytank at end of timestep)</span>
    <span class="c1">#TODO decaytank uses air temperature not soil temperature... probably need to just give it the decay function</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">outflows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">route</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.land.PerviousSurface.calculate_soil_temperature" class="doc doc-heading">
<code class="highlight language-python"><span class="n">calculate_soil_temperature</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Process function that calculates soil temperature based on a weighted 
average. This equation is from Lindstrom, Bishop &amp; Lofvenius (2002), 
hydrological processes - but it is not clear what the parameters should be.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>tuple</code>
          </td>
          <td><p>A tuple containing a VQIP amount for model inputs and outputs 
for mass balance checking.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\land.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calculate_soil_temperature</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Process function that calculates soil temperature based on a weighted </span>
<span class="sd">    average. This equation is from Lindstrom, Bishop &amp; Lofvenius (2002), </span>
<span class="sd">    hydrological processes - but it is not clear what the parameters should be.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (tuple): A tuple containing a VQIP amount for model inputs and outputs </span>
<span class="sd">            for mass balance checking. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">auto</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">soil_temp_w_prev</span>
    <span class="n">air</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_input</span><span class="p">(</span><span class="s1">&#39;temperature&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">soil_temp_w_air</span>
    <span class="n">total_weight</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">soil_temp_w_air</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">soil_temp_w_deep</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">soil_temp_w_prev</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">auto</span> <span class="o">+</span> <span class="n">air</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">soil_temp_deep</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">soil_temp_w_deep</span><span class="p">)</span><span class="o">/</span><span class="n">total_weight</span>

    <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">())</span>  
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.land.PerviousSurface.get_cmd" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_cmd</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Calculate moisture deficit (i.e., the tank excess converted to depth)</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>float</code>
          </td>
          <td><p>current moisture deficit</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\land.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_cmd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate moisture deficit (i.e., the tank excess converted to depth)</span>

<span class="sd">    Returns:</span>
<span class="sd">        (float): current moisture deficit</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_excess</span><span class="p">()[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.land.PerviousSurface.get_smc" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_smc</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Calculate moisture content (i.e., the tank volume converted to depth)</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>float</code>
          </td>
          <td><p>soil moisture content</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\land.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_smc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate moisture content (i.e., the tank volume converted to depth)</span>

<span class="sd">    Returns:</span>
<span class="sd">        (float): soil moisture content</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#Depth of soil moisture</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.land.PerviousSurface.ihacres" class="doc doc-heading">
<code class="highlight language-python"><span class="n">ihacres</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Inflow function that runs the IHACRES model equations, updates tanks, and 
store flows in state variables (which are later sent to the parent land node in 
the route function)</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>tuple</code>
          </td>
          <td><p>A tuple containing a VQIP amount for model inputs and outputs 
for mass balance checking.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\land.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">ihacres</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Inflow function that runs the IHACRES model equations, updates tanks, and </span>
<span class="sd">    store flows in state variables (which are later sent to the parent land node in </span>
<span class="sd">    the route function)</span>

<span class="sd">    Returns:</span>
<span class="sd">        (tuple): A tuple containing a VQIP amount for model inputs and outputs </span>
<span class="sd">            for mass balance checking. </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#Read data (leave in depth units since that is what IHACRES equations are in)</span>
    <span class="n">precipitation_depth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_input</span><span class="p">(</span><span class="s1">&#39;precipitation&#39;</span><span class="p">)</span>
    <span class="n">evaporation_depth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_input</span><span class="p">(</span><span class="s1">&#39;et0&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">et0_coefficient</span>
    <span class="n">temperature</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_input</span><span class="p">(</span><span class="s1">&#39;temperature&#39;</span><span class="p">)</span>

    <span class="c1">#Apply infiltration</span>
    <span class="n">infiltrated_precipitation</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">precipitation_depth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">infiltration_capacity</span><span class="p">)</span>
    <span class="n">infiltration_excess</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">precipitation_depth</span> <span class="o">-</span> <span class="n">infiltrated_precipitation</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> 

    <span class="c1">#Get current moisture deficit</span>
    <span class="n">current_moisture_deficit_depth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cmd</span><span class="p">()</span>

    <span class="c1">#IHACRES equations (we do (depth - wilting_point or field capacity) to convert from a deficit to storage tank)</span>
    <span class="n">evaporation</span> <span class="o">=</span> <span class="n">evaporation_depth</span> <span class="o">*</span> <span class="nb">min</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">exp</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">current_moisture_deficit_depth</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">wilting_point</span><span class="p">))))</span>
    <span class="n">outflow</span> <span class="o">=</span> <span class="n">infiltrated_precipitation</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">current_moisture_deficit_depth</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_capacity</span><span class="p">))</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">ihacres_p</span><span class="p">))</span>

    <span class="c1">#Can&#39;t evaporate more than available moisture (presumably the IHACRES equation prevents this ever being needed)</span>
    <span class="n">evaporation</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">evaporation</span><span class="p">,</span> <span class="n">precipitation_depth</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_smc</span><span class="p">())</span>

    <span class="c1">#Scale to volumes and apply proportions to work out percolation/surface runoff/subsurface runoff</span>
    <span class="n">surface</span> <span class="o">=</span> <span class="n">outflow</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">surface_coefficient</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>
    <span class="n">percolation</span> <span class="o">=</span> <span class="n">outflow</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">surface_coefficient</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">percolation_coefficient</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>
    <span class="n">subsurface_flow</span> <span class="o">=</span> <span class="n">outflow</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">surface_coefficient</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">subsurface_coefficient</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>
    <span class="n">tank_recharge</span> <span class="o">=</span> <span class="p">(</span><span class="n">infiltrated_precipitation</span> <span class="o">-</span> <span class="n">evaporation</span> <span class="o">-</span> <span class="n">outflow</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>
    <span class="n">infiltration_excess</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>
    <span class="n">infiltration_excess</span> <span class="o">+=</span> <span class="n">surface</span>
    <span class="n">evaporation</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>
    <span class="n">precipitation</span> <span class="o">=</span> <span class="n">precipitation_depth</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>

    <span class="c1">#Mix in tank to calculate pollutant concentrations</span>
    <span class="n">total_water_passing_through_soil_tank</span> <span class="o">=</span> <span class="n">tank_recharge</span> <span class="o">+</span> <span class="n">subsurface_flow</span> <span class="o">+</span> <span class="n">percolation</span>

    <span class="k">if</span> <span class="n">total_water_passing_through_soil_tank</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1">#Net effective preipitation</span>
        <span class="n">total_water_passing_through_soil_tank</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_change_vqip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">(),</span> <span class="n">total_water_passing_through_soil_tank</span><span class="p">)</span>
        <span class="c1">#Assign a temperature before sending into tank</span>
        <span class="n">total_water_passing_through_soil_tank</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temperature</span>
        <span class="c1">#Assign to tank</span>
        <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">total_water_passing_through_soil_tank</span><span class="p">,</span> <span class="n">force</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="c1">#Pull flows (which now have nonzero pollutant concentrations)</span>
        <span class="n">subsurface_flow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pull_storage</span><span class="p">({</span><span class="s1">&#39;volume&#39;</span><span class="p">:</span> <span class="n">subsurface_flow</span><span class="p">})</span>
        <span class="n">percolation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pull_storage</span><span class="p">({</span><span class="s1">&#39;volume&#39;</span><span class="p">:</span><span class="n">percolation</span><span class="p">})</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1">#No net effective precipitation (instead evaporation occurs)</span>
        <span class="n">evap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaporate</span><span class="p">(</span><span class="o">-</span><span class="n">total_water_passing_through_soil_tank</span><span class="p">)</span>
        <span class="n">subsurface_flow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
        <span class="n">percolation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">evap</span> <span class="o">+</span> <span class="n">infiltrated_precipitation</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span> <span class="o">-</span> <span class="n">evaporation</span> <span class="o">-</span> <span class="n">infiltration_excess</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">constants</span><span class="o">.</span><span class="n">FLOAT_ACCURACY</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;inaccurate evaporation calculation&#39;</span><span class="p">)</span>

    <span class="c1">#TODO saturation excess (think it should just be &#39;pull_ponded&#39;  presumably in net effective precipitation? )</span>

    <span class="c1">#Convert to VQIPs</span>
    <span class="n">infiltration_excess</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_change_vqip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">(),</span> <span class="n">infiltration_excess</span><span class="p">)</span>
    <span class="n">infiltration_excess</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temperature</span>
    <span class="n">precipitation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_change_vqip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">(),</span> <span class="n">precipitation</span><span class="p">)</span>
    <span class="n">evaporation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_change_vqip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">(),</span> <span class="n">evaporation</span><span class="p">)</span>

    <span class="c1">#Track flows (these are sent onwards in the route function)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">infiltration_excess</span> <span class="o">=</span> <span class="n">infiltration_excess</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">subsurface_flow</span> <span class="o">=</span> <span class="n">subsurface_flow</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">percolation</span> <span class="o">=</span> <span class="n">percolation</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tank_recharge</span> <span class="o">=</span> <span class="n">tank_recharge</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">evaporation</span> <span class="o">=</span> <span class="n">evaporation</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">precipitation</span> <span class="o">=</span> <span class="n">precipitation</span>

    <span class="c1">#Mass balance</span>
    <span class="n">in_</span> <span class="o">=</span> <span class="n">precipitation</span>
    <span class="n">out_</span> <span class="o">=</span> <span class="n">evaporation</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">in_</span><span class="p">,</span> <span class="n">out_</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.land.PerviousSurface.route" class="doc doc-heading">
<code class="highlight language-python"><span class="n">route</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>An outflow function that sends percolation, subsurface runoff and surface runoff to their respective tanks in the parent land node.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>tuple</code>
          </td>
          <td><p>A tuple containing a VQIP amount for model inputs and outputs 
for mass balance checking.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\land.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">route</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An outflow function that sends percolation, subsurface runoff and surface runoff to their respective tanks in the parent land node.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (tuple): A tuple containing a VQIP amount for model inputs and outputs </span>
<span class="sd">            for mass balance checking. </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">surface_runoff</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">infiltration_excess</span><span class="p">,</span> <span class="n">force</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">subsurface_runoff</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subsurface_flow</span><span class="p">,</span> <span class="n">force</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">percolation</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">percolation</span><span class="p">,</span> <span class="n">force</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="wsimod.nodes.land.Surface" class="doc doc-heading">
        <code>Surface</code>


</h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="wsimod.nodes.nodes.DecayTank" href="../reference-nodes/#wsimod.nodes.nodes.DecayTank">DecayTank</a></code></p>



        <details class="quote">
          <summary>Source code in <code>wsimod\nodes\land.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Surface</span><span class="p">(</span><span class="n">DecayTank</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                        <span class="n">surface</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                        <span class="n">area</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="n">depth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="n">data_input_dict</span> <span class="o">=</span> <span class="p">{},</span> 
                        <span class="n">pollutant_load</span> <span class="o">=</span> <span class="p">{},</span>
                        <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A subclass of DecayTank. Each Surface is anticipated to represent a </span>
<span class="sd">        different land cover type of a Land node. Besides functioning as a Tank, </span>
<span class="sd">        Surfaces have three lists of functions (inflows, processes and outflows) </span>
<span class="sd">        where behaviour can be added by appending new functions. We anticipate that </span>
<span class="sd">        customised surfaces should be a subclass of Surface or its subclasses and add </span>
<span class="sd">        functions to these lists. These lists are executed (inflows first, then </span>
<span class="sd">        processes, then outflows) in the run function, which is called by the run </span>
<span class="sd">        function in Land. The lists must return any model inflows or outflows as a </span>
<span class="sd">        VQIP for mass balance checking.</span>

<span class="sd">        If a user wishes the DecayTank portion to be active, then can provide </span>
<span class="sd">        &#39;decays&#39;, which are passed upwards (see wsimod/core/core.py/DecayObj for </span>
<span class="sd">        documentation)</span>

<span class="sd">        Args:</span>
<span class="sd">            surface (str, optional): String description of the surface type. Doesn&#39;t </span>
<span class="sd">                serve a modelling purpose, just used for user reference. Defaults to &#39;&#39;.</span>
<span class="sd">            area (float, optional): Area of surface. Defaults to 1.</span>
<span class="sd">            depth (float, optional): Depth of tank (this has different physical </span>
<span class="sd">                implications for different subclasses). Defaults to 1.</span>
<span class="sd">            data_input_dict (dict, optional):  Dictionary of data inputs relevant for </span>
<span class="sd">                the surface (generally, deposition). Keys are tuples where first </span>
<span class="sd">                value is the name of the variable to read from the dict and the </span>
<span class="sd">                second value is the time. Note that this input should be specific to </span>
<span class="sd">                the surface, and is not intended to be the same data input as for the </span>
<span class="sd">                land node. Also note that with each surface having its own timeseries </span>
<span class="sd">                of data inputs, this can take up a lot of memory, thus the default </span>
<span class="sd">                behavior is to have this as monthly data where the time variable is a </span>
<span class="sd">                monthyear. Defaults to {}.</span>
<span class="sd">            pollutant_load (dict, optional): A dict of different pollutant amounts that </span>
<span class="sd">                are deposited on the surface (units are mass per area per timestep). </span>
<span class="sd">                Defaults to {}.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#Assign parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">=</span> <span class="n">depth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_input_dict</span> <span class="o">=</span> <span class="n">data_input_dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">surface</span> <span class="o">=</span> <span class="n">surface</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pollutant_load</span> <span class="o">=</span> <span class="n">pollutant_load</span>
        <span class="c1">#TODO this is a decaytank but growing surfaces don&#39;t have decay parameters... is it a problem.. we don&#39;t even take decays as an explicit argument and insert them in kwargs..</span>
        <span class="n">capacity</span> <span class="o">=</span> <span class="n">area</span> <span class="o">*</span> <span class="n">depth</span>
        <span class="c1">#Parameters</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">capacity</span> <span class="o">=</span> <span class="n">capacity</span><span class="p">,</span>
                                <span class="n">area</span> <span class="o">=</span> <span class="n">area</span><span class="p">,</span>
                                <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1">#Populate function lists</span>
        <span class="c1">#TODO.. not sure why I have deposition but no precipitation here</span>
        <span class="k">if</span> <span class="s1">&#39;nhx-dry&#39;</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data_input_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inflows</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">atmospheric_deposition</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">precipitation_deposition</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inflows</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pollutant_load</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inflows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">simple_deposition</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outflows</span> <span class="o">=</span> <span class="p">[]</span>


    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Call run function (called from Land node)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;nitrite&#39;</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">POLLUTANTS</span><span class="p">:</span>
            <span class="c1">#Assume that if nitrite is modelled then nitrification is also modelled</span>
            <span class="c1">#You will need ammonia-&gt;nitrite-&gt;nitrate decay to accurate simulate ammonia</span>
            <span class="c1">#Thus, these decays are simulated here</span>

            <span class="c1">#NOTE decay in a decaytank happens at start of timestep (confusingly) in the end_timestep function</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;nitrate&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_decayed</span><span class="p">[</span><span class="s1">&#39;nitrite&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">running_inflow_mb</span><span class="p">[</span><span class="s1">&#39;nitrate&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_decayed</span><span class="p">[</span><span class="s1">&#39;nitrite&#39;</span><span class="p">]</span>

            <span class="c1">#Decayed ammonia becomes nitrite</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;nitrite&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_decayed</span><span class="p">[</span><span class="s1">&#39;ammonia&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">running_inflow_mb</span><span class="p">[</span><span class="s1">&#39;nitrite&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_decayed</span><span class="p">[</span><span class="s1">&#39;ammonia&#39;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inflows</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">processes</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">outflows</span><span class="p">:</span>
            <span class="c1">#Iterate over function lists, updating mass balance</span>
            <span class="n">in_</span><span class="p">,</span> <span class="n">out_</span> <span class="o">=</span> <span class="n">f</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">running_inflow_mb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum_vqip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">running_inflow_mb</span><span class="p">,</span> <span class="n">in_</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">running_outflow_mb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum_vqip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">running_outflow_mb</span><span class="p">,</span> <span class="n">out_</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_data_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read data input from parent Land node (i.e., for precipitation/et0/temp)</span>

<span class="sd">        Args:</span>
<span class="sd">            var (str): Name of variable</span>

<span class="sd">        Returns:</span>
<span class="sd">            Data read</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">get_data_input</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_data_input_surface</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read data input from this surface&#39;s data_input_dict</span>

<span class="sd">        Args:</span>
<span class="sd">            var (str): Name of variable</span>

<span class="sd">        Returns:</span>
<span class="sd">            Data read</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_input_dict</span><span class="p">[(</span><span class="n">var</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">monthyear</span><span class="p">)]</span>

    <span class="k">def</span> <span class="nf">dry_deposition_to_tank</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vqip</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generic function for allocating dry pollution deposition to the surface.</span>
<span class="sd">        Simply sends the pollution into the tank (some subclasses overwrite this </span>
<span class="sd">        behaviour)</span>

<span class="sd">        Args:</span>
<span class="sd">            vqip (dict): A VQIP amount of dry deposition to send to tank</span>

<span class="sd">        Returns:</span>
<span class="sd">            vqip (dict): A VQIP amount of dry deposition that entered the tank (used </span>
<span class="sd">                for mass balance checking)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#Default behaviour is to just enter the tank</span>
        <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">vqip</span><span class="p">,</span> <span class="n">force</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">vqip</span>

    <span class="k">def</span> <span class="nf">wet_deposition_to_tank</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vqip</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generic function for allocating wet pollution deposition to the surface.</span>
<span class="sd">        Simply sends the pollution into the tank (some subclasses overwrite this </span>
<span class="sd">        behaviour)</span>

<span class="sd">        Args:</span>
<span class="sd">            vqip (dict): A VQIP amount of wet deposition to send to tank</span>

<span class="sd">        Returns:</span>
<span class="sd">            vqip (dict): A VQIP amount of wet deposition that entered the tank (used </span>
<span class="sd">                for mass balance checking)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#Default behaviour is to just enter the tank</span>
        <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">vqip</span><span class="p">,</span> <span class="n">force</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">vqip</span>

    <span class="k">def</span> <span class="nf">simple_deposition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Inflow function to cause simple pollution deposition to occur, updating the </span>
<span class="sd">        surface tank</span>

<span class="sd">        Returns:</span>
<span class="sd">            (tuple): A tuple containing a VQIP amount for model inputs and outputs </span>
<span class="sd">                for mass balance checking. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pollution</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>

        <span class="c1">#Scale by area</span>
        <span class="k">for</span> <span class="n">pol</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pollutant_load</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">pollution</span><span class="p">[</span><span class="n">pol</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>
        <span class="n">pollution</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1">#Update tank</span>
        <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">pollution</span><span class="p">,</span> <span class="n">force</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">pollution</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">atmospheric_deposition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Inflow function to cause dry atmospheric deposition to occur, updating the </span>
<span class="sd">        surface tank</span>

<span class="sd">        Returns:</span>
<span class="sd">            (tuple): A tuple containing a VQIP amount for model inputs and outputs </span>
<span class="sd">                for mass balance checking. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#TODO double check units in preprocessing - is weight of N or weight of NHX/noy?</span>

        <span class="c1">#Read data and scale</span>
        <span class="n">nhx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_input_surface</span><span class="p">(</span><span class="s1">&#39;nhx-dry&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>
        <span class="n">noy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_input_surface</span><span class="p">(</span><span class="s1">&#39;noy-dry&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>
        <span class="n">srp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_input_surface</span><span class="p">(</span><span class="s1">&#39;srp-dry&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>

        <span class="c1">#Assign pollutants</span>
        <span class="n">vqip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
        <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;ammonia&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nhx</span>
        <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;nitrate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">noy</span>
        <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;phosphate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">srp</span>

        <span class="c1">#Update tank</span>
        <span class="n">in_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dry_deposition_to_tank</span><span class="p">(</span><span class="n">vqip</span><span class="p">)</span>

        <span class="c1">#Return mass balance</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">in_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">precipitation_deposition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Inflow function to cause wet precipitation deposition to occur, updating </span>
<span class="sd">        the surface tank</span>

<span class="sd">        Returns:</span>
<span class="sd">            (tuple): A tuple containing a VQIP amount for model inputs and outputs </span>
<span class="sd">                for mass balance checking. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#TODO double check units - is weight of N or weight of NHX/noy?</span>

        <span class="c1">#Read data and scale</span>
        <span class="n">nhx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_input_surface</span><span class="p">(</span><span class="s1">&#39;nhx-wet&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>
        <span class="n">noy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_input_surface</span><span class="p">(</span><span class="s1">&#39;noy-wet&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>
        <span class="n">srp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_input_surface</span><span class="p">(</span><span class="s1">&#39;srp-wet&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>

        <span class="c1">#Assign pollutants</span>
        <span class="n">vqip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
        <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;ammonia&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nhx</span>
        <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;nitrate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">noy</span>
        <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;phosphate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">srp</span>

        <span class="c1">#Update tank</span>
        <span class="n">in_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wet_deposition_to_tank</span><span class="p">(</span><span class="n">vqip</span><span class="p">)</span>

        <span class="c1">#Return mass balance</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">in_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.land.Surface.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">surface</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">area</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">data_input_dict</span><span class="o">=</span><span class="p">{},</span> <span class="n">pollutant_load</span><span class="o">=</span><span class="p">{},</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>A subclass of DecayTank. Each Surface is anticipated to represent a 
different land cover type of a Land node. Besides functioning as a Tank, 
Surfaces have three lists of functions (inflows, processes and outflows) 
where behaviour can be added by appending new functions. We anticipate that 
customised surfaces should be a subclass of Surface or its subclasses and add 
functions to these lists. These lists are executed (inflows first, then 
processes, then outflows) in the run function, which is called by the run 
function in Land. The lists must return any model inflows or outflows as a 
VQIP for mass balance checking.</p>
<p>If a user wishes the DecayTank portion to be active, then can provide 
'decays', which are passed upwards (see wsimod/core/core.py/DecayObj for 
documentation)</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>surface</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>String description of the surface type. Doesn't 
serve a modelling purpose, just used for user reference. Defaults to ''.</p></td>
          <td>
                <code>&#39;&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>area</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Area of surface. Defaults to 1.</p></td>
          <td>
                <code>1</code>
          </td>
        </tr>
        <tr>
          <td><code>depth</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Depth of tank (this has different physical 
implications for different subclasses). Defaults to 1.</p></td>
          <td>
                <code>1</code>
          </td>
        </tr>
        <tr>
          <td><code>data_input_dict</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>Dictionary of data inputs relevant for 
the surface (generally, deposition). Keys are tuples where first 
value is the name of the variable to read from the dict and the 
second value is the time. Note that this input should be specific to 
the surface, and is not intended to be the same data input as for the 
land node. Also note that with each surface having its own timeseries 
of data inputs, this can take up a lot of memory, thus the default 
behavior is to have this as monthly data where the time variable is a 
monthyear. Defaults to {}.</p></td>
          <td>
                <code>{}</code>
          </td>
        </tr>
        <tr>
          <td><code>pollutant_load</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>A dict of different pollutant amounts that 
are deposited on the surface (units are mass per area per timestep). 
Defaults to {}.</p></td>
          <td>
                <code>{}</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\land.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                    <span class="n">surface</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                    <span class="n">area</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="n">depth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="n">data_input_dict</span> <span class="o">=</span> <span class="p">{},</span> 
                    <span class="n">pollutant_load</span> <span class="o">=</span> <span class="p">{},</span>
                    <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A subclass of DecayTank. Each Surface is anticipated to represent a </span>
<span class="sd">    different land cover type of a Land node. Besides functioning as a Tank, </span>
<span class="sd">    Surfaces have three lists of functions (inflows, processes and outflows) </span>
<span class="sd">    where behaviour can be added by appending new functions. We anticipate that </span>
<span class="sd">    customised surfaces should be a subclass of Surface or its subclasses and add </span>
<span class="sd">    functions to these lists. These lists are executed (inflows first, then </span>
<span class="sd">    processes, then outflows) in the run function, which is called by the run </span>
<span class="sd">    function in Land. The lists must return any model inflows or outflows as a </span>
<span class="sd">    VQIP for mass balance checking.</span>

<span class="sd">    If a user wishes the DecayTank portion to be active, then can provide </span>
<span class="sd">    &#39;decays&#39;, which are passed upwards (see wsimod/core/core.py/DecayObj for </span>
<span class="sd">    documentation)</span>

<span class="sd">    Args:</span>
<span class="sd">        surface (str, optional): String description of the surface type. Doesn&#39;t </span>
<span class="sd">            serve a modelling purpose, just used for user reference. Defaults to &#39;&#39;.</span>
<span class="sd">        area (float, optional): Area of surface. Defaults to 1.</span>
<span class="sd">        depth (float, optional): Depth of tank (this has different physical </span>
<span class="sd">            implications for different subclasses). Defaults to 1.</span>
<span class="sd">        data_input_dict (dict, optional):  Dictionary of data inputs relevant for </span>
<span class="sd">            the surface (generally, deposition). Keys are tuples where first </span>
<span class="sd">            value is the name of the variable to read from the dict and the </span>
<span class="sd">            second value is the time. Note that this input should be specific to </span>
<span class="sd">            the surface, and is not intended to be the same data input as for the </span>
<span class="sd">            land node. Also note that with each surface having its own timeseries </span>
<span class="sd">            of data inputs, this can take up a lot of memory, thus the default </span>
<span class="sd">            behavior is to have this as monthly data where the time variable is a </span>
<span class="sd">            monthyear. Defaults to {}.</span>
<span class="sd">        pollutant_load (dict, optional): A dict of different pollutant amounts that </span>
<span class="sd">            are deposited on the surface (units are mass per area per timestep). </span>
<span class="sd">            Defaults to {}.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#Assign parameters</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">=</span> <span class="n">depth</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data_input_dict</span> <span class="o">=</span> <span class="n">data_input_dict</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">surface</span> <span class="o">=</span> <span class="n">surface</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pollutant_load</span> <span class="o">=</span> <span class="n">pollutant_load</span>
    <span class="c1">#TODO this is a decaytank but growing surfaces don&#39;t have decay parameters... is it a problem.. we don&#39;t even take decays as an explicit argument and insert them in kwargs..</span>
    <span class="n">capacity</span> <span class="o">=</span> <span class="n">area</span> <span class="o">*</span> <span class="n">depth</span>
    <span class="c1">#Parameters</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">capacity</span> <span class="o">=</span> <span class="n">capacity</span><span class="p">,</span>
                            <span class="n">area</span> <span class="o">=</span> <span class="n">area</span><span class="p">,</span>
                            <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1">#Populate function lists</span>
    <span class="c1">#TODO.. not sure why I have deposition but no precipitation here</span>
    <span class="k">if</span> <span class="s1">&#39;nhx-dry&#39;</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data_input_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inflows</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">atmospheric_deposition</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">precipitation_deposition</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inflows</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pollutant_load</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inflows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">simple_deposition</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">processes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">outflows</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.land.Surface.atmospheric_deposition" class="doc doc-heading">
<code class="highlight language-python"><span class="n">atmospheric_deposition</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Inflow function to cause dry atmospheric deposition to occur, updating the 
surface tank</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>tuple</code>
          </td>
          <td><p>A tuple containing a VQIP amount for model inputs and outputs 
for mass balance checking.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\land.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">atmospheric_deposition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Inflow function to cause dry atmospheric deposition to occur, updating the </span>
<span class="sd">    surface tank</span>

<span class="sd">    Returns:</span>
<span class="sd">        (tuple): A tuple containing a VQIP amount for model inputs and outputs </span>
<span class="sd">            for mass balance checking. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#TODO double check units in preprocessing - is weight of N or weight of NHX/noy?</span>

    <span class="c1">#Read data and scale</span>
    <span class="n">nhx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_input_surface</span><span class="p">(</span><span class="s1">&#39;nhx-dry&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>
    <span class="n">noy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_input_surface</span><span class="p">(</span><span class="s1">&#39;noy-dry&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>
    <span class="n">srp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_input_surface</span><span class="p">(</span><span class="s1">&#39;srp-dry&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>

    <span class="c1">#Assign pollutants</span>
    <span class="n">vqip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
    <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;ammonia&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nhx</span>
    <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;nitrate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">noy</span>
    <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;phosphate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">srp</span>

    <span class="c1">#Update tank</span>
    <span class="n">in_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dry_deposition_to_tank</span><span class="p">(</span><span class="n">vqip</span><span class="p">)</span>

    <span class="c1">#Return mass balance</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">in_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.land.Surface.dry_deposition_to_tank" class="doc doc-heading">
<code class="highlight language-python"><span class="n">dry_deposition_to_tank</span><span class="p">(</span><span class="n">vqip</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Generic function for allocating dry pollution deposition to the surface.
Simply sends the pollution into the tank (some subclasses overwrite this 
behaviour)</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>vqip</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>A VQIP amount of dry deposition to send to tank</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>vqip</code></td>          <td>
                <code>dict</code>
          </td>
          <td><p>A VQIP amount of dry deposition that entered the tank (used 
for mass balance checking)</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\land.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">dry_deposition_to_tank</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vqip</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Generic function for allocating dry pollution deposition to the surface.</span>
<span class="sd">    Simply sends the pollution into the tank (some subclasses overwrite this </span>
<span class="sd">    behaviour)</span>

<span class="sd">    Args:</span>
<span class="sd">        vqip (dict): A VQIP amount of dry deposition to send to tank</span>

<span class="sd">    Returns:</span>
<span class="sd">        vqip (dict): A VQIP amount of dry deposition that entered the tank (used </span>
<span class="sd">            for mass balance checking)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#Default behaviour is to just enter the tank</span>
    <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">vqip</span><span class="p">,</span> <span class="n">force</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">vqip</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.land.Surface.get_data_input" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_data_input</span><span class="p">(</span><span class="n">var</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Read data input from parent Land node (i.e., for precipitation/et0/temp)</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>var</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Name of variable</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td><p>Data read</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\land.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_data_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Read data input from parent Land node (i.e., for precipitation/et0/temp)</span>

<span class="sd">    Args:</span>
<span class="sd">        var (str): Name of variable</span>

<span class="sd">    Returns:</span>
<span class="sd">        Data read</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">get_data_input</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.land.Surface.get_data_input_surface" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_data_input_surface</span><span class="p">(</span><span class="n">var</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Read data input from this surface's data_input_dict</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>var</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Name of variable</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td><p>Data read</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\land.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_data_input_surface</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Read data input from this surface&#39;s data_input_dict</span>

<span class="sd">    Args:</span>
<span class="sd">        var (str): Name of variable</span>

<span class="sd">    Returns:</span>
<span class="sd">        Data read</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_input_dict</span><span class="p">[(</span><span class="n">var</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">monthyear</span><span class="p">)]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.land.Surface.precipitation_deposition" class="doc doc-heading">
<code class="highlight language-python"><span class="n">precipitation_deposition</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Inflow function to cause wet precipitation deposition to occur, updating 
the surface tank</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>tuple</code>
          </td>
          <td><p>A tuple containing a VQIP amount for model inputs and outputs 
for mass balance checking.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\land.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">precipitation_deposition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Inflow function to cause wet precipitation deposition to occur, updating </span>
<span class="sd">    the surface tank</span>

<span class="sd">    Returns:</span>
<span class="sd">        (tuple): A tuple containing a VQIP amount for model inputs and outputs </span>
<span class="sd">            for mass balance checking. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#TODO double check units - is weight of N or weight of NHX/noy?</span>

    <span class="c1">#Read data and scale</span>
    <span class="n">nhx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_input_surface</span><span class="p">(</span><span class="s1">&#39;nhx-wet&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>
    <span class="n">noy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_input_surface</span><span class="p">(</span><span class="s1">&#39;noy-wet&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>
    <span class="n">srp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_input_surface</span><span class="p">(</span><span class="s1">&#39;srp-wet&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>

    <span class="c1">#Assign pollutants</span>
    <span class="n">vqip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>
    <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;ammonia&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nhx</span>
    <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;nitrate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">noy</span>
    <span class="n">vqip</span><span class="p">[</span><span class="s1">&#39;phosphate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">srp</span>

    <span class="c1">#Update tank</span>
    <span class="n">in_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wet_deposition_to_tank</span><span class="p">(</span><span class="n">vqip</span><span class="p">)</span>

    <span class="c1">#Return mass balance</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">in_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.land.Surface.run" class="doc doc-heading">
<code class="highlight language-python"><span class="n">run</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Call run function (called from Land node)</p>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\land.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Call run function (called from Land node)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;nitrite&#39;</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">POLLUTANTS</span><span class="p">:</span>
        <span class="c1">#Assume that if nitrite is modelled then nitrification is also modelled</span>
        <span class="c1">#You will need ammonia-&gt;nitrite-&gt;nitrate decay to accurate simulate ammonia</span>
        <span class="c1">#Thus, these decays are simulated here</span>

        <span class="c1">#NOTE decay in a decaytank happens at start of timestep (confusingly) in the end_timestep function</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;nitrate&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_decayed</span><span class="p">[</span><span class="s1">&#39;nitrite&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">running_inflow_mb</span><span class="p">[</span><span class="s1">&#39;nitrate&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_decayed</span><span class="p">[</span><span class="s1">&#39;nitrite&#39;</span><span class="p">]</span>

        <span class="c1">#Decayed ammonia becomes nitrite</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;nitrite&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_decayed</span><span class="p">[</span><span class="s1">&#39;ammonia&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">running_inflow_mb</span><span class="p">[</span><span class="s1">&#39;nitrite&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_decayed</span><span class="p">[</span><span class="s1">&#39;ammonia&#39;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inflows</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">processes</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">outflows</span><span class="p">:</span>
        <span class="c1">#Iterate over function lists, updating mass balance</span>
        <span class="n">in_</span><span class="p">,</span> <span class="n">out_</span> <span class="o">=</span> <span class="n">f</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">running_inflow_mb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum_vqip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">running_inflow_mb</span><span class="p">,</span> <span class="n">in_</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">running_outflow_mb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum_vqip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">running_outflow_mb</span><span class="p">,</span> <span class="n">out_</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.land.Surface.simple_deposition" class="doc doc-heading">
<code class="highlight language-python"><span class="n">simple_deposition</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Inflow function to cause simple pollution deposition to occur, updating the 
surface tank</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>tuple</code>
          </td>
          <td><p>A tuple containing a VQIP amount for model inputs and outputs 
for mass balance checking.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\land.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">simple_deposition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Inflow function to cause simple pollution deposition to occur, updating the </span>
<span class="sd">    surface tank</span>

<span class="sd">    Returns:</span>
<span class="sd">        (tuple): A tuple containing a VQIP amount for model inputs and outputs </span>
<span class="sd">            for mass balance checking. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pollution</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">()</span>

    <span class="c1">#Scale by area</span>
    <span class="k">for</span> <span class="n">pol</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pollutant_load</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">pollution</span><span class="p">[</span><span class="n">pol</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span>
    <span class="n">pollution</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1">#Update tank</span>
    <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">pollution</span><span class="p">,</span> <span class="n">force</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">pollution</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_vqip</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.land.Surface.wet_deposition_to_tank" class="doc doc-heading">
<code class="highlight language-python"><span class="n">wet_deposition_to_tank</span><span class="p">(</span><span class="n">vqip</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Generic function for allocating wet pollution deposition to the surface.
Simply sends the pollution into the tank (some subclasses overwrite this 
behaviour)</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>vqip</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>A VQIP amount of wet deposition to send to tank</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>vqip</code></td>          <td>
                <code>dict</code>
          </td>
          <td><p>A VQIP amount of wet deposition that entered the tank (used 
for mass balance checking)</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\land.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">wet_deposition_to_tank</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vqip</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Generic function for allocating wet pollution deposition to the surface.</span>
<span class="sd">    Simply sends the pollution into the tank (some subclasses overwrite this </span>
<span class="sd">    behaviour)</span>

<span class="sd">    Args:</span>
<span class="sd">        vqip (dict): A VQIP amount of wet deposition to send to tank</span>

<span class="sd">    Returns:</span>
<span class="sd">        vqip (dict): A VQIP amount of wet deposition that entered the tank (used </span>
<span class="sd">            for mass balance checking)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#Default behaviour is to just enter the tank</span>
    <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">push_storage</span><span class="p">(</span><span class="n">vqip</span><span class="p">,</span> <span class="n">force</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">vqip</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div>

<div class="doc doc-object doc-module">


<a id="wsimod.nodes.nutrient_pool"></a>
  <div class="doc doc-contents first">
  
      <p>Created on Thu May 19 16:42:20 2022</p>
<p>@author: barna</p>

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="wsimod.nodes.nutrient_pool.NutrientPool" class="doc doc-heading">
        <code>NutrientPool</code>


</h2>


  <div class="doc doc-contents ">



        <details class="quote">
          <summary>Source code in <code>wsimod\nodes\nutrient_pool.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">NutrientPool</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                        <span class="n">fraction_dry_n_to_dissolved_inorganic</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span>
                        <span class="n">degrhpar</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;N&#39;</span> <span class="p">:</span> <span class="mi">7</span> <span class="o">*</span> <span class="mf">1e-5</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span> <span class="p">:</span> <span class="mi">7</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">},</span>
                        <span class="n">dishpar</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;N&#39;</span> <span class="p">:</span> <span class="mi">7</span> <span class="o">*</span> <span class="mf">1e-5</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span> <span class="p">:</span> <span class="mi">7</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">},</span>
                        <span class="n">minfpar</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;N&#39;</span> <span class="p">:</span> <span class="mf">0.00013</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span> <span class="p">:</span> <span class="mf">0.000003</span><span class="p">},</span>
                        <span class="n">disfpar</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;N&#39;</span> <span class="p">:</span> <span class="mf">0.000003</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span> <span class="p">:</span> <span class="mf">0.0000001</span><span class="p">},</span>
                        <span class="n">immobdpar</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;N&#39;</span> <span class="p">:</span> <span class="mf">0.0056</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span> <span class="p">:</span> <span class="mf">0.2866</span><span class="p">},</span>
                        <span class="n">fraction_manure_to_dissolved_inorganic</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;N&#39;</span> <span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span> <span class="p">:</span> <span class="mf">0.1</span><span class="p">},</span> 
                        <span class="n">fraction_residue_to_fast</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;N&#39;</span> <span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span> <span class="p">:</span> <span class="mf">0.1</span><span class="p">},</span> 
                        <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A class to track nutrient pools in a soil tank, intended to be initialised </span>
<span class="sd">        and called by GrowingSurfaces (see wsimod/nodes/land.py/GrowingSurface) and </span>
<span class="sd">        their subclasses. Contains five pools, which have a storage that tracks the </span>
<span class="sd">        mass of nutrients. Equations and parameters are based on HYPE.</span>

<span class="sd">        Args:</span>
<span class="sd">            fraction_dry_n_to_dissolved_inorganic (float, optional): _description_. Defaults to 0.9.</span>
<span class="sd">            degrhpar (dict, optional): _description_. Defaults to {&#39;N&#39; : 7 * 1e-5, &#39;P&#39; : 7 * 1e-6}.</span>
<span class="sd">            dishpar (dict, optional): _description_. Defaults to {&#39;N&#39; : 7 * 1e-5, &#39;P&#39; : 7 * 1e-6}.</span>
<span class="sd">            minfpar (dict, optional): _description_. Defaults to {&#39;N&#39; : 0.00013, &#39;P&#39; : 0.000003}.</span>
<span class="sd">            disfpar (dict, optional): _description_. Defaults to {&#39;N&#39; : 0.000003, &#39;P&#39; : 0.0000001}.</span>
<span class="sd">            immobdpar (dict, optional): _description_. Defaults to {&#39;N&#39; : 0.0056, &#39;P&#39; : 0.2866}.</span>
<span class="sd">            fraction_manure_to_dissolved_inorganic (dict, optional): _description_. Defaults to {&#39;N&#39; : 0.5, &#39;P&#39; : 0.1}.</span>
<span class="sd">            fraction_residue_to_fast (dict, optional): _description_. Defaults to {&#39;N&#39; : 0.1, &#39;P&#39; : 0.1}.</span>
<span class="sd">        &quot;&quot;&quot;</span>


        <span class="c1">#TODO I don&#39;t think anyone will change most of these params... they could maybe just be set here </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_empty</span><span class="p">()</span>

        <span class="c1">#Assign parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temperature_dependence_factor</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">soil_moisture_dependence_factor</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fraction_manure_to_dissolved_inorganic</span> <span class="o">=</span>  <span class="n">fraction_manure_to_dissolved_inorganic</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fraction_residue_to_fast</span> <span class="o">=</span>  <span class="n">fraction_residue_to_fast</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fraction_dry_n_to_dissolved_inorganic</span> <span class="o">=</span> <span class="n">fraction_dry_n_to_dissolved_inorganic</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">degrhpar</span> <span class="o">=</span> <span class="n">degrhpar</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dishpar</span> <span class="o">=</span> <span class="n">dishpar</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minfpar</span> <span class="o">=</span> <span class="n">minfpar</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disfpar</span> <span class="o">=</span> <span class="n">disfpar</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">immobdpar</span> <span class="o">=</span> <span class="n">immobdpar</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fraction_manure_to_fast</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span> <span class="p">:</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction_manure_to_dissolved_inorganic</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">NUTRIENTS</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fraction_residue_to_humus</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span> <span class="p">:</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction_residue_to_fast</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">NUTRIENTS</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fraction_dry_n_to_fast</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction_dry_n_to_dissolved_inorganic</span>

        <span class="c1">#Initialise different pools</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fast_pool</span> <span class="o">=</span> <span class="n">NutrientStore</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">humus_pool</span> <span class="o">=</span> <span class="n">NutrientStore</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dissolved_inorganic_pool</span> <span class="o">=</span> <span class="n">NutrientStore</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dissolved_organic_pool</span> <span class="o">=</span> <span class="n">NutrientStore</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">adsorbed_inorganic_pool</span> <span class="o">=</span> <span class="n">NutrientStore</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pools</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fast_pool</span><span class="p">,</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">humus_pool</span><span class="p">,</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">dissolved_inorganic_pool</span><span class="p">,</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">dissolved_organic_pool</span><span class="p">,</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">adsorbed_inorganic_pool</span><span class="p">]</span>


    <span class="k">def</span> <span class="nf">init_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialise an empty nutrient to be copied</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">empty_nutrient</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span> <span class="p">:</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">NUTRIENTS</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">init_store</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialise an empty store to track nutrients</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_empty</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">storage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_empty_nutrient</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">allocate_inorganic_irrigation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">irrigation</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Assign inorganic irrigation, which is assumed to contain dissolved inorganic </span>
<span class="sd">        nutrients and thus updates that pool</span>

<span class="sd">        Args:</span>
<span class="sd">            irrigation (dict): A dict that contains the amount of nutrients entering </span>
<span class="sd">                the nutrient pool via irrigation</span>

<span class="sd">        Returns:</span>
<span class="sd">            irrigation (dict): irrigation above, because no transformations take place </span>
<span class="sd">                (i.e., dissolved inorganic is what is received and goes straight into </span>
<span class="sd">                that pool)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#Update pool</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dissolved_inorganic_pool</span><span class="o">.</span><span class="n">receive</span><span class="p">(</span><span class="n">irrigation</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">irrigation</span>

    <span class="k">def</span> <span class="nf">allocate_organic_irrigation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">irrigation</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Assign organic irrigation, which is assumed to contain dissolved organic </span>
<span class="sd">        nutrients and thus updates that pool</span>

<span class="sd">        Args:</span>
<span class="sd">            irrigation (dict): A dict that contains the amount of nutrients entering </span>
<span class="sd">                the nutrient pool via irrigation</span>

<span class="sd">        Returns:</span>
<span class="sd">            irrigation (dict): irrigation above, because no transformations take place </span>
<span class="sd">                (i.e., dissolved organic is what is received and goes straight into </span>
<span class="sd">                that pool)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#Update pool</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dissolved_organic_pool</span><span class="o">.</span><span class="n">receive</span><span class="p">(</span><span class="n">irrigation</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">irrigation</span>

    <span class="k">def</span> <span class="nf">allocate_dry_deposition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deposition</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Assign dry deposition, which is assumed to go to both dissolved inorganic </span>
<span class="sd">        pool and fast pool (nitrogen) and the adsorbed pool (phosphorus).</span>

<span class="sd">        Args:</span>
<span class="sd">            deposition (dict): A dict that contains the amount of nutrients entering </span>
<span class="sd">                the nutrient pool via dry deposition</span>

<span class="sd">        Returns:</span>
<span class="sd">            (dict): A dict describing the amount of nutrients that enter the nutrient </span>
<span class="sd">                pool in a dissolved form (and thus need to be tracked by the soil water </span>
<span class="sd">                tank)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#Update pools</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fast_pool</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">deposition</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction_dry_n_to_fast</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dissolved_inorganic_pool</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">deposition</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction_dry_n_to_dissolved_inorganic</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">adsorbed_inorganic_pool</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">deposition</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;N&#39;</span> <span class="p">:</span> <span class="n">deposition</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction_dry_n_to_dissolved_inorganic</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">allocate_wet_deposition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deposition</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Assign wet deposition, which is assumed to contain dissolved inorganic </span>
<span class="sd">        nutrients and thus updates that pool</span>

<span class="sd">        Args:</span>
<span class="sd">            deposition (dict): A dict that contains the amount of nutrients entering </span>
<span class="sd">                the nutrient pool via wet deposition</span>

<span class="sd">        Returns:</span>
<span class="sd">            deposition (dict): deposition above, because no transformations take place </span>
<span class="sd">                (i.e., dissolved inorganic is what is received and goes straight into </span>
<span class="sd">                that pool)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#Update pool</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dissolved_inorganic_pool</span><span class="o">.</span><span class="n">receive</span><span class="p">(</span><span class="n">deposition</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">deposition</span>

    <span class="k">def</span> <span class="nf">allocate_manure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">manure</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Assign manure, which is assumed to go to both dissolved inorganic </span>
<span class="sd">        pool and fast pool.</span>

<span class="sd">        Args:</span>
<span class="sd">            manure (dict): A dict that contains the amount of nutrients entering </span>
<span class="sd">                the nutrient pool via manure</span>

<span class="sd">        Returns:</span>
<span class="sd">            (dict): A dict describing the amount of nutrients that enter the nutrient </span>
<span class="sd">                pool in a dissolved form (and thus need to be tracked by the soil water </span>
<span class="sd">                tank)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#Assign a proportion of nutrients to the dissolved inorganic pool</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dissolved_inorganic_pool</span><span class="o">.</span><span class="n">receive</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">multiply_nutrients</span><span class="p">(</span><span class="n">manure</span><span class="p">,</span>
                                                                      <span class="bp">self</span><span class="o">.</span><span class="n">fraction_manure_to_dissolved_inorganic</span><span class="p">))</span>
        <span class="c1">#Assign a proportion of nutrients to the fast pool</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fast_pool</span><span class="o">.</span><span class="n">receive</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">multiply_nutrients</span><span class="p">(</span><span class="n">manure</span><span class="p">,</span>
                                                       <span class="bp">self</span><span class="o">.</span><span class="n">fraction_manure_to_fast</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiply_nutrients</span><span class="p">(</span><span class="n">manure</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">fraction_manure_to_dissolved_inorganic</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">allocate_residue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">residue</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Assign residue, which is assumed to go to both humus pool and fast pool.</span>

<span class="sd">        Args:</span>
<span class="sd">            residue (dict): A dict that contains the amount of nutrients entering </span>
<span class="sd">                the nutrient pool via residue</span>

<span class="sd">        Returns:</span>
<span class="sd">            (dict): A dict describing the amount of nutrients that enter the nutrient </span>
<span class="sd">                pool in a dissolved form (and thus need to be tracked by the soil water </span>
<span class="sd">                tank) - i.e., none because fast and humus pool are both solid</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#Assign a proportion of nutrients to the humus pool</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">humus_pool</span><span class="o">.</span><span class="n">receive</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">multiply_nutrients</span><span class="p">(</span><span class="n">residue</span><span class="p">,</span>
                                                   <span class="bp">self</span><span class="o">.</span><span class="n">fraction_residue_to_humus</span><span class="p">))</span>
        <span class="c1">#Assign a proportion of nutrients to the fast pool</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fast_pool</span><span class="o">.</span><span class="n">receive</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">multiply_nutrients</span><span class="p">(</span><span class="n">residue</span><span class="p">,</span>
                                                       <span class="bp">self</span><span class="o">.</span><span class="n">fraction_residue_to_fast</span><span class="p">))</span>    
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_nutrient</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">allocate_fertiliser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fertiliser</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Assign fertiliser, which is assumed to contain dissolved inorganic </span>
<span class="sd">        nutrients and thus updates that pool</span>

<span class="sd">        Args:</span>
<span class="sd">            fertiliser (dict): A dict that contains the amount of nutrients entering </span>
<span class="sd">                the nutrient pool via fertiliser</span>

<span class="sd">        Returns:</span>
<span class="sd">            fertiliser (dict): fertiliser above, because no transformations take place </span>
<span class="sd">                (i.e., dissolved inorganic is what is received and goes straight into </span>
<span class="sd">                that pool)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dissolved_inorganic_pool</span><span class="o">.</span><span class="n">receive</span><span class="p">(</span><span class="n">fertiliser</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fertiliser</span>

    <span class="k">def</span> <span class="nf">extract_dissolved</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proportion</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Function to extract some amount of nutrients from all dissolved pools</span>

<span class="sd">        Args:</span>
<span class="sd">            proportion (float): proportion of the dissolved nutrient pools to extract</span>

<span class="sd">        Returns:</span>
<span class="sd">            (dict): A dict of dicts, where the top level distinguishes between organic </span>
<span class="sd">                and inorganic nutrients, and the bottom level describes how much </span>
<span class="sd">                nutrients (i.e., N and P) have been extracted from those pools</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#Extract from dissolved inorganic pool</span>
        <span class="n">reply_di</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dissolved_inorganic_pool</span><span class="o">.</span><span class="n">extract</span><span class="p">({</span><span class="s1">&#39;N&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dissolved_inorganic_pool</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">proportion</span><span class="p">,</span>
                                                          <span class="s1">&#39;P&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dissolved_inorganic_pool</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">proportion</span><span class="p">})</span>

        <span class="c1">#Extract from dissolved organic pool</span>
        <span class="n">reply_do</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dissolved_organic_pool</span><span class="o">.</span><span class="n">extract</span><span class="p">({</span><span class="s1">&#39;N&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dissolved_organic_pool</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">proportion</span><span class="p">,</span>
                                                        <span class="s1">&#39;P&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dissolved_organic_pool</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">proportion</span><span class="p">})</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;organic&#39;</span> <span class="p">:</span> <span class="n">reply_do</span><span class="p">,</span> <span class="s1">&#39;inorganic&#39;</span> <span class="p">:</span> <span class="n">reply_di</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">get_erodable_P</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return total phosphorus that can be eroded (i.e., humus and adsorbed </span>
<span class="sd">        inorganic pools)</span>

<span class="sd">        Returns:</span>
<span class="sd">            (float): total phosphorus</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">adsorbed_inorganic_pool</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">humus_pool</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">erode_P</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount_P</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update humus and adsorbed inorganic pools to erode some amount. Removed in </span>
<span class="sd">        proportion to amount in both pools</span>

<span class="sd">        Args:</span>
<span class="sd">            amount_P (float): Amount of phosphorus to be eroded</span>

<span class="sd">        Returns:</span>
<span class="sd">            (float): Amount of phosphorus eroded from the humus pool</span>
<span class="sd">            (float): Amount of phosphorus eroded from the adsorbed inorganic pool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#Calculate proportion of adsorbed to be eroded</span>
        <span class="n">fraction_adsorbed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adsorbed_inorganic_pool</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">adsorbed_inorganic_pool</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">humus_pool</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">])</span>

        <span class="c1">#Update nutrients in a dict holder</span>
        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_empty_nutrient</span><span class="p">()</span>

        <span class="c1">#Update inorganic pool</span>
        <span class="n">request</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount_P</span> <span class="o">*</span> <span class="n">fraction_adsorbed</span>
        <span class="n">reply_adsorbed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adsorbed_inorganic_pool</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

        <span class="c1">#Update humus pool</span>
        <span class="n">request</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount_P</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">fraction_adsorbed</span><span class="p">)</span>
        <span class="n">reply_humus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">humus_pool</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">reply_humus</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">],</span> <span class="n">reply_adsorbed</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">soil_pool_transformation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Function to be called by a GrowingSurface that performs and tracks changes resulting from soil transformation processes</span>

<span class="sd">        Returns:</span>
<span class="sd">            (float): increase in dissolved inorganic nutrients resulting from   </span>
<span class="sd">                transformations (negative value indicates a decrease)</span>
<span class="sd">            (float): increase in dissolved organic nutrients resulting from </span>
<span class="sd">                transformations (negative value indicates a decrease)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#For mass balance purposes, assume fast is inorganic and humus is organic</span>

        <span class="c1">#Initialise tracking</span>
        <span class="n">increase_in_dissolved_inorganic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_empty_nutrient</span><span class="p">()</span>
        <span class="n">increase_in_dissolved_organic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_empty_nutrient</span><span class="p">()</span>

        <span class="c1">#Turnover of humus</span>
        <span class="n">amount</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_soil_process</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">degrhpar</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">humus_pool</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fast_pool</span><span class="p">)</span>
        <span class="c1">#This is solid inorganic to solid organic... no tracking needed since solid nutrients aren&#39;t tracked in mass balance of the surface soil water tank!</span>

        <span class="c1">#Dissolution of humus</span>
        <span class="n">amount</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_soil_process</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dishpar</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">humus_pool</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dissolved_organic_pool</span><span class="p">)</span>
        <span class="n">increase_in_dissolved_organic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum_nutrients</span><span class="p">(</span><span class="n">increase_in_dissolved_organic</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span>

        <span class="c1">#Turnover of fast</span>
        <span class="n">amount</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_soil_process</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minfpar</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fast_pool</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dissolved_inorganic_pool</span><span class="p">)</span>
        <span class="n">increase_in_dissolved_inorganic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum_nutrients</span><span class="p">(</span><span class="n">increase_in_dissolved_inorganic</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span>

        <span class="c1">#Dissolution of fast</span>
        <span class="n">amount</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_soil_process</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">disfpar</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fast_pool</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dissolved_organic_pool</span><span class="p">)</span>
        <span class="n">increase_in_dissolved_organic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum_nutrients</span><span class="p">(</span><span class="n">increase_in_dissolved_organic</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span>

        <span class="c1">#Immobilisation</span>
        <span class="n">amount</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_soil_process</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">immobdpar</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dissolved_organic_pool</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fast_pool</span><span class="p">)</span>
        <span class="n">increase_in_dissolved_organic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subtract_nutrients</span><span class="p">(</span><span class="n">increase_in_dissolved_organic</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">increase_in_dissolved_inorganic</span><span class="p">,</span> <span class="n">increase_in_dissolved_organic</span>

    <span class="k">def</span> <span class="nf">temp_soil_process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameter</span><span class="p">,</span> <span class="n">extract_pool</span><span class="p">,</span> <span class="n">receive_pool</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Temperature function to take a parameter, calculate transformation, and remove nutrients </span>
<span class="sd">        from the extract pool and update the receive pool</span>

<span class="sd">        Args:</span>
<span class="sd">            parameter (dict): A dict containing a parameter for each nutrient for the given process </span>
<span class="sd">                (units in per timestep)</span>
<span class="sd">            extract_pool (NutrientStore): The pool to extract from</span>
<span class="sd">            receive_pool (NutrientStore): The pool to receive extracted nutrients</span>

<span class="sd">        Returns:</span>
<span class="sd">            to_extract (dict): A dict containing the amount extracted of each nutrient (for mass </span>
<span class="sd">                balance)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#Initialise nutrients</span>
        <span class="n">to_extract</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_empty_nutrient</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">nutrient</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">NUTRIENTS</span><span class="p">:</span>
            <span class="c1">#Calculate</span>
            <span class="n">to_extract</span><span class="p">[</span><span class="n">nutrient</span><span class="p">]</span> <span class="o">=</span> <span class="n">parameter</span><span class="p">[</span><span class="n">nutrient</span><span class="p">]</span> <span class="o">*</span>\
                                            <span class="bp">self</span><span class="o">.</span><span class="n">temperature_dependence_factor</span> <span class="o">*</span>\
                                            <span class="bp">self</span><span class="o">.</span><span class="n">soil_moisture_dependence_factor</span> <span class="o">*</span>\
                                            <span class="n">extract_pool</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="n">nutrient</span><span class="p">]</span>
        <span class="c1">#Update pools</span>
        <span class="n">to_extract</span> <span class="o">=</span> <span class="n">extract_pool</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">to_extract</span><span class="p">)</span>
        <span class="n">receive_pool</span><span class="o">.</span><span class="n">receive</span><span class="p">(</span><span class="n">to_extract</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">to_extract</span>

    <span class="k">def</span> <span class="nf">get_empty_nutrient</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;An efficient way to get an empty nutrient</span>

<span class="sd">        Returns:</span>
<span class="sd">            (dict): A dict containing 0 for each nutrient</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_nutrient</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">multiply_nutrients</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nutrient</span><span class="p">,</span> <span class="n">factor</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Multiply nutrients by factors</span>

<span class="sd">        Args:</span>
<span class="sd">            nutrient (dict): Dict of nutrients to multiply</span>
<span class="sd">            factor (dict): Dict of factors to multiply for each nutrient</span>

<span class="sd">        Returns:</span>
<span class="sd">            (dict): Multiplied nutrients</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">x</span> <span class="p">:</span> <span class="n">nutrient</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">*</span> <span class="n">factor</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">NUTRIENTS</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">receive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nutrients</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update nutrient store by amounts</span>

<span class="sd">        Args:</span>
<span class="sd">            nutrients (dict): Amount of nutrients to update store by</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#Increase storage</span>
        <span class="k">for</span> <span class="n">nutrient</span><span class="p">,</span> <span class="n">amount</span> <span class="ow">in</span> <span class="n">nutrients</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="n">nutrient</span><span class="p">]</span> <span class="o">+=</span> <span class="n">amount</span>

    <span class="k">def</span> <span class="nf">sum_nutrients</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sum two nutrients</span>

<span class="sd">        Args:</span>
<span class="sd">            n1 (dict): Dict of nutrients</span>
<span class="sd">            n2 (dict): Dict of nutrients</span>

<span class="sd">        Returns:</span>
<span class="sd">            (dict): Summed nutrients</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_empty_nutrient</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">nutrient</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">NUTRIENTS</span><span class="p">:</span>
            <span class="n">reply</span><span class="p">[</span><span class="n">nutrient</span><span class="p">]</span> <span class="o">=</span> <span class="n">n1</span><span class="p">[</span><span class="n">nutrient</span><span class="p">]</span> <span class="o">+</span> <span class="n">n2</span><span class="p">[</span><span class="n">nutrient</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">reply</span>

    <span class="k">def</span> <span class="nf">subtract_nutrients</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Subtract two nutrients</span>

<span class="sd">        Args:</span>
<span class="sd">            n1 (dict): Dict of nutrients to subtract from</span>
<span class="sd">            n2 (dict): Dict of nutrients to subtract</span>

<span class="sd">        Returns:</span>
<span class="sd">            (dict): subtracted nutrients</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_empty_nutrient</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">nutrient</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">NUTRIENTS</span><span class="p">:</span>
            <span class="n">reply</span><span class="p">[</span><span class="n">nutrient</span><span class="p">]</span> <span class="o">=</span> <span class="n">n1</span><span class="p">[</span><span class="n">nutrient</span><span class="p">]</span> <span class="o">-</span> <span class="n">n2</span><span class="p">[</span><span class="n">nutrient</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">reply</span>

    <span class="k">def</span> <span class="nf">extract</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nutrients</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove nutrients from a store</span>

<span class="sd">        Args:</span>
<span class="sd">            nutrients (dict): Dict of nutrients to remove from store</span>

<span class="sd">        Returns:</span>
<span class="sd">            (dict): amount of nutrients successfully removed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_empty_nutrient</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">nutrient</span><span class="p">,</span> <span class="n">amount</span> <span class="ow">in</span> <span class="n">nutrients</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">reply</span><span class="p">[</span><span class="n">nutrient</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="n">nutrient</span><span class="p">],</span> <span class="n">amount</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="n">nutrient</span><span class="p">]</span> <span class="o">-=</span> <span class="n">reply</span><span class="p">[</span><span class="n">nutrient</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">reply</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.nutrient_pool.NutrientPool.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">fraction_dry_n_to_dissolved_inorganic</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">degrhpar</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="mi">7</span> <span class="o">*</span> <span class="mf">1e-05</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">:</span> <span class="mi">7</span> <span class="o">*</span> <span class="mf">1e-06</span><span class="p">},</span> <span class="n">dishpar</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="mi">7</span> <span class="o">*</span> <span class="mf">1e-05</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">:</span> <span class="mi">7</span> <span class="o">*</span> <span class="mf">1e-06</span><span class="p">},</span> <span class="n">minfpar</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="mf">0.00013</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">:</span> <span class="mf">3e-06</span><span class="p">},</span> <span class="n">disfpar</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="mf">3e-06</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">:</span> <span class="mf">1e-07</span><span class="p">},</span> <span class="n">immobdpar</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="mf">0.0056</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">:</span> <span class="mf">0.2866</span><span class="p">},</span> <span class="n">fraction_manure_to_dissolved_inorganic</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">},</span> <span class="n">fraction_residue_to_fast</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">})</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>A class to track nutrient pools in a soil tank, intended to be initialised 
and called by GrowingSurfaces (see wsimod/nodes/land.py/GrowingSurface) and 
their subclasses. Contains five pools, which have a storage that tracks the 
mass of nutrients. Equations and parameters are based on HYPE.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>fraction_dry_n_to_dissolved_inorganic</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p><em>description</em>. Defaults to 0.9.</p></td>
          <td>
                <code>0.9</code>
          </td>
        </tr>
        <tr>
          <td><code>degrhpar</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p><em>description</em>. Defaults to {'N' : 7 * 1e-5, 'P' : 7 * 1e-6}.</p></td>
          <td>
                <code>{&#39;N&#39;: 7 * 1e-05, &#39;P&#39;: 7 * 1e-06}</code>
          </td>
        </tr>
        <tr>
          <td><code>dishpar</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p><em>description</em>. Defaults to {'N' : 7 * 1e-5, 'P' : 7 * 1e-6}.</p></td>
          <td>
                <code>{&#39;N&#39;: 7 * 1e-05, &#39;P&#39;: 7 * 1e-06}</code>
          </td>
        </tr>
        <tr>
          <td><code>minfpar</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p><em>description</em>. Defaults to {'N' : 0.00013, 'P' : 0.000003}.</p></td>
          <td>
                <code>{&#39;N&#39;: 0.00013, &#39;P&#39;: 3e-06}</code>
          </td>
        </tr>
        <tr>
          <td><code>disfpar</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p><em>description</em>. Defaults to {'N' : 0.000003, 'P' : 0.0000001}.</p></td>
          <td>
                <code>{&#39;N&#39;: 3e-06, &#39;P&#39;: 1e-07}</code>
          </td>
        </tr>
        <tr>
          <td><code>immobdpar</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p><em>description</em>. Defaults to {'N' : 0.0056, 'P' : 0.2866}.</p></td>
          <td>
                <code>{&#39;N&#39;: 0.0056, &#39;P&#39;: 0.2866}</code>
          </td>
        </tr>
        <tr>
          <td><code>fraction_manure_to_dissolved_inorganic</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p><em>description</em>. Defaults to {'N' : 0.5, 'P' : 0.1}.</p></td>
          <td>
                <code>{&#39;N&#39;: 0.5, &#39;P&#39;: 0.1}</code>
          </td>
        </tr>
        <tr>
          <td><code>fraction_residue_to_fast</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p><em>description</em>. Defaults to {'N' : 0.1, 'P' : 0.1}.</p></td>
          <td>
                <code>{&#39;N&#39;: 0.1, &#39;P&#39;: 0.1}</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\nutrient_pool.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                    <span class="n">fraction_dry_n_to_dissolved_inorganic</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span>
                    <span class="n">degrhpar</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;N&#39;</span> <span class="p">:</span> <span class="mi">7</span> <span class="o">*</span> <span class="mf">1e-5</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span> <span class="p">:</span> <span class="mi">7</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">},</span>
                    <span class="n">dishpar</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;N&#39;</span> <span class="p">:</span> <span class="mi">7</span> <span class="o">*</span> <span class="mf">1e-5</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span> <span class="p">:</span> <span class="mi">7</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">},</span>
                    <span class="n">minfpar</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;N&#39;</span> <span class="p">:</span> <span class="mf">0.00013</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span> <span class="p">:</span> <span class="mf">0.000003</span><span class="p">},</span>
                    <span class="n">disfpar</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;N&#39;</span> <span class="p">:</span> <span class="mf">0.000003</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span> <span class="p">:</span> <span class="mf">0.0000001</span><span class="p">},</span>
                    <span class="n">immobdpar</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;N&#39;</span> <span class="p">:</span> <span class="mf">0.0056</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span> <span class="p">:</span> <span class="mf">0.2866</span><span class="p">},</span>
                    <span class="n">fraction_manure_to_dissolved_inorganic</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;N&#39;</span> <span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span> <span class="p">:</span> <span class="mf">0.1</span><span class="p">},</span> 
                    <span class="n">fraction_residue_to_fast</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;N&#39;</span> <span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span> <span class="p">:</span> <span class="mf">0.1</span><span class="p">},</span> 
                    <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A class to track nutrient pools in a soil tank, intended to be initialised </span>
<span class="sd">    and called by GrowingSurfaces (see wsimod/nodes/land.py/GrowingSurface) and </span>
<span class="sd">    their subclasses. Contains five pools, which have a storage that tracks the </span>
<span class="sd">    mass of nutrients. Equations and parameters are based on HYPE.</span>

<span class="sd">    Args:</span>
<span class="sd">        fraction_dry_n_to_dissolved_inorganic (float, optional): _description_. Defaults to 0.9.</span>
<span class="sd">        degrhpar (dict, optional): _description_. Defaults to {&#39;N&#39; : 7 * 1e-5, &#39;P&#39; : 7 * 1e-6}.</span>
<span class="sd">        dishpar (dict, optional): _description_. Defaults to {&#39;N&#39; : 7 * 1e-5, &#39;P&#39; : 7 * 1e-6}.</span>
<span class="sd">        minfpar (dict, optional): _description_. Defaults to {&#39;N&#39; : 0.00013, &#39;P&#39; : 0.000003}.</span>
<span class="sd">        disfpar (dict, optional): _description_. Defaults to {&#39;N&#39; : 0.000003, &#39;P&#39; : 0.0000001}.</span>
<span class="sd">        immobdpar (dict, optional): _description_. Defaults to {&#39;N&#39; : 0.0056, &#39;P&#39; : 0.2866}.</span>
<span class="sd">        fraction_manure_to_dissolved_inorganic (dict, optional): _description_. Defaults to {&#39;N&#39; : 0.5, &#39;P&#39; : 0.1}.</span>
<span class="sd">        fraction_residue_to_fast (dict, optional): _description_. Defaults to {&#39;N&#39; : 0.1, &#39;P&#39; : 0.1}.</span>
<span class="sd">    &quot;&quot;&quot;</span>


    <span class="c1">#TODO I don&#39;t think anyone will change most of these params... they could maybe just be set here </span>
    <span class="bp">self</span><span class="o">.</span><span class="n">init_empty</span><span class="p">()</span>

    <span class="c1">#Assign parameters</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">temperature_dependence_factor</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">soil_moisture_dependence_factor</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">fraction_manure_to_dissolved_inorganic</span> <span class="o">=</span>  <span class="n">fraction_manure_to_dissolved_inorganic</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fraction_residue_to_fast</span> <span class="o">=</span>  <span class="n">fraction_residue_to_fast</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fraction_dry_n_to_dissolved_inorganic</span> <span class="o">=</span> <span class="n">fraction_dry_n_to_dissolved_inorganic</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">degrhpar</span> <span class="o">=</span> <span class="n">degrhpar</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dishpar</span> <span class="o">=</span> <span class="n">dishpar</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">minfpar</span> <span class="o">=</span> <span class="n">minfpar</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">disfpar</span> <span class="o">=</span> <span class="n">disfpar</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">immobdpar</span> <span class="o">=</span> <span class="n">immobdpar</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">fraction_manure_to_fast</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span> <span class="p">:</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction_manure_to_dissolved_inorganic</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">NUTRIENTS</span><span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fraction_residue_to_humus</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span> <span class="p">:</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction_residue_to_fast</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">NUTRIENTS</span><span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fraction_dry_n_to_fast</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction_dry_n_to_dissolved_inorganic</span>

    <span class="c1">#Initialise different pools</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fast_pool</span> <span class="o">=</span> <span class="n">NutrientStore</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">humus_pool</span> <span class="o">=</span> <span class="n">NutrientStore</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dissolved_inorganic_pool</span> <span class="o">=</span> <span class="n">NutrientStore</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dissolved_organic_pool</span> <span class="o">=</span> <span class="n">NutrientStore</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">adsorbed_inorganic_pool</span> <span class="o">=</span> <span class="n">NutrientStore</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pools</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fast_pool</span><span class="p">,</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">humus_pool</span><span class="p">,</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">dissolved_inorganic_pool</span><span class="p">,</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">dissolved_organic_pool</span><span class="p">,</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">adsorbed_inorganic_pool</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.nutrient_pool.NutrientPool.allocate_dry_deposition" class="doc doc-heading">
<code class="highlight language-python"><span class="n">allocate_dry_deposition</span><span class="p">(</span><span class="n">deposition</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Assign dry deposition, which is assumed to go to both dissolved inorganic 
pool and fast pool (nitrogen) and the adsorbed pool (phosphorus).</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>deposition</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>A dict that contains the amount of nutrients entering 
the nutrient pool via dry deposition</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>dict</code>
          </td>
          <td><p>A dict describing the amount of nutrients that enter the nutrient 
pool in a dissolved form (and thus need to be tracked by the soil water 
tank)</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\nutrient_pool.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">allocate_dry_deposition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deposition</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Assign dry deposition, which is assumed to go to both dissolved inorganic </span>
<span class="sd">    pool and fast pool (nitrogen) and the adsorbed pool (phosphorus).</span>

<span class="sd">    Args:</span>
<span class="sd">        deposition (dict): A dict that contains the amount of nutrients entering </span>
<span class="sd">            the nutrient pool via dry deposition</span>

<span class="sd">    Returns:</span>
<span class="sd">        (dict): A dict describing the amount of nutrients that enter the nutrient </span>
<span class="sd">            pool in a dissolved form (and thus need to be tracked by the soil water </span>
<span class="sd">            tank)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#Update pools</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fast_pool</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">deposition</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction_dry_n_to_fast</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dissolved_inorganic_pool</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">deposition</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction_dry_n_to_dissolved_inorganic</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">adsorbed_inorganic_pool</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">deposition</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;N&#39;</span> <span class="p">:</span> <span class="n">deposition</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction_dry_n_to_dissolved_inorganic</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.nutrient_pool.NutrientPool.allocate_fertiliser" class="doc doc-heading">
<code class="highlight language-python"><span class="n">allocate_fertiliser</span><span class="p">(</span><span class="n">fertiliser</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Assign fertiliser, which is assumed to contain dissolved inorganic 
nutrients and thus updates that pool</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>fertiliser</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>A dict that contains the amount of nutrients entering 
the nutrient pool via fertiliser</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>fertiliser</code></td>          <td>
                <code>dict</code>
          </td>
          <td><p>fertiliser above, because no transformations take place 
(i.e., dissolved inorganic is what is received and goes straight into 
that pool)</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\nutrient_pool.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">allocate_fertiliser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fertiliser</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Assign fertiliser, which is assumed to contain dissolved inorganic </span>
<span class="sd">    nutrients and thus updates that pool</span>

<span class="sd">    Args:</span>
<span class="sd">        fertiliser (dict): A dict that contains the amount of nutrients entering </span>
<span class="sd">            the nutrient pool via fertiliser</span>

<span class="sd">    Returns:</span>
<span class="sd">        fertiliser (dict): fertiliser above, because no transformations take place </span>
<span class="sd">            (i.e., dissolved inorganic is what is received and goes straight into </span>
<span class="sd">            that pool)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dissolved_inorganic_pool</span><span class="o">.</span><span class="n">receive</span><span class="p">(</span><span class="n">fertiliser</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fertiliser</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.nutrient_pool.NutrientPool.allocate_inorganic_irrigation" class="doc doc-heading">
<code class="highlight language-python"><span class="n">allocate_inorganic_irrigation</span><span class="p">(</span><span class="n">irrigation</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Assign inorganic irrigation, which is assumed to contain dissolved inorganic 
nutrients and thus updates that pool</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>irrigation</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>A dict that contains the amount of nutrients entering 
the nutrient pool via irrigation</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>irrigation</code></td>          <td>
                <code>dict</code>
          </td>
          <td><p>irrigation above, because no transformations take place 
(i.e., dissolved inorganic is what is received and goes straight into 
that pool)</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\nutrient_pool.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">allocate_inorganic_irrigation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">irrigation</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Assign inorganic irrigation, which is assumed to contain dissolved inorganic </span>
<span class="sd">    nutrients and thus updates that pool</span>

<span class="sd">    Args:</span>
<span class="sd">        irrigation (dict): A dict that contains the amount of nutrients entering </span>
<span class="sd">            the nutrient pool via irrigation</span>

<span class="sd">    Returns:</span>
<span class="sd">        irrigation (dict): irrigation above, because no transformations take place </span>
<span class="sd">            (i.e., dissolved inorganic is what is received and goes straight into </span>
<span class="sd">            that pool)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#Update pool</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dissolved_inorganic_pool</span><span class="o">.</span><span class="n">receive</span><span class="p">(</span><span class="n">irrigation</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">irrigation</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.nutrient_pool.NutrientPool.allocate_manure" class="doc doc-heading">
<code class="highlight language-python"><span class="n">allocate_manure</span><span class="p">(</span><span class="n">manure</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Assign manure, which is assumed to go to both dissolved inorganic 
pool and fast pool.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>manure</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>A dict that contains the amount of nutrients entering 
the nutrient pool via manure</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>dict</code>
          </td>
          <td><p>A dict describing the amount of nutrients that enter the nutrient 
pool in a dissolved form (and thus need to be tracked by the soil water 
tank)</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\nutrient_pool.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">allocate_manure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">manure</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Assign manure, which is assumed to go to both dissolved inorganic </span>
<span class="sd">    pool and fast pool.</span>

<span class="sd">    Args:</span>
<span class="sd">        manure (dict): A dict that contains the amount of nutrients entering </span>
<span class="sd">            the nutrient pool via manure</span>

<span class="sd">    Returns:</span>
<span class="sd">        (dict): A dict describing the amount of nutrients that enter the nutrient </span>
<span class="sd">            pool in a dissolved form (and thus need to be tracked by the soil water </span>
<span class="sd">            tank)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#Assign a proportion of nutrients to the dissolved inorganic pool</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dissolved_inorganic_pool</span><span class="o">.</span><span class="n">receive</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">multiply_nutrients</span><span class="p">(</span><span class="n">manure</span><span class="p">,</span>
                                                                  <span class="bp">self</span><span class="o">.</span><span class="n">fraction_manure_to_dissolved_inorganic</span><span class="p">))</span>
    <span class="c1">#Assign a proportion of nutrients to the fast pool</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fast_pool</span><span class="o">.</span><span class="n">receive</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">multiply_nutrients</span><span class="p">(</span><span class="n">manure</span><span class="p">,</span>
                                                   <span class="bp">self</span><span class="o">.</span><span class="n">fraction_manure_to_fast</span><span class="p">))</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiply_nutrients</span><span class="p">(</span><span class="n">manure</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">fraction_manure_to_dissolved_inorganic</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.nutrient_pool.NutrientPool.allocate_organic_irrigation" class="doc doc-heading">
<code class="highlight language-python"><span class="n">allocate_organic_irrigation</span><span class="p">(</span><span class="n">irrigation</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Assign organic irrigation, which is assumed to contain dissolved organic 
nutrients and thus updates that pool</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>irrigation</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>A dict that contains the amount of nutrients entering 
the nutrient pool via irrigation</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>irrigation</code></td>          <td>
                <code>dict</code>
          </td>
          <td><p>irrigation above, because no transformations take place 
(i.e., dissolved organic is what is received and goes straight into 
that pool)</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\nutrient_pool.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">allocate_organic_irrigation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">irrigation</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Assign organic irrigation, which is assumed to contain dissolved organic </span>
<span class="sd">    nutrients and thus updates that pool</span>

<span class="sd">    Args:</span>
<span class="sd">        irrigation (dict): A dict that contains the amount of nutrients entering </span>
<span class="sd">            the nutrient pool via irrigation</span>

<span class="sd">    Returns:</span>
<span class="sd">        irrigation (dict): irrigation above, because no transformations take place </span>
<span class="sd">            (i.e., dissolved organic is what is received and goes straight into </span>
<span class="sd">            that pool)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#Update pool</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dissolved_organic_pool</span><span class="o">.</span><span class="n">receive</span><span class="p">(</span><span class="n">irrigation</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">irrigation</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.nutrient_pool.NutrientPool.allocate_residue" class="doc doc-heading">
<code class="highlight language-python"><span class="n">allocate_residue</span><span class="p">(</span><span class="n">residue</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Assign residue, which is assumed to go to both humus pool and fast pool.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>residue</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>A dict that contains the amount of nutrients entering 
the nutrient pool via residue</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>dict</code>
          </td>
          <td><p>A dict describing the amount of nutrients that enter the nutrient 
pool in a dissolved form (and thus need to be tracked by the soil water 
tank) - i.e., none because fast and humus pool are both solid</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\nutrient_pool.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">allocate_residue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">residue</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Assign residue, which is assumed to go to both humus pool and fast pool.</span>

<span class="sd">    Args:</span>
<span class="sd">        residue (dict): A dict that contains the amount of nutrients entering </span>
<span class="sd">            the nutrient pool via residue</span>

<span class="sd">    Returns:</span>
<span class="sd">        (dict): A dict describing the amount of nutrients that enter the nutrient </span>
<span class="sd">            pool in a dissolved form (and thus need to be tracked by the soil water </span>
<span class="sd">            tank) - i.e., none because fast and humus pool are both solid</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#Assign a proportion of nutrients to the humus pool</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">humus_pool</span><span class="o">.</span><span class="n">receive</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">multiply_nutrients</span><span class="p">(</span><span class="n">residue</span><span class="p">,</span>
                                               <span class="bp">self</span><span class="o">.</span><span class="n">fraction_residue_to_humus</span><span class="p">))</span>
    <span class="c1">#Assign a proportion of nutrients to the fast pool</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fast_pool</span><span class="o">.</span><span class="n">receive</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">multiply_nutrients</span><span class="p">(</span><span class="n">residue</span><span class="p">,</span>
                                                   <span class="bp">self</span><span class="o">.</span><span class="n">fraction_residue_to_fast</span><span class="p">))</span>    
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_nutrient</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.nutrient_pool.NutrientPool.allocate_wet_deposition" class="doc doc-heading">
<code class="highlight language-python"><span class="n">allocate_wet_deposition</span><span class="p">(</span><span class="n">deposition</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Assign wet deposition, which is assumed to contain dissolved inorganic 
nutrients and thus updates that pool</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>deposition</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>A dict that contains the amount of nutrients entering 
the nutrient pool via wet deposition</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>deposition</code></td>          <td>
                <code>dict</code>
          </td>
          <td><p>deposition above, because no transformations take place 
(i.e., dissolved inorganic is what is received and goes straight into 
that pool)</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\nutrient_pool.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">allocate_wet_deposition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deposition</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Assign wet deposition, which is assumed to contain dissolved inorganic </span>
<span class="sd">    nutrients and thus updates that pool</span>

<span class="sd">    Args:</span>
<span class="sd">        deposition (dict): A dict that contains the amount of nutrients entering </span>
<span class="sd">            the nutrient pool via wet deposition</span>

<span class="sd">    Returns:</span>
<span class="sd">        deposition (dict): deposition above, because no transformations take place </span>
<span class="sd">            (i.e., dissolved inorganic is what is received and goes straight into </span>
<span class="sd">            that pool)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#Update pool</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dissolved_inorganic_pool</span><span class="o">.</span><span class="n">receive</span><span class="p">(</span><span class="n">deposition</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">deposition</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.nutrient_pool.NutrientPool.erode_P" class="doc doc-heading">
<code class="highlight language-python"><span class="n">erode_P</span><span class="p">(</span><span class="n">amount_P</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Update humus and adsorbed inorganic pools to erode some amount. Removed in 
proportion to amount in both pools</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>amount_P</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Amount of phosphorus to be eroded</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>float</code>
          </td>
          <td><p>Amount of phosphorus eroded from the humus pool</p></td>
        </tr>
        <tr>
          <td>
                <code>float</code>
          </td>
          <td><p>Amount of phosphorus eroded from the adsorbed inorganic pool</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\nutrient_pool.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">erode_P</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount_P</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Update humus and adsorbed inorganic pools to erode some amount. Removed in </span>
<span class="sd">    proportion to amount in both pools</span>

<span class="sd">    Args:</span>
<span class="sd">        amount_P (float): Amount of phosphorus to be eroded</span>

<span class="sd">    Returns:</span>
<span class="sd">        (float): Amount of phosphorus eroded from the humus pool</span>
<span class="sd">        (float): Amount of phosphorus eroded from the adsorbed inorganic pool</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#Calculate proportion of adsorbed to be eroded</span>
    <span class="n">fraction_adsorbed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adsorbed_inorganic_pool</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">adsorbed_inorganic_pool</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">humus_pool</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">])</span>

    <span class="c1">#Update nutrients in a dict holder</span>
    <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_empty_nutrient</span><span class="p">()</span>

    <span class="c1">#Update inorganic pool</span>
    <span class="n">request</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount_P</span> <span class="o">*</span> <span class="n">fraction_adsorbed</span>
    <span class="n">reply_adsorbed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adsorbed_inorganic_pool</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

    <span class="c1">#Update humus pool</span>
    <span class="n">request</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount_P</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">fraction_adsorbed</span><span class="p">)</span>
    <span class="n">reply_humus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">humus_pool</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">reply_humus</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">],</span> <span class="n">reply_adsorbed</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.nutrient_pool.NutrientPool.extract" class="doc doc-heading">
<code class="highlight language-python"><span class="n">extract</span><span class="p">(</span><span class="n">nutrients</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Remove nutrients from a store</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>nutrients</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>Dict of nutrients to remove from store</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>dict</code>
          </td>
          <td><p>amount of nutrients successfully removed</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\nutrient_pool.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">extract</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nutrients</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Remove nutrients from a store</span>

<span class="sd">    Args:</span>
<span class="sd">        nutrients (dict): Dict of nutrients to remove from store</span>

<span class="sd">    Returns:</span>
<span class="sd">        (dict): amount of nutrients successfully removed</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_empty_nutrient</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">nutrient</span><span class="p">,</span> <span class="n">amount</span> <span class="ow">in</span> <span class="n">nutrients</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">reply</span><span class="p">[</span><span class="n">nutrient</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="n">nutrient</span><span class="p">],</span> <span class="n">amount</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="n">nutrient</span><span class="p">]</span> <span class="o">-=</span> <span class="n">reply</span><span class="p">[</span><span class="n">nutrient</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">reply</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.nutrient_pool.NutrientPool.extract_dissolved" class="doc doc-heading">
<code class="highlight language-python"><span class="n">extract_dissolved</span><span class="p">(</span><span class="n">proportion</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Function to extract some amount of nutrients from all dissolved pools</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>proportion</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>proportion of the dissolved nutrient pools to extract</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>dict</code>
          </td>
          <td><p>A dict of dicts, where the top level distinguishes between organic 
and inorganic nutrients, and the bottom level describes how much 
nutrients (i.e., N and P) have been extracted from those pools</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\nutrient_pool.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">extract_dissolved</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proportion</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function to extract some amount of nutrients from all dissolved pools</span>

<span class="sd">    Args:</span>
<span class="sd">        proportion (float): proportion of the dissolved nutrient pools to extract</span>

<span class="sd">    Returns:</span>
<span class="sd">        (dict): A dict of dicts, where the top level distinguishes between organic </span>
<span class="sd">            and inorganic nutrients, and the bottom level describes how much </span>
<span class="sd">            nutrients (i.e., N and P) have been extracted from those pools</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#Extract from dissolved inorganic pool</span>
    <span class="n">reply_di</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dissolved_inorganic_pool</span><span class="o">.</span><span class="n">extract</span><span class="p">({</span><span class="s1">&#39;N&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dissolved_inorganic_pool</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">proportion</span><span class="p">,</span>
                                                      <span class="s1">&#39;P&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dissolved_inorganic_pool</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">proportion</span><span class="p">})</span>

    <span class="c1">#Extract from dissolved organic pool</span>
    <span class="n">reply_do</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dissolved_organic_pool</span><span class="o">.</span><span class="n">extract</span><span class="p">({</span><span class="s1">&#39;N&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dissolved_organic_pool</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">proportion</span><span class="p">,</span>
                                                    <span class="s1">&#39;P&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dissolved_organic_pool</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">proportion</span><span class="p">})</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;organic&#39;</span> <span class="p">:</span> <span class="n">reply_do</span><span class="p">,</span> <span class="s1">&#39;inorganic&#39;</span> <span class="p">:</span> <span class="n">reply_di</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.nutrient_pool.NutrientPool.get_empty_nutrient" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_empty_nutrient</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>An efficient way to get an empty nutrient</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>dict</code>
          </td>
          <td><p>A dict containing 0 for each nutrient</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\nutrient_pool.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_empty_nutrient</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An efficient way to get an empty nutrient</span>

<span class="sd">    Returns:</span>
<span class="sd">        (dict): A dict containing 0 for each nutrient</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_nutrient</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.nutrient_pool.NutrientPool.get_erodable_P" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_erodable_P</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Return total phosphorus that can be eroded (i.e., humus and adsorbed 
inorganic pools)</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>float</code>
          </td>
          <td><p>total phosphorus</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\nutrient_pool.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_erodable_P</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return total phosphorus that can be eroded (i.e., humus and adsorbed </span>
<span class="sd">    inorganic pools)</span>

<span class="sd">    Returns:</span>
<span class="sd">        (float): total phosphorus</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">adsorbed_inorganic_pool</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">humus_pool</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.nutrient_pool.NutrientPool.init_empty" class="doc doc-heading">
<code class="highlight language-python"><span class="n">init_empty</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Initialise an empty nutrient to be copied</p>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\nutrient_pool.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">init_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Initialise an empty nutrient to be copied</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">empty_nutrient</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span> <span class="p">:</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">NUTRIENTS</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.nutrient_pool.NutrientPool.init_store" class="doc doc-heading">
<code class="highlight language-python"><span class="n">init_store</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Initialise an empty store to track nutrients</p>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\nutrient_pool.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">init_store</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Initialise an empty store to track nutrients</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">init_empty</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">storage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_empty_nutrient</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.nutrient_pool.NutrientPool.multiply_nutrients" class="doc doc-heading">
<code class="highlight language-python"><span class="n">multiply_nutrients</span><span class="p">(</span><span class="n">nutrient</span><span class="p">,</span> <span class="n">factor</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Multiply nutrients by factors</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>nutrient</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>Dict of nutrients to multiply</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>factor</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>Dict of factors to multiply for each nutrient</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>dict</code>
          </td>
          <td><p>Multiplied nutrients</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\nutrient_pool.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">multiply_nutrients</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nutrient</span><span class="p">,</span> <span class="n">factor</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Multiply nutrients by factors</span>

<span class="sd">    Args:</span>
<span class="sd">        nutrient (dict): Dict of nutrients to multiply</span>
<span class="sd">        factor (dict): Dict of factors to multiply for each nutrient</span>

<span class="sd">    Returns:</span>
<span class="sd">        (dict): Multiplied nutrients</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span><span class="n">x</span> <span class="p">:</span> <span class="n">nutrient</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">*</span> <span class="n">factor</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">NUTRIENTS</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.nutrient_pool.NutrientPool.receive" class="doc doc-heading">
<code class="highlight language-python"><span class="n">receive</span><span class="p">(</span><span class="n">nutrients</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Update nutrient store by amounts</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>nutrients</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>Amount of nutrients to update store by</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\nutrient_pool.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">receive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nutrients</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Update nutrient store by amounts</span>

<span class="sd">    Args:</span>
<span class="sd">        nutrients (dict): Amount of nutrients to update store by</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#Increase storage</span>
    <span class="k">for</span> <span class="n">nutrient</span><span class="p">,</span> <span class="n">amount</span> <span class="ow">in</span> <span class="n">nutrients</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="n">nutrient</span><span class="p">]</span> <span class="o">+=</span> <span class="n">amount</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.nutrient_pool.NutrientPool.soil_pool_transformation" class="doc doc-heading">
<code class="highlight language-python"><span class="n">soil_pool_transformation</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Function to be called by a GrowingSurface that performs and tracks changes resulting from soil transformation processes</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>float</code>
          </td>
          <td><p>increase in dissolved inorganic nutrients resulting from <br />
transformations (negative value indicates a decrease)</p></td>
        </tr>
        <tr>
          <td>
                <code>float</code>
          </td>
          <td><p>increase in dissolved organic nutrients resulting from 
transformations (negative value indicates a decrease)</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\nutrient_pool.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">soil_pool_transformation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function to be called by a GrowingSurface that performs and tracks changes resulting from soil transformation processes</span>

<span class="sd">    Returns:</span>
<span class="sd">        (float): increase in dissolved inorganic nutrients resulting from   </span>
<span class="sd">            transformations (negative value indicates a decrease)</span>
<span class="sd">        (float): increase in dissolved organic nutrients resulting from </span>
<span class="sd">            transformations (negative value indicates a decrease)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#For mass balance purposes, assume fast is inorganic and humus is organic</span>

    <span class="c1">#Initialise tracking</span>
    <span class="n">increase_in_dissolved_inorganic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_empty_nutrient</span><span class="p">()</span>
    <span class="n">increase_in_dissolved_organic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_empty_nutrient</span><span class="p">()</span>

    <span class="c1">#Turnover of humus</span>
    <span class="n">amount</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_soil_process</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">degrhpar</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">humus_pool</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fast_pool</span><span class="p">)</span>
    <span class="c1">#This is solid inorganic to solid organic... no tracking needed since solid nutrients aren&#39;t tracked in mass balance of the surface soil water tank!</span>

    <span class="c1">#Dissolution of humus</span>
    <span class="n">amount</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_soil_process</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dishpar</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">humus_pool</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dissolved_organic_pool</span><span class="p">)</span>
    <span class="n">increase_in_dissolved_organic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum_nutrients</span><span class="p">(</span><span class="n">increase_in_dissolved_organic</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span>

    <span class="c1">#Turnover of fast</span>
    <span class="n">amount</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_soil_process</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minfpar</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fast_pool</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dissolved_inorganic_pool</span><span class="p">)</span>
    <span class="n">increase_in_dissolved_inorganic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum_nutrients</span><span class="p">(</span><span class="n">increase_in_dissolved_inorganic</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span>

    <span class="c1">#Dissolution of fast</span>
    <span class="n">amount</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_soil_process</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">disfpar</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fast_pool</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dissolved_organic_pool</span><span class="p">)</span>
    <span class="n">increase_in_dissolved_organic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum_nutrients</span><span class="p">(</span><span class="n">increase_in_dissolved_organic</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span>

    <span class="c1">#Immobilisation</span>
    <span class="n">amount</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_soil_process</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">immobdpar</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dissolved_organic_pool</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fast_pool</span><span class="p">)</span>
    <span class="n">increase_in_dissolved_organic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subtract_nutrients</span><span class="p">(</span><span class="n">increase_in_dissolved_organic</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">increase_in_dissolved_inorganic</span><span class="p">,</span> <span class="n">increase_in_dissolved_organic</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.nutrient_pool.NutrientPool.subtract_nutrients" class="doc doc-heading">
<code class="highlight language-python"><span class="n">subtract_nutrients</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Subtract two nutrients</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>n1</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>Dict of nutrients to subtract from</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>n2</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>Dict of nutrients to subtract</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>dict</code>
          </td>
          <td><p>subtracted nutrients</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\nutrient_pool.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">subtract_nutrients</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Subtract two nutrients</span>

<span class="sd">    Args:</span>
<span class="sd">        n1 (dict): Dict of nutrients to subtract from</span>
<span class="sd">        n2 (dict): Dict of nutrients to subtract</span>

<span class="sd">    Returns:</span>
<span class="sd">        (dict): subtracted nutrients</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_empty_nutrient</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">nutrient</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">NUTRIENTS</span><span class="p">:</span>
        <span class="n">reply</span><span class="p">[</span><span class="n">nutrient</span><span class="p">]</span> <span class="o">=</span> <span class="n">n1</span><span class="p">[</span><span class="n">nutrient</span><span class="p">]</span> <span class="o">-</span> <span class="n">n2</span><span class="p">[</span><span class="n">nutrient</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">reply</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.nutrient_pool.NutrientPool.sum_nutrients" class="doc doc-heading">
<code class="highlight language-python"><span class="n">sum_nutrients</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Sum two nutrients</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>n1</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>Dict of nutrients</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>n2</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>Dict of nutrients</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>dict</code>
          </td>
          <td><p>Summed nutrients</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\nutrient_pool.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">sum_nutrients</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Sum two nutrients</span>

<span class="sd">    Args:</span>
<span class="sd">        n1 (dict): Dict of nutrients</span>
<span class="sd">        n2 (dict): Dict of nutrients</span>

<span class="sd">    Returns:</span>
<span class="sd">        (dict): Summed nutrients</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_empty_nutrient</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">nutrient</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">NUTRIENTS</span><span class="p">:</span>
        <span class="n">reply</span><span class="p">[</span><span class="n">nutrient</span><span class="p">]</span> <span class="o">=</span> <span class="n">n1</span><span class="p">[</span><span class="n">nutrient</span><span class="p">]</span> <span class="o">+</span> <span class="n">n2</span><span class="p">[</span><span class="n">nutrient</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">reply</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.nutrient_pool.NutrientPool.temp_soil_process" class="doc doc-heading">
<code class="highlight language-python"><span class="n">temp_soil_process</span><span class="p">(</span><span class="n">parameter</span><span class="p">,</span> <span class="n">extract_pool</span><span class="p">,</span> <span class="n">receive_pool</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Temperature function to take a parameter, calculate transformation, and remove nutrients 
from the extract pool and update the receive pool</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>parameter</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>A dict containing a parameter for each nutrient for the given process 
(units in per timestep)</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>extract_pool</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="wsimod.nodes.nutrient_pool.NutrientStore" href="#wsimod.nodes.nutrient_pool.NutrientStore">NutrientStore</a></code>
          </td>
          <td><p>The pool to extract from</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>receive_pool</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="wsimod.nodes.nutrient_pool.NutrientStore" href="#wsimod.nodes.nutrient_pool.NutrientStore">NutrientStore</a></code>
          </td>
          <td><p>The pool to receive extracted nutrients</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>to_extract</code></td>          <td>
                <code>dict</code>
          </td>
          <td><p>A dict containing the amount extracted of each nutrient (for mass 
balance)</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\nutrient_pool.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">temp_soil_process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameter</span><span class="p">,</span> <span class="n">extract_pool</span><span class="p">,</span> <span class="n">receive_pool</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Temperature function to take a parameter, calculate transformation, and remove nutrients </span>
<span class="sd">    from the extract pool and update the receive pool</span>

<span class="sd">    Args:</span>
<span class="sd">        parameter (dict): A dict containing a parameter for each nutrient for the given process </span>
<span class="sd">            (units in per timestep)</span>
<span class="sd">        extract_pool (NutrientStore): The pool to extract from</span>
<span class="sd">        receive_pool (NutrientStore): The pool to receive extracted nutrients</span>

<span class="sd">    Returns:</span>
<span class="sd">        to_extract (dict): A dict containing the amount extracted of each nutrient (for mass </span>
<span class="sd">            balance)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#Initialise nutrients</span>
    <span class="n">to_extract</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_empty_nutrient</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">nutrient</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">NUTRIENTS</span><span class="p">:</span>
        <span class="c1">#Calculate</span>
        <span class="n">to_extract</span><span class="p">[</span><span class="n">nutrient</span><span class="p">]</span> <span class="o">=</span> <span class="n">parameter</span><span class="p">[</span><span class="n">nutrient</span><span class="p">]</span> <span class="o">*</span>\
                                        <span class="bp">self</span><span class="o">.</span><span class="n">temperature_dependence_factor</span> <span class="o">*</span>\
                                        <span class="bp">self</span><span class="o">.</span><span class="n">soil_moisture_dependence_factor</span> <span class="o">*</span>\
                                        <span class="n">extract_pool</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="n">nutrient</span><span class="p">]</span>
    <span class="c1">#Update pools</span>
    <span class="n">to_extract</span> <span class="o">=</span> <span class="n">extract_pool</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">to_extract</span><span class="p">)</span>
    <span class="n">receive_pool</span><span class="o">.</span><span class="n">receive</span><span class="p">(</span><span class="n">to_extract</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">to_extract</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="wsimod.nodes.nutrient_pool.NutrientStore" class="doc doc-heading">
        <code>NutrientStore</code>


</h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="wsimod.nodes.nutrient_pool.NutrientPool" href="#wsimod.nodes.nutrient_pool.NutrientPool">NutrientPool</a></code></p>



        <details class="quote">
          <summary>Source code in <code>wsimod\nodes\nutrient_pool.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">NutrientStore</span><span class="p">(</span><span class="n">NutrientPool</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Nutrient store, to be instantiated by a NutrientPool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">init_store</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 id="wsimod.nodes.nutrient_pool.NutrientStore.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Nutrient store, to be instantiated by a NutrientPool</p>

      <details class="quote">
        <summary>Source code in <code>wsimod\nodes\nutrient_pool.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Nutrient store, to be instantiated by a NutrientPool</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">init_store</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.ecf98df9.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.39f04ddb.min.js"></script>
      
    
  </body>
</html>